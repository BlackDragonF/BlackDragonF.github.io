
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="码龙的窝">
    <title>深入理解计算机系统DataLab实验报告 - 码龙的窝</title>
    <meta name="author" content="码龙黑曜">
    
        <meta name="keywords" content="博客,iOS,Computer Science,码龙,">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"码龙黑曜","sameAs":["https://github.com/BlackDragonF","https://t.me/Cosidian","http://steamcommunity.com/id/BlackDragonF/","mailto:obsidiandragon2016@gmail.com"],"image":"avatar.jpg"},"articleBody":"实验答案托管在我的GitHub上\n\n总共花了五天时间完成了《深入理解计算机系统》(Computer Science A Programmer’s Perspective)的第一个Lab - Data Lab，深感这次实验的效率低下。一方面是由于清明假期自己有所惰怠，另一方面也是由于在做题的时候采取了不正确的方法，在已经明知不会的情况下我还继续投入大量无意义的时间，没有取得很好的学习效果。\n\n实验简介Data Lab - Manipulating Bits主要是关于位操作的实验，对应于书本的第2章：信息的表示和处理。\n在该实验中，学生主要需要在一个严格限制的C子集（使用优先的位运算符以及顺序结构的代码）中实现简单的逻辑，补码以及浮点数相关的函数。本实验的目的是为了让学生熟悉整数和浮点数的位级表示。\n本实验的核心在于在各种受限制的条件下完成给出的15个谜题。其中包括5个位操作的谜题，7个补码运算的谜题，以及3个浮点数操作的谜题。其中每完成一个谜题都能得到一定的分数，如果使用的运算符数目小于给定的数目，还能获得加分。本实验的满分是71分。可以通过讲义中的driver.pl脚本直接计算出总分数。\n关于本实验具体的介绍详见实验讲义。\n测试程序btest make失败及解决办法在完成实验的功能中需要用到make &amp;&amp; ./btest命令进行答案正确性的检查，结果系统返回了fetal error: gnu/stubs-32.h:No such file or directory。\n经过检查发现是系统是Archlinux 64位，而Makefile中包含了-m32的编译参数导致的。\n通过启用multilib仓库使得可以在64位的ArchLinux系统上编译和运行32位的程序，问题得以解决。\n编辑/etc/pacman.conf，取消下面内容的注释：\n12[multilib]include = /etc/pacman.d/mirrorlist\n更新软件包列表并升级系统pacman -Syu\n然后安装gcc-multilib并重新执行make &amp;&amp; ./btest，问题解决。\n实验限制整数代码规则整数代码应遵循如下的基本结构：12345678910int Funct(arg1, arg2, ...) &#123;    /* brief description of how your implementation works */    int var1 = Expr1;    ...    int varM = ExprM;    varJ = ExprJ;    ...    varN = ExprN;    return ExprR;&#125;\n每一个表达式只能使用：\n\n0～255之间的常量（包括0和255）\n函数的参数和局部变量\n单目运算符 ! ~\n双目运算符 &amp; ^ | + &lt;&lt; &gt;&gt;\n\n注意，部分题目对于运算符有着更加严格的限制，但是你可以在一行代码中使用多个运算符。\n你将会被禁止：\n\n使用任何的分支或者循环结构\n定义或者使用任何的宏\n在文件中定义任何额外函数\n调用任何函数\n使用任何其他的运算符\n使用任何形式的类型转换\n使用除了int以外的其他数据类型，这意味着你不能使用数组，结构或联合\n\n你可以假设你的机器：\n\n使用32位补码表示整数\n使用算术右移\n对整数进行的位移运算的位数超越了字长是未定义的行为\n\n浮点代码规则浮点运算的规则相对较为宽松，你可以使用循环或者是分支结构，你被允许同时使用int和unsigned，此外，你还可以使用任意的常量。\n你将会被禁止：\n\n定义或者使用任何的宏\n在文件中定义任何额外函数\n调用任何函数\n使用任何形式的类型转换\n使用除了int和unsigned以外的任何数据类型，这意味着你不能使用数组，结构或者联合\n使用任何浮点数的数据类型，操作或者是常量\n\n实验答案及分析第一部分 位操作\nbitAnd  问题：要求使用~和|以及不超过8个操作符实现x&amp;y  分析：使用De Morgan定律即可  答案：\n  1234int bitAnd(int x, int y) &#123;/* x&amp;y = ~(~(x&amp;y)) = ~(~x|~y) */\treturn ~(~x | ~y);&#125;\n\ngetByte  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过6个操作符返回x中的第n个字节(0(LSB)&lt;=n&lt;=3(MSB))。  分析：根据不同的n值将x右移不同的位数，然后使用掩码0xFF取得最低位数的字节即可。先左移再右移会导致算术右移，需要小心。  答案：\n  1234int getByte(int x, int n) &#123;/* right shift in order to avoid boring arithmatic shift and try to get specific byte using bitAnd and mask. */    return ((x &gt;&gt; (n &lt;&lt; 3)) &amp; 0xFF);\t\t&#125;\n\nlogicalShift  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过20个操作符实现将int值x的逻辑右移n位。  分析：通过将一个全1的数通过算术右移的方式构造掩码，然后与算术右移的掩码求按位与即可。  注意，直接右移32位的结果是未定义的，需要额外处理这种情况。  答案：\n  12345int logicalShift(int x, int n) &#123;/* try to implement logical right shift by mask and logical right shift */    int mask = ((~0) &lt;&lt; (31 + (~n + 1))) &lt;&lt; 1;    return (x &gt;&gt; n) &amp; (~mask);&#125;\n\nbitCount   问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过40个操作符计算一个数字x中有多少为1的位。   分析：   本题参考stackoverflow上的回答，并结合题目要求做了一些改动。   核心的思想是分治法，通过将原数字x中的位按每1,2,4…个位分组，按相邻组进行累加，最后求出结果。   举例来说，假如现在有一个数395，它的二进制表示是0000000110001011(16位)，首先我们将这个数按1位分组，得到：   0 0 0 0 0 0 0 1 1 0 0 0 1 0 1 1   然后我们将相邻的组累加，得到：   0+0 0+0 0+0 0+1 1+0 0+0 1+0 1+1   00 00 00 01 01 00 01 10   然后我们继续将相邻的组累加，得到：   00+00 00+01 01+00 01+10   0000 0001 0001 0011   然后我们继续将相邻的组累加，得到：   0000+0001 0001+0011   00000001 00000100   最后，我们最后的两个组累加，得到：   00000001+0000100=00000101   结果是5，为正确答案。   答案：\n   12345678910 int bitCount(int x) &#123;/* Divide and Conquer */    int mask = 0x55 + (0x55 &lt;&lt; 8) + (0x55 &lt;&lt; 16) + (0x55 &lt;&lt; 24);    x = (x &amp; mask) + ((x &gt;&gt; 1) &amp; mask);    mask = 0x33 + (0x33 &lt;&lt; 8) + (0x33 &lt;&lt; 16) + (0x33 &lt;&lt; 24);    x = (x &amp; mask) + ((x &gt;&gt; 2) &amp; mask);    mask = 0xF + (0xF &lt;&lt; 8) + (0xF &lt;&lt; 16) + (0xF &lt;&lt; 24);    x = (x &amp; mask) + ((x &gt;&gt; 4) &amp; mask);    return (x + (x &gt;&gt; 8) + (x &gt;&gt; 16) + (x &gt;&gt; 24)) &amp; 0xFF;&#125;\n\nbang  问题：要求使用~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过12个操作数计算x的逻辑非。  分析：  逻辑非要求将0变成1，将非0的数变成0。生成0或1可以通过与掩码0x1求按位与实现，重点在于如何构造一个表达式使得0和非0的数产生不同的结果。  可以考虑对于任意一个非0的数，它的负数都是从最高位到其最低位的1为止(不包括最低位的1)全部取反的结果。  例如，14是00001110(8位)，而-14是11110010(8位)，为14从最高位到最低位的1(不包括这个1)，也就是000011取反，而最低位的10不变的结果。  而0的负数永远是0。  从这里我们可以看出，对于一个非0的数，它与它的负数按位或的结果的最高位一定会是1，而0与非0的按位或的结果的最高位永远是0。我们可以以此实现逻辑非。  答案：\n  1234int bang(int x) &#123;/* for x != 0, the highest bit of x | (-x) will always become 1 while when x == 0, the result is the opposite */\treturn (~((x | (~x + 1)) &gt;&gt; 31) &amp; 1);&#125;\n\n\n第二部分 补码运算\ntmin  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过4个运算符返回以补码表示的最小的整数。  分析：根据补码到整数的公式，最小的整数的补码表示为10000…  答案：\n  1234int tmin(void) &#123;    /* TMin = 10000.... */    return (1 &lt;&lt; 31);&#125;\n\nfitsBits  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过15个操作符判断x是否能表示成n位的补码，如果是，则返回1，反之则返回0。  分析：  这个问题需要分正数和负数两种情况讨论，对于正数来说，如果一个数x能表示成n位的补码，那么它从最高位直到第n位一定全部为0，它的第n位一定不能为1，否则它就会变成一个负数。对于一个负数来说，如果一个数x能表示成n位的补码，那么它只需从最高位到第n位全部为1即可。  因此，我们可以先将x右移n-1位，对于满足条件的正数和负数，这将产生一个全0的数或是一个全1的数。然后我们可以根据x的符号构造一个全0或者是全1的掩码。通过将这两个数按位异或并且取逻辑非，就能得到正确的结果。  答案：\n  123456int fitsBits(int x, int n) &#123;/* if fitsBits then from highest bit to n bit will all become 1 - negative number or 0 - positive number * then can construct a mask to implement fitsBits with the help of ^ and ! */    return !((x &gt;&gt; (n + (~1) + 1)) ^ (((1 &lt;&lt; 31) &amp; x) &gt;&gt; 31));&#125;\n\ndivpwr2  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过15个操作符求出x/(2^n)的结果，其中0&lt;=n&lt;=30。  分析：对于正数，直接使用算术右移即可；对于负数，需要加上适当的偏移量以实现向上舍入，这可以用根据符号位生成1个全0或者全1的掩码来控制。  答案：\n  123456int divpwr2(int x, int n) &#123;/* add bias when x is negative, which is controlled by a sign-related mask */\tint mask = x &gt;&gt; 31;\tint add = ((1 &lt;&lt; n) + (~1) + 1) &amp; mask;\treturn (x + add) &gt;&gt; n;&#125;\n\nnegate  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过5个操作符求出x的负数。  分析：-x = (~x + 1)  答案：\n  1234int negate(int x) &#123;/* -x = (~x) + 1 */\treturn ~x + 1;&#125;\n\nisPositive  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过8个操作符判断x是否为正数。  分析：对于正数，它的最高位一定是0，同时还要排除0的影响。  答案：\n  1234int isPositive(int x) &#123;/* ensure the highest bit is 0 and x != 0 */\treturn (!(x &gt;&gt; 31)) ^ (!(x ^ 0));&#125;\n\nisLessOrEqual  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过24个操作符判断x是否小于或等于y。  分析：  对于这个问题，我们需要按照是否溢出，以及x与y的符号分别讨论。  最基本的思路是，做y-x，若结果的符号位为1，则返回0，反之返回1。但这样就忽略了溢出可能导致的问题，现在我们做如下考虑。  若x，y均为正数，或x，y均为负数，则y-x绝不可能溢出，因此可直接用差的符号位判断大小。  若x为正数，y为负数，可以直接返回0。  若x为负数，y为正数，可以直接返回1。  我们可以生成两种条件变量，一种为x，y同号时返回正确结果的条件变量，另一种为x，y异号时返回正确结果的条件变量。  对于x，y同号和异号这两种不同的情况，我们可以用!((x ^ y) &gt;&gt; 31)生成掩码使得在任意的情况下，只有正确的条件变量生效。  答案：\n  123456789int isLessOrEqual(int x, int y) &#123;/* different processing ways when x and y have the same signs or different signs */\tint diff = y + (~x) + 1;\tint not_diff_sign = !(diff &gt;&gt; 31);\tint mask = !((x ^ y) &gt;&gt; 31);\tint result_not_overflow = mask &amp; not_diff_sign;\tint result_overflow = (!mask) &amp; (x &gt;&gt; 31);\treturn result_overflow | result_not_overflow;&#125;\n\n\n\nilog2  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过90个操作数求出x以2为底的对数（向下舍入），保证x&gt;0。  分析：  这道题参考了网上的答案。核心的思想是二分查找。  首先将x右移16位，如果x&gt;0，则表明结果的第5位为1，将该位置为1。  然后根据结果将x右移8位（第5位为0）或者将x右移24位（第5位为1），如果x&gt;0，则表明结果的第4位为1，将该位置为1。  以此类推，直到得出结果。  答案：  123456789int ilog2(int x) &#123;\t/* Binary Search */\tint result = (!!(x &gt;&gt; 16) &lt;&lt; 4);\tresult = result + ((!!(x &gt;&gt; (result + 8))) &lt;&lt; 3);\tresult = result + ((!!(x &gt;&gt; (result + 4))) &lt;&lt; 2);\tresult = result + ((!!(x &gt;&gt; (result + 2))) &lt;&lt; 1);\tresult = result + (!!(x &gt;&gt; (result + 1)));\treturn result;&#125;\n\n\n第三部分 浮点数操作\nfloat_neg  问题：返回对于浮点数参数f，-f的等价的位级表示。当参数位NAN时，返回NAN。函数的参数和返回值均为unsigned，但它们实际上都是浮点数的位表示。最多允许使用10个操作符。  分析：首先要判断参数是否是NAN，如果是则直接返回，否的话直接将参数的最高位取反即可。  NAN的阶码全为1，尾码不全为0。  答案：\n  12345678910unsigned float_neg(unsigned uf) &#123;/* m_flag - if m != 0 e_flag - if e == 0xff */\tunsigned m_flag = 0x007fffff &amp; uf;\tunsigned e_flag = !(0x7f800000 &amp; (~uf));\tif (e_flag &amp;&amp; m_flag) &#123;\t\treturn uf;\t&#125; else &#123;\t\treturn 0x80000000 ^ uf;\t&#125;&#125;\n\nfloat_i2f  问题：返回(float)x的位级的等价表示。结果被作为unsigned int返回，但它实际上是单精度浮点数的位表示。最多允许使用30个操作符。  分析：  首先考虑到整数中只有0会被转换为非规格化浮点数，而其他整数会被转化为规格化浮点数。因此对于0需要做额外的处理。  其次，对于负数，我们需要将其转化为正数再做处理，这就要求我们需要将x的符号保存下来，并且从补码转化为无符号表示。  然后，我们需要根据转换成无符号数的x算出阶码e和尾码m。  最后，我们将尾码舍入后再和阶码符号一起，生成最终的结果即可。  这里我有一个比较大的误区，舍入的时候看的不仅仅是带舍入位的下一位，而是待舍入位之后的所有位。  答案：\n  1234567891011121314151617181920212223unsigned float_i2f(int x) &#123;/* 1.process 0 individually 2.process negative number and store the sign 3.get the e number 4.get the m number and round it 5.construct the result */\tunsigned count = 0;\tunsigned mask = 0x80000000;\tunsigned sign = x &amp; mask;\tunsigned c = 0, absx = x;\tif (x == 0) &#123;\t\treturn 0;\t&#125; else &#123;\t\tif (x &lt; 0) &#123;\t\t\tabsx = -x;\t\t&#125;\t\twhile (!(mask &amp; absx)) &#123;\t\t\tcount = count + 1;\t\t\tmask = mask &gt;&gt; 1;\t\t&#125;\t\tabsx = absx &lt;&lt; (count + 1);\t\tif (((absx &amp; 0x1ff) &gt; 0x100) || ((absx &amp; 0x3ff) &gt;= 0x300)) &#123;\t\t\tc = 1;\t\t&#125;\t\treturn sign + ((158 - count) &lt;&lt; 23) + (absx &gt;&gt; 9)+ c;\t&#125;&#125;\n\nfloat_twice  问题：返回对于浮点数参数f，2*f的等价的位级表示。参数和结果都为unsigned int，但它们实际上是浮点数的位表示。当参数是NAN时，返回NAN。最多允许使用30个操作符。  分析：  对于非规格化浮点数，只要在保留符号位的情况下将尾码m右移一位即可，这样同时解决了尾码乘以二和进位的情况。  对于规格化浮点数，只要将其阶码e加1即可。  答案：\n  12345678910unsigned float_twice(unsigned uf) &#123;/* denormailized number - m = m &lt;&lt; 1 normalized number - e = e + 1 */\tunsigned result = uf;\tif ((uf &amp; 0x7f800000) == 0) &#123;\t\tresult = ((uf &amp; 0x007fffff) &lt;&lt; 1) | (uf &amp; 0x80000000);\t&#125; else if ((uf &amp; 0x7f800000) != 0x7f800000) &#123;\t\tresult = uf + 0x00800000;\t&#125;\treturn result;&#125;\n\n\n","dateCreated":"2017-04-04T16:50:20+08:00","dateModified":"2018-05-15T17:22:23+08:00","datePublished":"2017-04-04T16:50:20+08:00","description":"","headline":"深入理解计算机系统DataLab实验报告","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/"},"publisher":{"@type":"Organization","name":"码龙黑曜","sameAs":["https://github.com/BlackDragonF","https://t.me/Cosidian","http://steamcommunity.com/id/BlackDragonF/","mailto:obsidiandragon2016@gmail.com"],"image":"avatar.jpg","logo":{"@type":"ImageObject","url":"avatar.jpg"}},"url":"http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/","keywords":"实验, 计算机系统"}</script>
    <meta name="description" content="实验答案托管在我的GitHub上  总共花了五天时间完成了《深入理解计算机系统》(Computer Science A Programmer’s Perspective)的第一个Lab - Data Lab，深感这次实验的效率低下。一方面是由于清明假期自己有所惰怠，另一方面也是由于在做题的时候采取了不正确的方法，在已经明知不会的情况下我还继续投入大量无意义的时间，没有取得很好的学习效果。  实验简">
<meta name="keywords" content="实验,计算机系统">
<meta property="og:type" content="blog">
<meta property="og:title" content="深入理解计算机系统DataLab实验报告">
<meta property="og:url" content="http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/index.html">
<meta property="og:site_name" content="码龙的窝">
<meta property="og:description" content="实验答案托管在我的GitHub上  总共花了五天时间完成了《深入理解计算机系统》(Computer Science A Programmer’s Perspective)的第一个Lab - Data Lab，深感这次实验的效率低下。一方面是由于清明假期自己有所惰怠，另一方面也是由于在做题的时候采取了不正确的方法，在已经明知不会的情况下我还继续投入大量无意义的时间，没有取得很好的学习效果。  实验简">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2018-05-15T09:22:23.827Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解计算机系统DataLab实验报告">
<meta name="twitter:description" content="实验答案托管在我的GitHub上  总共花了五天时间完成了《深入理解计算机系统》(Computer Science A Programmer’s Perspective)的第一个Lab - Data Lab，深感这次实验的效率低下。一方面是由于清明假期自己有所惰怠，另一方面也是由于在做题的时候采取了不正确的方法，在已经明知不会的情况下我还继续投入大量无意义的时间，没有取得很好的学习效果。  实验简">
    
    
        
    
    
        <meta property="og:image" content="http://blog.codedragon.tech/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-j4w0tbtf1olriqsnfyv4egntpbdblucqpyraoqqnvawa2vd6l4m8ljtn2yes.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-108458894-1', 'auto');
        ga('send', 'pageview');
    </script>


    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">码龙的窝</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">码龙黑曜</h4>
                
                    <h5 class="sidebar-profile-bio"><p>iOS开发者/计算机科学/兽人控</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="首页"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="分类"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="标签"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="归档"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/projects"
                            
                            title="项目"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-code" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">项目</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about"
                            
                            title="关于"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/BlackDragonF" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://t.me/Cosidian" target="_blank" rel="noopener" title="Telegram">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-telegram" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Telegram</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://steamcommunity.com/id/BlackDragonF/" target="_blank" rel="noopener" title="Steam">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-steam" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Steam</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:obsidiandragon2016@gmail.com" target="_blank" rel="noopener" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/links"
                            
                            title="友情链接"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-link" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">友情链接</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/resources"
                            
                            title="学习资源"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-share-alt" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">学习资源</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            深入理解计算机系统DataLab实验报告
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-04-04T16:50:20+08:00">
	
		    4月 04, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/计算机系统/">计算机系统</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>实验答案托管在我的<a href="https://github.com/BlackDragonF/CSAPPLabs/tree/master/DataLab" target="_blank" rel="noopener">GitHub</a>上</p>
<blockquote>
<p>总共花了五天时间完成了《深入理解计算机系统》(Computer Science A Programmer’s Perspective)的第一个Lab - Data Lab，深感这次实验的效率低下。一方面是由于清明假期自己有所惰怠，另一方面也是由于在做题的时候采取了不正确的方法，在已经明知不会的情况下我还继续投入大量无意义的时间，没有取得很好的学习效果。</p>
</blockquote>
<h2 id="实验简介"><a href="#实验简介" class="headerlink" title="实验简介"></a>实验简介</h2><p>Data Lab - Manipulating Bits主要是关于位操作的实验，对应于书本的第2章：信息的表示和处理。</p>
<p>在该实验中，学生主要需要在一个严格限制的C子集（使用优先的位运算符以及顺序结构的代码）中实现简单的逻辑，补码以及浮点数相关的函数。本实验的目的是为了让学生熟悉整数和浮点数的位级表示。</p>
<p>本实验的核心在于在各种受限制的条件下完成给出的15个谜题。其中包括5个位操作的谜题，7个补码运算的谜题，以及3个浮点数操作的谜题。其中每完成一个谜题都能得到一定的分数，如果使用的运算符数目小于给定的数目，还能获得加分。本实验的满分是71分。可以通过讲义中的driver.pl脚本直接计算出总分数。</p>
<p>关于本实验具体的介绍详见<a href="http://csapp.cs.cmu.edu/3e/datalab-handout.tar" target="_blank" rel="noopener">实验讲义</a>。</p>
<h2 id="测试程序btest-make失败及解决办法"><a href="#测试程序btest-make失败及解决办法" class="headerlink" title="测试程序btest make失败及解决办法"></a>测试程序btest make失败及解决办法</h2><p>在完成实验的功能中需要用到<code>make &amp;&amp; ./btest</code>命令进行答案正确性的检查，结果系统返回了<code>fetal error: gnu/stubs-32.h:No such file or directory</code>。</p>
<p>经过检查发现是系统是Archlinux 64位，而Makefile中包含了-m32的编译参数导致的。</p>
<p>通过启用multilib仓库使得可以在64位的ArchLinux系统上编译和运行32位的程序，问题得以解决。</p>
<p>编辑/etc/pacman.conf，取消下面内容的注释：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[multilib]</span><br><span class="line">include = /etc/pacman.d/mirrorlist</span><br></pre></td></tr></table></figure>
<p>更新软件包列表并升级系统<code>pacman -Syu</code></p>
<p>然后安装gcc-multilib并重新执行<code>make &amp;&amp; ./btest</code>，问题解决。</p>
<h2 id="实验限制"><a href="#实验限制" class="headerlink" title="实验限制"></a>实验限制</h2><h3 id="整数代码规则"><a href="#整数代码规则" class="headerlink" title="整数代码规则"></a>整数代码规则</h3><p>整数代码应遵循如下的基本结构：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Funct</span><span class="params">(arg1, arg2, ...)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* brief description of how your implementation works */</span></span><br><span class="line">    <span class="keyword">int</span> var1 = Expr1;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">int</span> varM = ExprM;</span><br><span class="line">    varJ = ExprJ;</span><br><span class="line">    ...</span><br><span class="line">    varN = ExprN;</span><br><span class="line">    <span class="keyword">return</span> ExprR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>每一个表达式只能使用：</p>
<ol>
<li>0～255之间的常量（包括0和255）</li>
<li>函数的参数和局部变量</li>
<li>单目运算符 ! ~</li>
<li>双目运算符 &amp; ^ | + &lt;&lt; &gt;&gt;</li>
</ol>
<p>注意，部分题目对于运算符有着更加严格的限制，但是你可以在一行代码中使用多个运算符。</p>
<p>你将会被禁止：</p>
<ol>
<li>使用任何的分支或者循环结构</li>
<li>定义或者使用任何的宏</li>
<li>在文件中定义任何额外函数</li>
<li>调用任何函数</li>
<li>使用任何其他的运算符</li>
<li>使用任何形式的类型转换</li>
<li>使用除了int以外的其他数据类型，这意味着你不能使用数组，结构或联合</li>
</ol>
<p>你可以假设你的机器：</p>
<ol>
<li>使用32位补码表示整数</li>
<li>使用算术右移</li>
<li>对整数进行的位移运算的位数超越了字长是未定义的行为</li>
</ol>
<h3 id="浮点代码规则"><a href="#浮点代码规则" class="headerlink" title="浮点代码规则"></a>浮点代码规则</h3><p>浮点运算的规则相对较为宽松，你可以使用循环或者是分支结构，你被允许同时使用int和unsigned，此外，你还可以使用任意的常量。</p>
<p>你将会被禁止：</p>
<ol>
<li>定义或者使用任何的宏</li>
<li>在文件中定义任何额外函数</li>
<li>调用任何函数</li>
<li>使用任何形式的类型转换</li>
<li>使用除了int和unsigned以外的任何数据类型，这意味着你不能使用数组，结构或者联合</li>
<li>使用任何浮点数的数据类型，操作或者是常量</li>
</ol>
<h2 id="实验答案及分析"><a href="#实验答案及分析" class="headerlink" title="实验答案及分析"></a>实验答案及分析</h2><h3 id="第一部分-位操作"><a href="#第一部分-位操作" class="headerlink" title="第一部分 位操作"></a>第一部分 位操作</h3><ul>
<li><p>bitAnd<br>  问题：要求使用~和|以及不超过8个操作符实现x&amp;y<br>  分析：使用De Morgan定律即可<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitAnd</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* x&amp;y = ~(~(x&amp;y)) = ~(~x|~y) */</span></span><br><span class="line">	<span class="keyword">return</span> ~(~x | ~y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>getByte<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过6个操作符返回x中的第n个字节(0(LSB)&lt;=n&lt;=3(MSB))。<br>  分析：根据不同的n值将x右移不同的位数，然后使用掩码0xFF取得最低位数的字节即可。先左移再右移会导致算术右移，需要小心。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getByte</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* right shift in order to avoid boring arithmatic shift and try to get specific byte using bitAnd and mask. */</span></span><br><span class="line">    <span class="keyword">return</span> ((x &gt;&gt; (n &lt;&lt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span>);		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>logicalShift<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过20个操作符实现将int值x的逻辑右移n位。<br>  分析：通过将一个全1的数通过算术右移的方式构造掩码，然后与算术右移的掩码求按位与即可。<br>  注意，直接右移32位的结果是未定义的，需要额外处理这种情况。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">logicalShift</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* try to implement logical right shift by mask and logical right shift */</span></span><br><span class="line">    <span class="keyword">int</span> mask = ((~<span class="number">0</span>) &lt;&lt; (<span class="number">31</span> + (~n + <span class="number">1</span>))) &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (x &gt;&gt; n) &amp; (~mask);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>bitCount<br>   问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过40个操作符计算一个数字x中有多少为1的位。<br>   分析：<br>   本题参考<a href="http://stackoverflow.com/questions/3815165/how-to-implement-bitcount-using-only-bitwise-operators" target="_blank" rel="noopener">stackoverflow</a>上的回答，并结合题目要求做了一些改动。<br>   核心的思想是分治法，通过将原数字x中的位按每1,2,4…个位分组，按相邻组进行累加，最后求出结果。<br>   举例来说，假如现在有一个数395，它的二进制表示是0000000110001011(16位)，首先我们将这个数按1位分组，得到：<br>   0 0 0 0 0 0 0 1 1 0 0 0 1 0 1 1<br>   然后我们将相邻的组累加，得到：<br>   0+0 0+0 0+0 0+1 1+0 0+0 1+0 1+1<br>   00 00 00 01 01 00 01 10<br>   然后我们继续将相邻的组累加，得到：<br>   00+00 00+01 01+00 01+10<br>   0000 0001 0001 0011<br>   然后我们继续将相邻的组累加，得到：<br>   0000+0001 0001+0011<br>   00000001 00000100<br>   最后，我们最后的两个组累加，得到：<br>   00000001+0000100=00000101<br>   结果是5，为正确答案。<br>   答案：</p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">int</span> <span class="title">bitCount</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* Divide and Conquer */</span></span><br><span class="line">    <span class="keyword">int</span> mask = <span class="number">0x55</span> + (<span class="number">0x55</span> &lt;&lt; <span class="number">8</span>) + (<span class="number">0x55</span> &lt;&lt; <span class="number">16</span>) + (<span class="number">0x55</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">    x = (x &amp; mask) + ((x &gt;&gt; <span class="number">1</span>) &amp; mask);</span><br><span class="line">    mask = <span class="number">0x33</span> + (<span class="number">0x33</span> &lt;&lt; <span class="number">8</span>) + (<span class="number">0x33</span> &lt;&lt; <span class="number">16</span>) + (<span class="number">0x33</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">    x = (x &amp; mask) + ((x &gt;&gt; <span class="number">2</span>) &amp; mask);</span><br><span class="line">    mask = <span class="number">0xF</span> + (<span class="number">0xF</span> &lt;&lt; <span class="number">8</span>) + (<span class="number">0xF</span> &lt;&lt; <span class="number">16</span>) + (<span class="number">0xF</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">    x = (x &amp; mask) + ((x &gt;&gt; <span class="number">4</span>) &amp; mask);</span><br><span class="line">    <span class="keyword">return</span> (x + (x &gt;&gt; <span class="number">8</span>) + (x &gt;&gt; <span class="number">16</span>) + (x &gt;&gt; <span class="number">24</span>)) &amp; <span class="number">0xFF</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>bang<br>  问题：要求使用~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过12个操作数计算x的逻辑非。<br>  分析：<br>  逻辑非要求将0变成1，将非0的数变成0。生成0或1可以通过与掩码0x1求按位与实现，重点在于如何构造一个表达式使得0和非0的数产生不同的结果。<br>  可以考虑对于任意一个非0的数，它的负数都是从最高位到其最低位的1为止(不包括最低位的1)全部取反的结果。<br>  例如，14是00001110(8位)，而-14是11110010(8位)，为14从最高位到最低位的1(不包括这个1)，也就是000011取反，而最低位的10不变的结果。<br>  而0的负数永远是0。<br>  从这里我们可以看出，对于一个非0的数，它与它的负数按位或的结果的最高位一定会是1，而0与非0的按位或的结果的最高位永远是0。我们可以以此实现逻辑非。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bang</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* for x != 0, the highest bit of x | (-x) will always become 1 while when x == 0, the result is the opposite */</span></span><br><span class="line">	<span class="keyword">return</span> (~((x | (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>) &amp; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="第二部分-补码运算"><a href="#第二部分-补码运算" class="headerlink" title="第二部分 补码运算"></a>第二部分 补码运算</h3><ul>
<li><p>tmin<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过4个运算符返回以补码表示的最小的整数。<br>  分析：根据补码到整数的公式，最小的整数的补码表示为10000…<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* TMin = 10000.... */</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="number">1</span> &lt;&lt; <span class="number">31</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>fitsBits<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过15个操作符判断x是否能表示成n位的补码，如果是，则返回1，反之则返回0。<br>  分析：<br>  这个问题需要分正数和负数两种情况讨论，对于正数来说，如果一个数x能表示成n位的补码，那么它从最高位直到第n位一定全部为0，它的第n位一定不能为1，否则它就会变成一个负数。对于一个负数来说，如果一个数x能表示成n位的补码，那么它只需从最高位到第n位全部为1即可。<br>  因此，我们可以先将x右移n-1位，对于满足条件的正数和负数，这将产生一个全0的数或是一个全1的数。然后我们可以根据x的符号构造一个全0或者是全1的掩码。通过将这两个数按位异或并且取逻辑非，就能得到正确的结果。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fitsBits</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* if fitsBits then from highest bit to n bit will all become 1 - negative number or 0 - positive number</span></span><br><span class="line"><span class="comment"> * then can construct a mask to implement fitsBits with the help of ^ and !</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="keyword">return</span> !((x &gt;&gt; (n + (~<span class="number">1</span>) + <span class="number">1</span>)) ^ (((<span class="number">1</span> &lt;&lt; <span class="number">31</span>) &amp; x) &gt;&gt; <span class="number">31</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>divpwr2<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过15个操作符求出x/(2^n)的结果，其中0&lt;=n&lt;=30。<br>  分析：对于正数，直接使用算术右移即可；对于负数，需要加上适当的偏移量以实现向上舍入，这可以用根据符号位生成1个全0或者全1的掩码来控制。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">divpwr2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* add bias when x is negative, which is controlled by a sign-related mask */</span></span><br><span class="line">	<span class="keyword">int</span> mask = x &gt;&gt; <span class="number">31</span>;</span><br><span class="line">	<span class="keyword">int</span> add = ((<span class="number">1</span> &lt;&lt; n) + (~<span class="number">1</span>) + <span class="number">1</span>) &amp; mask;</span><br><span class="line">	<span class="keyword">return</span> (x + add) &gt;&gt; n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>negate<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过5个操作符求出x的负数。<br>  分析：-x = (~x + 1)<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* -x = (~x) + 1 */</span></span><br><span class="line">	<span class="keyword">return</span> ~x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>isPositive<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过8个操作符判断x是否为正数。<br>  分析：对于正数，它的最高位一定是0，同时还要排除0的影响。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isPositive</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* ensure the highest bit is 0 and x != 0 */</span></span><br><span class="line">	<span class="keyword">return</span> (!(x &gt;&gt; <span class="number">31</span>)) ^ (!(x ^ <span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>isLessOrEqual<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过24个操作符判断x是否小于或等于y。<br>  分析：<br>  对于这个问题，我们需要按照是否溢出，以及x与y的符号分别讨论。<br>  最基本的思路是，做y-x，若结果的符号位为1，则返回0，反之返回1。但这样就忽略了溢出可能导致的问题，现在我们做如下考虑。<br>  若x，y均为正数，或x，y均为负数，则y-x绝不可能溢出，因此可直接用差的符号位判断大小。<br>  若x为正数，y为负数，可以直接返回0。<br>  若x为负数，y为正数，可以直接返回1。<br>  我们可以生成两种条件变量，一种为x，y同号时返回正确结果的条件变量，另一种为x，y异号时返回正确结果的条件变量。<br>  对于x，y同号和异号这两种不同的情况，我们可以用!((x ^ y) &gt;&gt; 31)生成掩码使得在任意的情况下，只有正确的条件变量生效。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* different processing ways when x and y have the same signs or different signs */</span></span><br><span class="line">	<span class="keyword">int</span> diff = y + (~x) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> not_diff_sign = !(diff &gt;&gt; <span class="number">31</span>);</span><br><span class="line">	<span class="keyword">int</span> mask = !((x ^ y) &gt;&gt; <span class="number">31</span>);</span><br><span class="line">	<span class="keyword">int</span> result_not_overflow = mask &amp; not_diff_sign;</span><br><span class="line">	<span class="keyword">int</span> result_overflow = (!mask) &amp; (x &gt;&gt; <span class="number">31</span>);</span><br><span class="line">	<span class="keyword">return</span> result_overflow | result_not_overflow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>ilog2<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过90个操作数求出x以2为底的对数（向下舍入），保证x&gt;0。<br>  分析：<br>  这道题参考了网上的答案。核心的思想是二分查找。<br>  首先将x右移16位，如果x&gt;0，则表明结果的第5位为1，将该位置为1。<br>  然后根据结果将x右移8位（第5位为0）或者将x右移24位（第5位为1），如果x&gt;0，则表明结果的第4位为1，将该位置为1。<br>  以此类推，直到得出结果。<br>  答案：  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ilog2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* Binary Search */</span></span><br><span class="line">	<span class="keyword">int</span> result = (!!(x &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">4</span>);</span><br><span class="line">	result = result + ((!!(x &gt;&gt; (result + <span class="number">8</span>))) &lt;&lt; <span class="number">3</span>);</span><br><span class="line">	result = result + ((!!(x &gt;&gt; (result + <span class="number">4</span>))) &lt;&lt; <span class="number">2</span>);</span><br><span class="line">	result = result + ((!!(x &gt;&gt; (result + <span class="number">2</span>))) &lt;&lt; <span class="number">1</span>);</span><br><span class="line">	result = result + (!!(x &gt;&gt; (result + <span class="number">1</span>)));</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="第三部分-浮点数操作"><a href="#第三部分-浮点数操作" class="headerlink" title="第三部分 浮点数操作"></a>第三部分 浮点数操作</h3><ul>
<li><p>float_neg<br>  问题：返回对于浮点数参数f，-f的等价的位级表示。当参数位NAN时，返回NAN。函数的参数和返回值均为unsigned，但它们实际上都是浮点数的位表示。最多允许使用10个操作符。<br>  分析：首先要判断参数是否是NAN，如果是则直接返回，否的话直接将参数的最高位取反即可。<br>  NAN的阶码全为1，尾码不全为0。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">float_neg</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* m_flag - if m != 0 e_flag - if e == 0xff */</span></span><br><span class="line">	<span class="keyword">unsigned</span> m_flag = <span class="number">0x007fffff</span> &amp; uf;</span><br><span class="line">	<span class="keyword">unsigned</span> e_flag = !(<span class="number">0x7f800000</span> &amp; (~uf));</span><br><span class="line">	<span class="keyword">if</span> (e_flag &amp;&amp; m_flag) &#123;</span><br><span class="line">		<span class="keyword">return</span> uf;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0x80000000</span> ^ uf;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>float_i2f<br>  问题：返回(float)x的位级的等价表示。结果被作为unsigned int返回，但它实际上是单精度浮点数的位表示。最多允许使用30个操作符。<br>  分析：<br>  首先考虑到整数中只有0会被转换为非规格化浮点数，而其他整数会被转化为规格化浮点数。因此对于0需要做额外的处理。<br>  其次，对于负数，我们需要将其转化为正数再做处理，这就要求我们需要将x的符号保存下来，并且从补码转化为无符号表示。<br>  然后，我们需要根据转换成无符号数的x算出阶码e和尾码m。<br>  最后，我们将尾码舍入后再和阶码符号一起，生成最终的结果即可。<br>  这里我有一个比较大的误区，舍入的时候看的不仅仅是带舍入位的下一位，而是待舍入位之后的所有位。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">float_i2f</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* 1.process 0 individually 2.process negative number and store the sign 3.get the e number 4.get the m number and round it 5.construct the result */</span></span><br><span class="line">	<span class="keyword">unsigned</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> mask = <span class="number">0x80000000</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> sign = x &amp; mask;</span><br><span class="line">	<span class="keyword">unsigned</span> c = <span class="number">0</span>, absx = x;</span><br><span class="line">	<span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			absx = -x;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (!(mask &amp; absx)) &#123;</span><br><span class="line">			count = count + <span class="number">1</span>;</span><br><span class="line">			mask = mask &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		absx = absx &lt;&lt; (count + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span> (((absx &amp; <span class="number">0x1ff</span>) &gt; <span class="number">0x100</span>) || ((absx &amp; <span class="number">0x3ff</span>) &gt;= <span class="number">0x300</span>)) &#123;</span><br><span class="line">			c = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sign + ((<span class="number">158</span> - count) &lt;&lt; <span class="number">23</span>) + (absx &gt;&gt; <span class="number">9</span>)+ c;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>float_twice<br>  问题：返回对于浮点数参数f，2*f的等价的位级表示。参数和结果都为unsigned int，但它们实际上是浮点数的位表示。当参数是NAN时，返回NAN。最多允许使用30个操作符。<br>  分析：<br>  对于非规格化浮点数，只要在保留符号位的情况下将尾码m右移一位即可，这样同时解决了尾码乘以二和进位的情况。<br>  对于规格化浮点数，只要将其阶码e加1即可。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">float_twice</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</span><br><span class="line"><span class="comment">/* denormailized number - m = m &lt;&lt; 1 normalized number - e = e + 1 */</span></span><br><span class="line">	<span class="keyword">unsigned</span> result = uf;</span><br><span class="line">	<span class="keyword">if</span> ((uf &amp; <span class="number">0x7f800000</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">		result = ((uf &amp; <span class="number">0x007fffff</span>) &lt;&lt; <span class="number">1</span>) | (uf &amp; <span class="number">0x80000000</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((uf &amp; <span class="number">0x7f800000</span>) != <span class="number">0x7f800000</span>) &#123;</span><br><span class="line">		result = uf + <span class="number">0x00800000</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/实验/">实验</a> <a class="tag tag--primary tag--small t-link" href="/tags/计算机系统/">计算机系统</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/18/深入理解计算机系统BombLab实验报告/" data-tooltip="深入理解计算机系统BombLab实验报告" aria-label="上一篇: 深入理解计算机系统BombLab实验报告">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/03/10/王爽汇编语言第三版综合研究结论/" data-tooltip="王爽汇编语言第三版综合研究结论" aria-label="下一篇: 王爽汇编语言第三版综合研究结论">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Facebook">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Twitter">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Weibo">
                    <i class="fa fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/&amp;title=深入理解计算机系统DataLab实验报告" title="分享到 QQ">
                    <i class="fa fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Qzone">
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 码龙黑曜. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/18/深入理解计算机系统BombLab实验报告/" data-tooltip="深入理解计算机系统BombLab实验报告" aria-label="上一篇: 深入理解计算机系统BombLab实验报告">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/03/10/王爽汇编语言第三版综合研究结论/" data-tooltip="王爽汇编语言第三版综合研究结论" aria-label="下一篇: 王爽汇编语言第三版综合研究结论">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Facebook">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Twitter">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Weibo">
                    <i class="fa fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/&amp;title=深入理解计算机系统DataLab实验报告" title="分享到 QQ">
                    <i class="fa fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/" title="分享到 Qzone">
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i><span>分享到 Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/">
                    <i class="fa fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/">
                    <i class="fa fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/&amp;title=深入理解计算机系统DataLab实验报告">
                    <i class="fa fa-qq" aria-hidden="true"></i><span>分享到 QQ</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codedragon.tech/2017/04/04/深入理解计算机系统DataLab实验报告/">
                    <i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
            <h4 id="about-card-name">码龙黑曜</h4>
        
            <div id="about-card-bio"><p>iOS开发者/计算机科学/兽人控</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>华中科技大学 本科在读</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Wuhan, China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-feiabjni254mgbxiozwsjblcsiodjqohurk0dcfkq0aooroewq6bvkdnadrg.min.js"></script>
<!--SCRIPTS END-->

    



    </body>
</html>
