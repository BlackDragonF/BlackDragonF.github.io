
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="码龙的窝">
    <title>深入理解计算机系统BombLab实验报告 - 码龙的窝</title>
    <meta name="author" content="码龙黑曜">
    
        <meta name="keywords" content="博客,iOS,Computer Science,码龙,">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"码龙黑曜","sameAs":["https://github.com/BlackDragonF","https://t.me/Cosidian","http://steamcommunity.com/id/BlackDragonF/","mailto:obsidiandragon2016@gmail.com"],"image":"avatar.jpg"},"articleBody":"实验答案托管在我的Github上\n\n用了一周的时间读完了《深入理解计算机系统》的第三章：程序的机器级表示。对于x86_64汇编及其逆向工程有了一定的了解。于2017年4月16日完成了其第二个Lab - Bomb Lab.\n\n实验简介Bomb Lab - Defusing a Binary Bomb主要是关于反汇编的实验，对应于书本的第三章：程序的机器级表示。\n本实验非常的有趣。实验给定了一个二进制程序Bomb（炸弹）。这个炸弹由若干阶段组成，每个阶段都要求你在标准输入流中输入一个字符串，如果字符串正确，那么该阶段就会被解除并且程序会进入下一个阶段。如果字符串错误，那么炸弹会爆炸，并且退出。当每个阶段都被解除后，整个炸弹将会被解除。\n在正式的实验中，每个学生将会从服务器处得到一个独一无二的炸弹，解除每个炸弹所需要的字符串都是不同的。同时，引爆炸弹将会导致扣分。当实验结束后，可以从服务器的计分板上看到每个学生的成绩。本实验主要要求学生能够理解汇编代码，同时要求学生能学会使用一个Debugger（调试器）。\n本实验提供的答案仅针对官网给出的自学者讲义中的炸弹。\n实验提示\n学会使用一个debugger（调试器），在本次实验中，使用GDB - GNU Debugger\n使用objdump -t得到bomb的符号表。符号表包含了bomb中所有函数，全局变量，以及调用的函数的名字及地址。\n使用objdump -d得到bomb的反汇编结果。但是注意，系统级别的函数调用将会以被加密的形式出现在反汇编代码中，如果需要知道这些信息，需要在gdb中对相应的函数进行反汇编。\n\n实验过程及分析实验准备\n熟悉GDB的使用，并且使用objdump -t bomb &gt; bomb-symboltable生成bomb的符号表，再使用objdump -d bomb &gt; bomb-disassemble生成bomb的反汇编文件。\n确保即时输入了错误的字符串炸弹也不会爆炸。观察bomb的符号表可以发现函数explode_bomb，推测该函数的作用是引爆炸弹，因此在GDB中使用break explode_bomb为该函数添加断点。这样，我们可以在bomb爆炸前提前截获并处理。\n观察符号表可以看到phase_1到phase_6这几个函数以及其他的相关辅助函数，我们要做的就是给每一个阶段的函数添加断点，反汇编，并且理解这些函数的作用，并推测出答案。\n\n实验过程主函数 - main首先在bomb-disassemble中观察main的反汇编代码，如下：1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071720000000000400da0 &lt;main&gt;:  400da0:       53                      push   %rbx  400da1:       83 ff 01                cmp    $0x1,%edi  400da4:       75 10                   jne    400db6 &lt;main+0x16&gt;  400da6:       48 8b 05 9b 29 20 00    mov    0x20299b(%rip),%rax        # 603748 &lt;stdin@@GLIBC_2.2.5&gt;  400dad:       48 89 05 b4 29 20 00    mov    %rax,0x2029b4(%rip)        # 603768 &lt;infile&gt;  400db4:       eb 63                   jmp    400e19 &lt;main+0x79&gt;  400db6:       48 89 f3                mov    %rsi,%rbx  400db9:       83 ff 02                cmp    $0x2,%edi  400dbc:       75 3a                   jne    400df8 &lt;main+0x58&gt;  400dbe:       48 8b 7e 08             mov    0x8(%rsi),%rdi  400dc2:       be b4 22 40 00          mov    $0x4022b4,%esi  400dc7:       e8 44 fe ff ff          callq  400c10 &lt;fopen@plt&gt;  400dcc:       48 89 05 95 29 20 00    mov    %rax,0x202995(%rip)        # 603768 &lt;infile&gt;  400dd3:       48 85 c0                test   %rax,%rax  400dd6:       75 41                   jne    400e19 &lt;main+0x79&gt;  400dd8:       48 8b 4b 08             mov    0x8(%rbx),%rcx  400ddc:       48 8b 13                mov    (%rbx),%rdx  400ddf:       be b6 22 40 00          mov    $0x4022b6,%esi  400de4:       bf 01 00 00 00          mov    $0x1,%edi  400de9:       e8 12 fe ff ff          callq  400c00 &lt;__printf_chk@plt&gt;  400dee:       bf 08 00 00 00          mov    $0x8,%edi  400df3:       e8 28 fe ff ff          callq  400c20 &lt;exit@plt&gt;  400df8:       48 8b 16                mov    (%rsi),%rdx  400dfb:       be d3 22 40 00          mov    $0x4022d3,%esi  400e00:       bf 01 00 00 00          mov    $0x1,%edi  400e05:       b8 00 00 00 00          mov    $0x0,%eax  400e0a:       e8 f1 fd ff ff          callq  400c00 &lt;__printf_chk@plt&gt;  400e0f:       bf 08 00 00 00          mov    $0x8,%edi  400e14:       e8 07 fe ff ff          callq  400c20 &lt;exit@plt&gt;  400e19:       e8 84 05 00 00          callq  4013a2 &lt;initialize_bomb&gt;  400e1e:       bf 38 23 40 00          mov    $0x402338,%edi  400e23:       e8 e8 fc ff ff          callq  400b10 &lt;puts@plt&gt;  400e28:       bf 78 23 40 00          mov    $0x402378,%edi  400e2d:       e8 de fc ff ff          callq  400b10 &lt;puts@plt&gt;  400e32:       e8 67 06 00 00          callq  40149e &lt;read_line&gt;  400e37:       48 89 c7                mov    %rax,%rdi  400e3a:       e8 a1 00 00 00          callq  400ee0 &lt;phase_1&gt;  400e3f:       e8 80 07 00 00          callq  4015c4 &lt;phase_defused&gt;  400e44:       bf a8 23 40 00          mov    $0x4023a8,%edi  400e49:       e8 c2 fc ff ff          callq  400b10 &lt;puts@plt&gt;  400e4e:       e8 4b 06 00 00          callq  40149e &lt;read_line&gt;  400e53:       48 89 c7                mov    %rax,%rdi  400e56:       e8 a1 00 00 00          callq  400efc &lt;phase_2&gt;  400e5b:       e8 64 07 00 00          callq  4015c4 &lt;phase_defused&gt;  400e60:       bf ed 22 40 00          mov    $0x4022ed,%edi  400e65:       e8 a6 fc ff ff          callq  400b10 &lt;puts@plt&gt;  400e6a:       e8 2f 06 00 00          callq  40149e &lt;read_line&gt;  400e6f:       48 89 c7                mov    %rax,%rdi  400e72:       e8 cc 00 00 00          callq  400f43 &lt;phase_3&gt;  400e77:       e8 48 07 00 00          callq  4015c4 &lt;phase_defused&gt;  400e7c:       bf 0b 23 40 00          mov    $0x40230b,%edi  400e81:       e8 8a fc ff ff          callq  400b10 &lt;puts@plt&gt;  400e86:       e8 13 06 00 00          callq  40149e &lt;read_line&gt;  400e8b:       48 89 c7                mov    %rax,%rdi  400e8e:       e8 79 01 00 00          callq  40100c &lt;phase_4&gt;  400e93:       e8 2c 07 00 00          callq  4015c4 &lt;phase_defused&gt;  400e98:       bf d8 23 40 00          mov    $0x4023d8,%edi  400e9d:       e8 6e fc ff ff          callq  400b10 &lt;puts@plt&gt;  400ea2:       e8 f7 05 00 00          callq  40149e &lt;read_line&gt;  400ea7:       48 89 c7                mov    %rax,%rdi  400eaa:       e8 b3 01 00 00          callq  401062 &lt;phase_5&gt;  400eaf:       e8 10 07 00 00          callq  4015c4 &lt;phase_defused&gt;  400eb4:       bf 1a 23 40 00          mov    $0x40231a,%edi  400eb9:       e8 52 fc ff ff          callq  400b10 &lt;puts@plt&gt;  400ebe:       e8 db 05 00 00          callq  40149e &lt;read_line&gt;  400ec3:       48 89 c7                mov    %rax,%rdi  400ec6:       e8 29 02 00 00          callq  4010f4 &lt;phase_6&gt;  400ecb:       e8 f4 06 00 00          callq  4015c4 &lt;phase_defused&gt;  400ed0:       b8 00 00 00 00          mov    $0x0,%eax  400ed5:       5b                      pop    %rbx  400ed6:       c3                      retq   结合讲义中的bomb.c可以得出，main函数每次调用read_line从标准输入流中读入一行字符串，并将其返回值（即字符串的首地址）设置为第一个参数，然后依次调用phase_1到phase_6。\n在每一个phase函数内部检查输入的字符串是否正确，如果不正确，则调用explode_bomb函数引爆bomb；否则则返回，返回之后由主函数再继续调用phase_defused解除该阶段。\n因此，在每一个阶段中，我们关注的重点应当是phase函数内部以及phase函数所调用的其他函数。\n阶段1 - phase_1在bomb-disassemble中观察phase_1的反汇编代码，如下：1234567890000000000400ee0 &lt;phase_1&gt;:  400ee0:       48 83 ec 08             sub    $0x8,%rsp  400ee4:       be 00 24 40 00          mov    $0x402400,%esi #设置第二个参数为指针  400ee9:       e8 4a 04 00 00          callq  401338 &lt;strings_not_equal&gt; #调用strings_not_equal函数  400eee:       85 c0                   test   %eax,%eax  400ef0:       74 05                   je     400ef7 &lt;phase_1+0x17&gt;  400ef2:       e8 43 05 00 00          callq  40143a &lt;explode_bomb&gt; #若返回值不为0则引爆bomb  400ef7:       48 83 c4 08             add    $0x8,%rsp  400efb:       c3                      retq  可以看出，phase_1调用了strings_not_equal这个函数，并为该函数配置了第二个参数0x402400，并判断该函数的返回值是否为0，如果为0则返回，否则引爆bomb。\n从函数名可以推测，该函数的作用是判断两个字符串是否不相同，如果不相同，则返回非0值，相同则返回0。\n还可以推测，该函数的第一个参数%rdi中存放了我们输入的字符串的首地址，而第二个参数%rsi指向了待比较的字符串的首地址——也就是阶段1的答案。\n下面在GDB中验证推测。使用GDB运行bomb，为phase_1和explode_bomb添加断点。然后输入测试字符串”Test”，进入phase_1后用print分别打印输出%rdi和%rsi所指向的字符串。\n首先是设置断点的相关命令及结果：1234(gdb) break explode_bombBreakpoint 1 at 0x40143a(gdb) break phase_1Breakpoint 2 at 0x400ee0然后是运行程序及输入测试字符串的相关命令及结果：1234567(gdb) runStarting program: /home/blackdragon/CSAPPLabs/BombLab/bombWelcome to my fiendish little bomb. You have 6 phases withwhich to blow yourself up. Have a nice day!TestBreakpoint 2, 0x0000000000400ee0 in phase_1 ()然后我们查看%rdi所指向的字符串：12(gdb) print (char *)($rdi)$1 = 0x603780 &lt;input_strings&gt; \"Test\"发现%rdi果然指向了我们输入的字符串。然后我们单步执行程序至调用strings_not_equal函数之前，查看%rsi所指向的字符串：12(gdb) print (char *)($rsi)$2 = 0x402400 &quot;Border relations with Canada have never been better.&quot;我们已经得到了phase_1的答案，就是”Border relations with Canada have never been better.”\n下面我们重新执行bomb并测试，输出”Phase 1 defused. How about the next one?”，phase_1解决。\n阶段2 - phase_2在bomb-disassemble中观察phase_2的反汇编代码，如下：123456789101112131415161718192021222324252627280000000000400efc &lt;phase_2&gt;:  400efc:       55                      push   %rbp  400efd:       53                      push   %rbx  400efe:       48 83 ec 28             sub    $0x28,%rsp  400f02:       48 89 e6                mov    %rsp,%rsi  400f05:       e8 52 05 00 00          callq  40145c &lt;read_six_numbers&gt; #从输入的字符串中读入6个数字  400f0a:       83 3c 24 01             cmpl   $0x1,(%rsp)  400f0e:       74 20                   je     400f30 &lt;phase_2+0x34&gt;  400f10:       e8 25 05 00 00          callq  40143a &lt;explode_bomb&gt; #如果第一个数字不为1则引爆炸弹  400f15:       eb 19                   jmp    400f30 &lt;phase_2+0x34&gt;  400f17:       8b 43 fc                mov    -0x4(%rbx),%eax  400f1a:       01 c0                   add    %eax,%eax  # 计算前一个元素*2  400f1c:       39 03                   cmp    %eax,(%rbx)  400f1e:       74 05                   je     400f25 &lt;phase_2+0x29&gt;  400f20:       e8 15 05 00 00          callq  40143a &lt;explode_bomb&gt; #若当前元素不等于前一个元素*2则引爆bomb  400f25:       48 83 c3 04             add    $0x4,%rbx  400f29:       48 39 eb                cmp    %rbp,%rbx  400f2c:       75 e9                   jne    400f17 &lt;phase_2+0x1b&gt;  # 指向下一个元素  400f2e:       eb 0c                   jmp    400f3c &lt;phase_2+0x40&gt;  400f30:       48 8d 5c 24 04          lea    0x4(%rsp),%rbx  400f35:       48 8d 6c 24 18          lea    0x18(%rsp),%rbp #设置b和bEnd  400f3a:       eb db                   jmp    400f17 &lt;phase_2+0x1b&gt;  400f3c:       48 83 c4 28             add    $0x28,%rsp  400f40:       5b                      pop    %rbx  400f41:       5d                      pop    %rbp  400f42:       c3                      retq   可以看出，在phase_2的一开始调用了read_six_numbers这个函数，初步推测这是用来从输入字符串中读取六个数字的函数，其将输入字符串的地址作为第一个参数，将栈顶指针%rsp作为第二个参数，下面我们查看read_six_numbers的反汇编代码，如下：1234567891011121314151617181920000000000040145c &lt;read_six_numbers&gt;:  40145c:       48 83 ec 18             sub    $0x18,%rsp  401460:       48 89 f2                mov    %rsi,%rdx  401463:       48 8d 4e 04             lea    0x4(%rsi),%rcx  401467:       48 8d 46 14             lea    0x14(%rsi),%rax  40146b:       48 89 44 24 08          mov    %rax,0x8(%rsp)  401470:       48 8d 46 10             lea    0x10(%rsi),%rax  401474:       48 89 04 24             mov    %rax,(%rsp)  401478:       4c 8d 4e 0c             lea    0xc(%rsi),%r9  40147c:       4c 8d 46 08             lea    0x8(%rsi),%r8  401480:       be c3 25 40 00          mov    $0x4025c3,%esi  401485:       b8 00 00 00 00          mov    $0x0,%eax  # 为sscanf配置参数  40148a:       e8 61 f7 ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;  # 调用sscanf(input, \"%d %d %d %d %d %d\", &amp;a[0], &amp;a[1], &amp;a[2], &amp;a[3], &amp;a[4], &amp;a[5]);  40148f:       83 f8 05                cmp    $0x5,%eax  401492:       7f 05                   jg     401499 &lt;read_six_numbers+0x3d&gt;  401494:       e8 a1 ff ff ff          callq  40143a &lt;explode_bomb&gt; #若读取成功的数字数小于6则引爆bomb  401499:       48 83 c4 18             add    $0x18,%rsp  40149d:       c3                      retq   可以看出，该函数在0x401460-0x401480为函数的调用构造了参数，在0x401485将返回值置0，并在0x40148a处调用了sscanf函数。并且检查sscanf函数的返回值（读取成功的变量个数），如果返回值&lt;=5，则引爆bomb，否则则正确返回。\n下面我们重点观察调用函数的参数构造过程。%rdi是第1个参数，指向了输入的字符串，推测第2个参数%rsi应该指向了格式化字符串的首地址，且该字符串为”%d %d %d %d %d %d”。%rdx是第3个参数，为%rsi+0，%rcx是第4个参数，为%rsi+4，%r8是第5个参数，为%rsi+8，%r9是第6个参数，为%rsi+12。(%rsp)是第7个参数，为%rsi+16，(%rsp+8)是第8个参数，为%rsi+20。\n可以归纳出read_six_numbers接收2个参数，其中第1个参数为输入字符串的首地址，第2个参数为6元素的int型数组的首地址，该函数从输入字符串中读取6个数字，并且将这6个数字存入第2个参数所指向的int型数组中。但如果读取的数字不足6个，则会引爆bomb。\n然后我们回到phase_2函数中，将phase_2函数逆向，可以得到如下的结果：123456789101112void phase_2(char * input) &#123;\tint a[6];\tread_six_numbers(input, a);\tif (a[0] == 1) explode_bomb();\tint * b = &amp;a[1], * bEnd = &amp;a[6];\tdo &#123;\t\tint val = (*(b-1)) * 2;\t\tif (*b != val) explode_bomb();\t\tb++;\t&#125; while (b != bEnd);\treturn;&#125;从上述的代码可以明显地看出编译器对于定长数组的优化，编译器使用了指针间接引用替代了数组引用。上述代码依次检查了读入的6个数字，第1个数字必须为1，从第2个数字开始，每一个数字都必须是上一个数字的两倍，否则将会引爆bomb。显然，phase_2的答案为”1 2 4 8 16 32”。\n下面我们在GDB中验证得出的结果。我们为explode_bomb、phase_2和read_six_numbers设置断点，在phase_2中输入”1 2 4 8 16 32”，并且在进入read_six_numbers函数后观察%rsi所指向的字符串是否为”%d %d %d %d %d %d”。这里为了方便起见，我们将phase_1的结果写入test.txt并读入。相关命令与结果如下：12345678910111213141516171819202122232425(gdb) break explode_bombBreakpoint 1 at 0x40143a(gdb) break phase_2Breakpoint 2 at 0x400efc(gdb) break read_six_numbersBreakpoint 3 at 0x40145c(gdb) run test.txtStarting program: /home/blackdragon/CSAPPLabs/BombLab/bomb test.txtWelcome to my fiendish little bomb. You have 6 phases withwhich to blow yourself up. Have a nice day!Phase 1 defused. How about the next one?1 2 4 8 16 32Breakpoint 2, 0x0000000000400efc in phase_2 ()(gdb) continueContinuing.Breakpoint 3, 0x000000000040145c in read_six_numbers ()(gdb) stepi 100x0000000000401485 in read_six_numbers ()(gdb) print (char *)($rsi)$1 = 0x4025c3 \"%d %d %d %d %d %d\"(gdb) continueContinuing.That's number 2.  Keep going!\n阶段3 - phase_3在bomb-disassemble中观察phase_3的反汇编代码，如下：12345678910111213141516171819202122232425262728293031323334353637380000000000400f43 &lt;phase_3&gt;:  400f43:       48 83 ec 18             sub    $0x18,%rsp  400f47:       48 8d 4c 24 0c          lea    0xc(%rsp),%rcx  400f4c:       48 8d 54 24 08          lea    0x8(%rsp),%rdx  400f51:       be cf 25 40 00          mov    $0x4025cf,%esi  400f56:       b8 00 00 00 00          mov    $0x0,%eax  400f5b:       e8 90 fc ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;  # 从输入的字符串中读取两个数字 并存入局部变量中  400f60:       83 f8 01                cmp    $0x1,%eax  400f63:       7f 05                   jg     400f6a &lt;phase_3+0x27&gt;  400f65:       e8 d0 04 00 00          callq  40143a &lt;explode_bomb&gt; # 若读取成功的数字不足两个 则引爆bomb  400f6a:       83 7c 24 08 07          cmpl   $0x7,0x8(%rsp)  400f6f:       77 3c                   ja     400fad &lt;phase_3+0x6a&gt; # 若第一个数字（无符号）大于7 则引爆bomb  400f71:       8b 44 24 08             mov    0x8(%rsp),%eax  400f75:       ff 24 c5 70 24 40 00    jmpq   *0x402470(,%rax,8)  400f7c:       b8 cf 00 00 00          mov    $0xcf,%eax  400f81:       eb 3b                   jmp    400fbe &lt;phase_3+0x7b&gt;  400f83:       b8 c3 02 00 00          mov    $0x2c3,%eax  400f88:       eb 34                   jmp    400fbe &lt;phase_3+0x7b&gt;  400f8a:       b8 00 01 00 00          mov    $0x100,%eax  400f8f:       eb 2d                   jmp    400fbe &lt;phase_3+0x7b&gt;  400f91:       b8 85 01 00 00          mov    $0x185,%eax  400f96:       eb 26                   jmp    400fbe &lt;phase_3+0x7b&gt;  400f98:       b8 ce 00 00 00          mov    $0xce,%eax  400f9d:       eb 1f                   jmp    400fbe &lt;phase_3+0x7b&gt;  400f9f:       b8 aa 02 00 00          mov    $0x2aa,%eax  400fa4:       eb 18                   jmp    400fbe &lt;phase_3+0x7b&gt;  400fa6:       b8 47 01 00 00          mov    $0x147,%eax  400fab:       eb 11                   jmp    400fbe &lt;phase_3+0x7b&gt;  400fad:       e8 88 04 00 00          callq  40143a &lt;explode_bomb&gt;  400fb2:       b8 00 00 00 00          mov    $0x0,%eax  400fb7:       eb 05                   jmp    400fbe &lt;phase_3+0x7b&gt;  400fb9:       b8 37 01 00 00          mov    $0x137,%eax # switch语句  400fbe:       3b 44 24 0c             cmp    0xc(%rsp),%eax  400fc2:       74 05                   je     400fc9 &lt;phase_3+0x86&gt; # 判断a和b是否相等 不想等则引爆炸弹  400fc4:       e8 71 04 00 00          callq  40143a &lt;explode_bomb&gt;  400fc9:       48 83 c4 18             add    $0x18,%rsp  400fcd:       c3                      retq推测phase_3的一开始用sscanf从输入字符串中读入了2个int型数字。\n然后观察phase_3中的jmpq ×0x402470(,%rax,8)以及下面的mov与jmp指令，基本上可以肯定这是使用跳转表实现的switch语句。\n下面在GDB中验证并记录不同%rax的值对应跳转表的不同跳转位置。具体的命令及结果如下：123456789101112131415161718192021222324252627282930313233(gdb) break explode_bombBreakpoint 1 at 0x40143a(gdb) break phase_3Breakpoint 2 at 0x400f43(gdb) run test.txtStarting program: /home/blackdragon/CSAPPLabs/BombLab/bomb test.txtWelcome to my fiendish little bomb. You have 6 phases withwhich to blow yourself up. Have a nice day!Phase 1 defused. How about the next one?That's number 2.  Keep going!1 1Breakpoint 2, 0x0000000000400f43 in phase_3 ()(gdb) stepi 40x0000000000400f56 in phase_3 ()(gdb) print (char *)($rsi)$1 = 0x4025cf \"%d %d\"(gdb) print /x *(long *)(0x402470+0)$2 = 0x400f7c(gdb) print /x *(long *)(0x402470+8)$3 = 0x400fb9(gdb) print /x *(long *)(0x402470+16)$4 = 0x400f83(gdb) print /x *(long *)(0x402470+24)$5 = 0x400f8a(gdb) print /x *(long *)(0x402470+32)$6 = 0x400f91(gdb) print /x *(long *)(0x402470+40)$7 = 0x400f98(gdb) print /x *(long *)(0x402470+48)$8 = 0x400f9f(gdb) print /x *(long *)(0x402470+56)$9 = 0x400fa6从GDB运行的结果可以看出，sscanf确实读入了两个int *数字，并且也得到了所有的%rax对应的跳转表的不同跳转位置。我们已经有了足够的信息来进行phase_3的逆向。\n将phase_3函数逆向，得到如下的结果：123456789101112131415161718void phase_3(char * input) &#123;\tint a, b;\tint val = sscanf(input, \"%d %d\", &amp;a, &amp;b);\tif (val &lt;= 1) explode_bomb();\tswitch (a) &#123;\tcase 0: a = 207; break;\tcase 1: a = 311; break;\tcase 2: a = 707; break;\tcase 3: a = 256; break;\tcase 4: a = 389; break;\tcase 5: a = 206; break;\tcase 6: a = 682; break;\tcase 7: a = 327; break;\tdefault: explode_bomb(); a = 0; break;\t&#125;\tif (a != b) explode_bomb();\treturn;&#125;根据逆向的结果，我们可以得知，本阶段要求输入2个数，且第1个数只能为0到7，且根据第1个数取值的不同，满足条件的第2个数的取值也不同，可能的答案如下：\n\n\n\n第1个数\n第2个数\n\n\n\n\n0\n207\n\n\n1\n311\n\n\n2\n707\n\n\n3\n256\n\n\n4\n389\n\n\n5\n206\n\n\n6\n682\n\n\n7\n327\n\n\n\n在GDB中运行bomb并验证结果，结果正确。\n阶段4 - phase_4在bomb-disassemble中观察phase_4的反汇编代码，如下：1234567891011121314151617181920212223000000000040100c &lt;phase_4&gt;:  40100c:       48 83 ec 18             sub    $0x18,%rsp  401010:       48 8d 4c 24 0c          lea    0xc(%rsp),%rcx  401015:       48 8d 54 24 08          lea    0x8(%rsp),%rdx  40101a:       be cf 25 40 00          mov    $0x4025cf,%esi  40101f:       b8 00 00 00 00          mov    $0x0,%eax  401024:       e8 c7 fb ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt; # 从输入的字符串中读取两个数字 并存入局部变量中  401029:       83 f8 02                cmp    $0x2,%eax  40102c:       75 07                   jne    401035 &lt;phase_4+0x29&gt; # 若数字不为两个 则引爆bomb  40102e:       83 7c 24 08 0e          cmpl   $0xe,0x8(%rsp)  401033:       76 05                   jbe    40103a &lt;phase_4+0x2e&gt; # 若第一个数字大于14 则引爆bomb  401035:       e8 00 04 00 00          callq  40143a &lt;explode_bomb&gt;  40103a:       ba 0e 00 00 00          mov    $0xe,%edx  40103f:       be 00 00 00 00          mov    $0x0,%esi  401044:       8b 7c 24 08             mov    0x8(%rsp),%edi  401048:       e8 81 ff ff ff          callq  400fce &lt;func4&gt; # 调用func4  40104d:       85 c0                   test   %eax,%eax  40104f:       75 07                   jne    401058 &lt;phase_4+0x4c&gt;  401051:       83 7c 24 0c 00          cmpl   $0x0,0xc(%rsp)  401056:       74 05                   je     40105d &lt;phase_4+0x51&gt; # 当返回值和b均为0时 解除阶段 否则 引爆bomb  401058:       e8 dd 03 00 00          callq  40143a &lt;explode_bomb&gt;  40105d:       48 83 c4 18             add    $0x18,%rsp  401061:       c3  可以注意到，phase_4的反汇编代码前半部分与phase_3相似，均是从输入的字符串中读入2个数字。\n将phase_4逆向，得到如下的结果：1234567void phase_4(char * input) &#123;\tint a, b;\tint val = sscanf(input, \"%d %d\", &amp;a, &amp;b);\tif (val != 2 || ((unsigned)a &gt; 14)) explode_bomb();\tval = func4(a, 0, 14);\tif (val != 0 || b != 0) explode_bomb();\treturn;从逆向的结果我们可以看出，phase_4从输入的字符串中读入2个数字a和b，并且a必须小于等于14且大于等于0，然后phase_4调用func4(a, 0, 14)，且只有该函数的返回值和b均为0时，该阶段解除。\n现在我们将注意转向phase_4调用的func4函数，func4的反汇编代码如下：123456789101112131415161718192021222324252627280000000000400fce &lt;func4&gt;:  400fce:       48 83 ec 08             sub    $0x8,%rsp  400fd2:       89 d0                   mov    %edx,%eax  400fd4:       29 f0                   sub    %esi,%eax  400fd6:       89 c1                   mov    %eax,%ecx  400fd8:       c1 e9 1f                shr    $0x1f,%ecx  400fdb:       01 c8                   add    %ecx,%eax  400fdd:       d1 f8                   sar    %eax  # 实际上是/2过程，为了保证负数时舍入正确才使用了位移  400fdf:       8d 0c 30                lea    (%rax,%rsi,1),%ecx  # %rax加上b  400fe2:       39 f9                   cmp    %edi,%ecx  400fe4:       7e 0c                   jle    400ff2 &lt;func4+0x24&gt;  # if分支  400fe6:       8d 51 ff                lea    -0x1(%rcx),%edx  400fe9:       e8 e0 ff ff ff          callq  400fce &lt;func4&gt;  # 递归过程  400fee:       01 c0                   add    %eax,%eax  400ff0:       eb 15                   jmp    401007 &lt;func4+0x39&gt;  400ff2:       b8 00 00 00 00          mov    $0x0,%eax  400ff7:       39 f9                   cmp    %edi,%ecx  400ff9:       7d 0c                   jge    401007 &lt;func4+0x39&gt;  400ffb:       8d 71 01                lea    0x1(%rcx),%esi  400ffe:       e8 cb ff ff ff          callq  400fce &lt;func4&gt;  # 递归过程  401003:       8d 44 00 01             lea    0x1(%rax,%rax,1),%eax  401007:       48 83 c4 08             add    $0x8,%rsp  40100b:       c3                      retq   观察反汇编的func4函数，发现func4函数中调用了func4函数自身，由此可以推测func4函数是一个递归过程。\n将func4逆向，得到如下的结果：12345678910int func4(int a, int b, int c) &#123;\tint returnVal = (c - b) / 2;\tint val = returnVal + b;\tif (val == a) return 0;\tif (val &lt; a) &#123;\t\treturn 2 * func4(a, val + 1, c) + 1;\t&#125; else &#123;\t\treturn 2 * func4(a, b, val - 1);\t&#125;&#125;观察func4的逆向结果，我们可以发现func4非常类似于二分查找的过程。要另func4的返回值为0，则一定不能让func4执行val&lt;a的分支即必须一直保证(b+c)/2 &gt;= a。考虑到0&lt;=a&lt;=14，所以满足条件的a有a=7 a=3 a=1 a=0 共4个。\n在GDB中运行bomb并验证结果，结果正确。\n阶段5 - phase_5在bomb-disassemble中观察phase_5的反汇编代码，如下：12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849500000000000401062 &lt;phase_5&gt;:  401062:       53                      push   %rbx  401063:       48 83 ec 20             sub    $0x20,%rsp  401067:       48 89 fb                mov    %rdi,%rbx  40106a:       64 48 8b 04 25 28 00    mov    %fs:0x28,%rax  401071:       00 00  # 栈破坏检测机制  401073:       48 89 44 24 18          mov    %rax,0x18(%rsp)  401078:       31 c0                   xor    %eax,%eax  40107a:       e8 9c 02 00 00          callq  40131b &lt;string_length&gt;  # 计算输入字符串长度  40107f:       83 f8 06                cmp    $0x6,%eax  401082:       74 4e                   je     4010d2 &lt;phase_5+0x70&gt;  # 若长度不为6 则引爆bomb  401084:       e8 b1 03 00 00          callq  40143a &lt;explode_bomb&gt;  401089:       eb 47                   jmp    4010d2 &lt;phase_5+0x70&gt;  40108b:       0f b6 0c 03             movzbl (%rbx,%rax,1),%ecx  40108f:       88 0c 24                mov    %cl,(%rsp)  401092:       48 8b 14 24             mov    (%rsp),%rdx  401096:       83 e2 0f                and    $0xf,%edx  401099:       0f b6 92 b0 24 40 00    movzbl 0x4024b0(%rdx),%edx  4010a0:       88 54 04 10             mov    %dl,0x10(%rsp,%rax,1)  实际上是a[i] = 0x4024b0[input[i] &amp; 0xf]  4010a4:       48 83 c0 01             add    $0x1,%rax  4010a8:       48 83 f8 06             cmp    $0x6,%rax  4010ac:       75 dd                   jne    40108b &lt;phase_5+0x29&gt;  # 循环以及条件判断  4010ae:       c6 44 24 16 00          movb   $0x0,0x16(%rsp)  # 为构造的字符串尾部加上'\\0'  4010b3:       be 5e 24 40 00          mov    $0x40245e,%esi  4010b8:       48 8d 7c 24 10          lea    0x10(%rsp),%rdi  4010bd:       e8 76 02 00 00          callq  401338 &lt;strings_not_equal&gt;  # 调用strings_not_equal函数  4010c2:       85 c0                   test   %eax,%eax  4010c4:       74 13                   je     4010d9 &lt;phase_5+0x77&gt;  # 若返回值不为0 则引爆bomb  4010c6:       e8 6f 03 00 00          callq  40143a &lt;explode_bomb&gt;  4010cb:       0f 1f 44 00 00          nopl   0x0(%rax,%rax,1)  4010d0:       eb 07                   jmp    4010d9 &lt;phase_5+0x77&gt;  4010d2:       b8 00 00 00 00          mov    $0x0,%eax  4010d7:       eb b2                   jmp    40108b &lt;phase_5+0x29&gt;  4010d9:       48 8b 44 24 18          mov    0x18(%rsp),%rax  4010de:       64 48 33 04 25 28 00    xor    %fs:0x28,%rax  4010e5:       00 00  4010e7:       74 05                   je     4010ee &lt;phase_5+0x8c&gt;  4010e9:       e8 42 fa ff ff          callq  400b30 &lt;__stack_chk_fail@plt&gt;  4010ee:       48 83 c4 20             add    $0x20,%rsp  4010f2:       5b                      pop    %rbx  4010f3:       c3                      retq   首先，我们注意到phase_5采用了栈破坏检测机制，并且设置了相应的哨兵值防止栈缓冲区溢出。然后我们将phase_5逆向，得到如下的结果：123456789void phase_5(char * input) &#123;\tchar a[7];\tif (strlen(input) != 6) explode_bomb();\tfor (int i = 0 ; i &lt; 6 ; i++)\t\ta[i] = 0x4024b0[input[i] &amp; 0xf];\ta[6] = '\\0';\tint val = strings_not_equal(a, 0x40245e);\tif (val != 0) explode_bomb();\treturn;在GDB中打印0x4024b0和0x40245e所对应的字符串，命令和结果如下所示：1234(gdb) print (char *)0x4024b0$1 = 0x4024b0 &lt;array&gt; \"maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?\"(gdb) print (char *)0x40245e$2 = 0x40245e \"flyers\"可以看出，phase_5实际上是phase_1的提高。\nphase_5要求输入一个6个字符的字符串，通过将取出输入字符串中每个字符的后四位当做偏移地址，以该偏移地址取出地址为0x4024b0处的字符数组中对应的字符，并依次保存在临时数组a中构造一个新的字符串。再将这个新的字符串与0x40245e处的字符串相比较，如果两个字符串相等，则该阶段解除。\n0x40245e处的字符串为”flyers”，其每个字符在0x4024b0处的字符数组”maduiersnfotvbyl”中的对应的偏移量为9,15,14,5,6,7。因此只要输入的字符串的后四位换算成10进制分别为9,15,14,5,6,7即可。\n本phase的答案不唯一。一个可能的答案为”yo~uvw”，在GDB中运行bomb并验证结果，结果正确。\n阶段6 - phase_6本phase是所有phase中最难的一个，但是仍然需要一步一步的分解反汇编代码，并最终得到正确的字符串。在bomb-disassemble中观察phase_6的反汇编代码，如下：12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929300000000004010f4 &lt;phase_6&gt;:  4010f4:       41 56                   push   %r14  4010f6:       41 55                   push   %r13  4010f8:       41 54                   push   %r12  4010fa:       55                      push   %rbp  4010fb:       53                      push   %rbx  4010fc:       48 83 ec 50             sub    $0x50,%rsp  401100:       49 89 e5                mov    %rsp,%r13  401103:       48 89 e6                mov    %rsp,%rsi  401106:       e8 51 03 00 00          callq  40145c &lt;read_six_numbers&gt;  # 读入6个int型数字  40110b:       49 89 e6                mov    %rsp,%r14  40110e:       41 bc 00 00 00 00       mov    $0x0,%r12d  401114:       4c 89 ed                mov    %r13,%rbp  401117:       41 8b 45 00             mov    0x0(%r13),%eax  40111b:       83 e8 01                sub    $0x1,%eax  40111e:       83 f8 05                cmp    $0x5,%eax  401121:       76 05                   jbe    401128 &lt;phase_6+0x34&gt;  401123:       e8 12 03 00 00          callq  40143a &lt;explode_bomb&gt;  # 判断数字必须小于等于6  401128:       41 83 c4 01             add    $0x1,%r12d  40112c:       41 83 fc 06             cmp    $0x6,%r12d  401130:       74 21                   je     401153 &lt;phase_6+0x5f&gt;  401132:       44 89 e3                mov    %r12d,%ebx  401135:       48 63 c3                movslq %ebx,%rax  401138:       8b 04 84                mov    (%rsp,%rax,4),%eax  40113b:       39 45 00                cmp    %eax,0x0(%rbp)  40113e:       75 05                   jne    401145 &lt;phase_6+0x51&gt;  401140:       e8 f5 02 00 00          callq  40143a &lt;explode_bomb&gt;  401145:       83 c3 01                add    $0x1,%ebx  401148:       83 fb 05                cmp    $0x5,%ebx  40114b:       7e e8                   jle    401135 &lt;phase_6+0x41&gt;  40114d:       49 83 c5 04             add    $0x4,%r13  401151:       eb c1                   jmp    401114 &lt;phase_6+0x20&gt;  # 判断这6个数字两两不重复  401153:       48 8d 74 24 18          lea    0x18(%rsp),%rsi  401158:       4c 89 f0                mov    %r14,%rax  40115b:       b9 07 00 00 00          mov    $0x7,%ecx  401160:       89 ca                   mov    %ecx,%edx  401162:       2b 10                   sub    (%rax),%edx  401164:       89 10                   mov    %edx,(%rax)  401166:       48 83 c0 04             add    $0x4,%rax  40116a:       48 39 f0                cmp    %rsi,%rax  40116d:       75 f1                   jne    401160 &lt;phase_6+0x6c&gt;  # 分别用7减去这6个数  40116f:       be 00 00 00 00          mov    $0x0,%esi  401174:       eb 21                   jmp    401197 &lt;phase_6+0xa3&gt;  401176:       48 8b 52 08             mov    0x8(%rdx),%rdx  40117a:       83 c0 01                add    $0x1,%eax  40117d:       39 c8                   cmp    %ecx,%eax  40117f:       75 f5                   jne    401176 &lt;phase_6+0x82&gt;  401181:       eb 05                   jmp    401188 &lt;phase_6+0x94&gt;  401183:       ba d0 32 60 00          mov    $0x6032d0,%edx  401188:       48 89 54 74 20          mov    %rdx,0x20(%rsp,%rsi,2)  40118d:       48 83 c6 04             add    $0x4,%rsi  401191:       48 83 fe 18             cmp    $0x18,%rsi  401195:       74 14                   je     4011ab &lt;phase_6+0xb7&gt;  401197:       8b 0c 34                mov    (%rsp,%rsi,1),%ecx  40119a:       83 f9 01                cmp    $0x1,%ecx  40119d:       7e e4                   jle    401183 &lt;phase_6+0x8f&gt;  40119f:       b8 01 00 00 00          mov    $0x1,%eax  4011a4:       ba d0 32 60 00          mov    $0x6032d0,%edx  4011a9:       eb cb                   jmp    401176 &lt;phase_6+0x82&gt;  4011ab:       48 8b 5c 24 20          mov    0x20(%rsp),%rbx  4011b0:       48 8d 44 24 28          lea    0x28(%rsp),%rax  4011b5:       48 8d 74 24 50          lea    0x50(%rsp),%rsi  4011ba:       48 89 d9                mov    %rbx,%rcx  4011bd:       48 8b 10                mov    (%rax),%rdx  4011c0:       48 89 51 08             mov    %rdx,0x8(%rcx)  4011c4:       48 83 c0 08             add    $0x8,%rax  4011c8:       48 39 f0                cmp    %rsi,%rax  4011cb:       74 05                   je     4011d2 &lt;phase_6+0xde&gt;  4011cd:       48 89 d1                mov    %rdx,%rcx  4011d0:       eb eb                   jmp    4011bd &lt;phase_6+0xc9&gt;  4011d2:       48 c7 42 08 00 00 00    movq   $0x0,0x8(%rdx)  4011d9:       00  4011da:       bd 05 00 00 00          mov    $0x5,%ebp  4011df:       48 8b 43 08             mov    0x8(%rbx),%rax  4011e3:       8b 00                   mov    (%rax),%eax  4011e5:       39 03                   cmp    %eax,(%rbx)  4011e7:       7d 05                   jge    4011ee &lt;phase_6+0xfa&gt;  4011e9:       e8 4c 02 00 00          callq  40143a &lt;explode_bomb&gt;  4011ee:       48 8b 5b 08             mov    0x8(%rbx),%rbx  4011f2:       83 ed 01                sub    $0x1,%ebp  4011f5:       75 e8                   jne    4011df &lt;phase_6+0xeb&gt;  # 主要是重排链表 并且判断重排后的链表递减 否则引爆bomb  4011f7:       48 83 c4 50             add    $0x50,%rsp  4011fb:       5b                      pop    %rbx  4011fc:       5d                      pop    %rbp  4011fd:       41 5c                   pop    %r12  4011ff:       41 5d                   pop    %r13  401201:       41 5e                   pop    %r14  401203:       c3                      retq   由于phase_6的逆向比较复杂，这里只大致介绍该函数的作用——\n\n该函数在栈上分配了80个字节，包括了一个有6个int型数字的数组a和一个有6个指针的数组b。\n同phase_2一样，该函数调用了read_six_numbers从输入的字符串中读取了6个数字，并且保存到数组a中。\n判断这6个数字是否都小于等于6并且互相不重复，如果不满足则引爆炸弹。\n分别用7减去这6个数，并且用计算结果覆盖这6个数。既a[i] = 7 - a[i]。\nphase_6中引用了来自0x6032d0的结构体数组，该结构体共16个字节，其中前8个字节存放了一个int型的数字（结构体对齐），后8个字节存放了一个指针，该指针在指向结构体数组中的下一个元素。这实际上是一个有6个元素的单向链表。\n程序从i=1开始，将结构体数组中的第a[i]个元素的首地址存放进b[i]中，循环6次，直到i=6。\n程序从b[1]开始，将b[1]对应的元素的后8个字节对应的地址指向b[2]，直到b[5]-&gt;next = b[6]，将b[6]所对应的元素的后8个字节对应的地址指向0。\n然后从b[1]所对应的节点开始，依次判断整个链表是否降序排列，如果不满足降序，则引爆bomb。\n\nphase_6是所有phases中最难的一个，其本质是输入1组数字从而实现对单向链表的重排，使得重排后的单向链表降序。\n原链表的情况如下：\n\n\n\n节点\n1\n2\n3\n4\n5\n6\n\n\n\n\n值\n322\n168\n924\n691\n477\n443\n\n\n\n因此使得链表降序的输入为：”3 4 5 6 1 2”注意这是用7减过之后的数字序列，原输入序列也就是答案应为：”4 3 2 1 6 5”\n隐藏阶段 - secret_phase观察bomb-symboltable和bomb-disassemble我们都能发现一个叫做secret_phase的函数，这就是本次实验中被隐藏起来的phase。\n经过观察反汇编代码，我们发现call secret_phase位于phase_defused函数中。\n在bomb-disassemble中观察phase_defused的反汇编代码，如下：12345678910111213141516171819202122232425262728293031323334353637383900000000004015c4 &lt;phase_defused&gt;:  4015c4:       48 83 ec 78             sub    $0x78,%rsp  4015c8:       64 48 8b 04 25 28 00    mov    %fs:0x28,%rax  4015cf:       00 00  4015d1:       48 89 44 24 68          mov    %rax,0x68(%rsp)  4015d6:       31 c0                   xor    %eax,%eax  4015d8:       83 3d 81 21 20 00 06    cmpl   $0x6,0x202181(%rip)        # 603760 &lt;num_input_strings&gt;  # 输入过的字符串数目必须为6 意味着必须是phase_6之后  4015df:       75 5e                   jne    40163f &lt;phase_defused+0x7b&gt;  4015e1:       4c 8d 44 24 10          lea    0x10(%rsp),%r8  4015e6:       48 8d 4c 24 0c          lea    0xc(%rsp),%rcx  4015eb:       48 8d 54 24 08          lea    0x8(%rsp),%rdx  4015f0:       be 19 26 40 00          mov    $0x402619,%esi  4015f5:       bf 70 38 60 00          mov    $0x603870,%edi  4015fa:       e8 f1 f5 ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;  4015ff:       83 f8 03                cmp    $0x3,%eax  401602:       75 31                   jne    401635 &lt;phase_defused+0x71&gt;  401604:       be 22 26 40 00          mov    $0x402622,%esi  401609:       48 8d 7c 24 10          lea    0x10(%rsp),%rdi  40160e:       e8 25 fd ff ff          callq  401338 &lt;strings_not_equal&gt;  # 第4个输入字符串读入两个数字和一个字符串 且字符串必须与0x402622处的字符串相等  401613:       85 c0                   test   %eax,%eax  401615:       75 1e                   jne    401635 &lt;phase_defused+0x71&gt;  401617:       bf f8 24 40 00          mov    $0x4024f8,%edi  40161c:       e8 ef f4 ff ff          callq  400b10 &lt;puts@plt&gt;  401621:       bf 20 25 40 00          mov    $0x402520,%edi  401626:       e8 e5 f4 ff ff          callq  400b10 &lt;puts@plt&gt;  40162b:       b8 00 00 00 00          mov    $0x0,%eax  401630:       e8 0d fc ff ff          callq  401242 &lt;secret_phase&gt;  # 然后才能进入隐藏阶段  401635:       bf 58 25 40 00          mov    $0x402558,%edi  40163a:       e8 d1 f4 ff ff          callq  400b10 &lt;puts@plt&gt;  40163f:       48 8b 44 24 68          mov    0x68(%rsp),%rax  401644:       64 48 33 04 25 28 00    xor    %fs:0x28,%rax  40164b:       00 00  40164d:       74 05                   je     401654 &lt;phase_defused+0x90&gt;  40164f:       e8 dc f4 ff ff          callq  400b30 &lt;__stack_chk_fail@plt&gt;  401654:       48 83 c4 78             add    $0x78,%rsp  401658:       c3                      retq   当且仅当phase_6解除并且从phase_4的输入字符串依次读取两个数字和一个字符串且这个字符串为”DrEvil”时，可以进入。\n在bomb-disassemble中观察secret_phase的反汇编代码，如下：123456789101112131415161718192021222324250000000000401242 &lt;secret_phase&gt;:  401242:       53                      push   %rbx  401243:       e8 56 02 00 00          callq  40149e &lt;read_line&gt;  401248:       ba 0a 00 00 00          mov    $0xa,%edx  40124d:       be 00 00 00 00          mov    $0x0,%esi  401252:       48 89 c7                mov    %rax,%rdi  401255:       e8 76 f9 ff ff          callq  400bd0 &lt;strtol@plt&gt;  # 调用strtol函数  40125a:       48 89 c3                mov    %rax,%rbx  40125d:       8d 40 ff                lea    -0x1(%rax),%eax  401260:       3d e8 03 00 00          cmp    $0x3e8,%eax  401265:       76 05                   jbe    40126c &lt;secret_phase+0x2a&gt;  401267:       e8 ce 01 00 00          callq  40143a &lt;explode_bomb&gt; # 如果数字减1之后大于1000 则引爆bomb  40126c:       89 de                   mov    %ebx,%esi  40126e:       bf f0 30 60 00          mov    $0x6030f0,%edi  401273:       e8 8c ff ff ff          callq  401204 &lt;fun7&gt;  # 调用fun7  401278:       83 f8 02                cmp    $0x2,%eax  40127b:       74 05                   je     401282 &lt;secret_phase+0x40&gt;  40127d:       e8 b8 01 00 00          callq  40143a &lt;explode_bomb&gt; # 如果fun7返回值不为2 则引爆bomb  401282:       bf 38 24 40 00          mov    $0x402438,%edi  401287:       e8 84 f8 ff ff          callq  400b10 &lt;puts@plt&gt;  40128c:       e8 33 03 00 00          callq  4015c4 &lt;phase_defused&gt;  401291:       5b                      pop    %rbx  401292:       c3                      retq   根据反汇编的结果，我们可以得知，secret_phase同样需要读入一个字符串，之后其首先调用strtol(input, NULL, 10)将输入的字符串转换成long型数字a。\n如果该数字&gt;1001，则引爆bomb，否则则调用fun7(0x6030f0, a)并判断其返回结果，当且仅当结果为2时，解除secret_phase。\n在bomb-disassemble中观察fun7的反汇编代码，如下：123456789101112131415161718192021220000000000401204 &lt;fun7&gt;:  401204:       48 83 ec 08             sub    $0x8,%rsp  401208:       48 85 ff                test   %rdi,%rdi  40120b:       74 2b                   je     401238 &lt;fun7+0x34&gt;  40120d:       8b 17                   mov    (%rdi),%edx  40120f:       39 f2                   cmp    %esi,%edx  401211:       7e 0d                   jle    401220 &lt;fun7+0x1c&gt;  401213:       48 8b 7f 08             mov    0x8(%rdi),%rdi  401217:       e8 e8 ff ff ff          callq  401204 &lt;fun7&gt;  40121c:       01 c0                   add    %eax,%eax  40121e:       eb 1d                   jmp    40123d &lt;fun7+0x39&gt;  401220:       b8 00 00 00 00          mov    $0x0,%eax  401225:       39 f2                   cmp    %esi,%edx  401227:       74 14                   je     40123d &lt;fun7+0x39&gt;  401229:       48 8b 7f 10             mov    0x10(%rdi),%rdi  40122d:       e8 d2 ff ff ff          callq  401204 &lt;fun7&gt;  401232:       8d 44 00 01             lea    0x1(%rax,%rax,1),%eax  401236:       eb 05                   jmp    40123d &lt;fun7+0x39&gt;  401238:       b8 ff ff ff ff          mov    $0xffffffff,%eax  40123d:       48 83 c4 08             add    $0x8,%rsp  401241:       c3                      retq     # 同样是递归的二分查找过程 数据结构是BST二叉搜索树将fun7逆向，结果如下：1234567891011121314151617struct tree &#123;\tint val;\tstruct tree * left;\tstruct tree * right;&#125;;int fun7(struct tree * ptr, int num) &#123;\tif (ptr == NULL) return -1;\tif (ptr-&gt;val == num) return 0;\tif (ptr-&gt;val &lt; num) &#123;\t\tptr = ptr-&gt;right;\t\treturn 2 * fun7(ptr, num) + 1;\t&#125; else &#123;\t\tptr = ptr-&gt;left;\t\treturn 2 * fun7(ptr, num);\t&#125;&#125;\t\t 其中，ptr所指向的struct tree是一棵二叉搜索树的根节点。对于二叉搜索树的任意一个节点，节点左边孩子的值全部小于该节点的值，节点右边孩子的值全部大于该节点的值。\n这棵根节点位于0x6030f0的二叉搜索树的结构如下图所示：\n要令fun7返回的结果为2，一种可行的递归返回情况是0-&gt;(20+1)=1-&gt;(12)=2。在该情况下，递归深度为2，节点的移动路线为左-&gt;右，并且在值为22的节点返回0。这表明，fun7的第二个参数，也就是secret_phase的正确答案，为”22”。\n在GDB中运行bomb并验证结果，结果正确。\n实验答案\n注意，有部分答案不唯一，并且Bomb Lab每年都在更新，所以答案可能会有所变化。\n\n1234567Border relations with Canada have never been better.1 2 4 8 16 321 3110 0 DrEvilyo~uvw4 3 2 1 6 522\n","dateCreated":"2017-04-18T00:10:24+08:00","dateModified":"2018-05-15T17:22:23+08:00","datePublished":"2017-04-18T00:10:24+08:00","description":"","headline":"深入理解计算机系统BombLab实验报告","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/"},"publisher":{"@type":"Organization","name":"码龙黑曜","sameAs":["https://github.com/BlackDragonF","https://t.me/Cosidian","http://steamcommunity.com/id/BlackDragonF/","mailto:obsidiandragon2016@gmail.com"],"image":"avatar.jpg","logo":{"@type":"ImageObject","url":"avatar.jpg"}},"url":"http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/","keywords":"实验, 计算机系统"}</script>
    <meta name="description" content="实验答案托管在我的Github上  用了一周的时间读完了《深入理解计算机系统》的第三章：程序的机器级表示。对于x86_64汇编及其逆向工程有了一定的了解。于2017年4月16日完成了其第二个Lab - Bomb Lab.  实验简介Bomb Lab - Defusing a Binary Bomb主要是关于反汇编的实验，对应于书本的第三章：程序的机器级表示。 本实验非常的有趣。实验给定了一个二进制">
<meta name="keywords" content="实验,计算机系统">
<meta property="og:type" content="blog">
<meta property="og:title" content="深入理解计算机系统BombLab实验报告">
<meta property="og:url" content="http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/index.html">
<meta property="og:site_name" content="码龙的窝">
<meta property="og:description" content="实验答案托管在我的Github上  用了一周的时间读完了《深入理解计算机系统》的第三章：程序的机器级表示。对于x86_64汇编及其逆向工程有了一定的了解。于2017年4月16日完成了其第二个Lab - Bomb Lab.  实验简介Bomb Lab - Defusing a Binary Bomb主要是关于反汇编的实验，对应于书本的第三章：程序的机器级表示。 本实验非常的有趣。实验给定了一个二进制">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/BST.png">
<meta property="og:updated_time" content="2018-05-15T09:22:23.823Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解计算机系统BombLab实验报告">
<meta name="twitter:description" content="实验答案托管在我的Github上  用了一周的时间读完了《深入理解计算机系统》的第三章：程序的机器级表示。对于x86_64汇编及其逆向工程有了一定的了解。于2017年4月16日完成了其第二个Lab - Bomb Lab.  实验简介Bomb Lab - Defusing a Binary Bomb主要是关于反汇编的实验，对应于书本的第三章：程序的机器级表示。 本实验非常的有趣。实验给定了一个二进制">
<meta name="twitter:image" content="http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/BST.png">
    
    
        
    
    
        <meta property="og:image" content="http://blog.codedragon.tech/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-j4w0tbtf1olriqsnfyv4egntpbdblucqpyraoqqnvawa2vd6l4m8ljtn2yes.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-108458894-1', 'auto');
        ga('send', 'pageview');
    </script>


    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">码龙的窝</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">码龙黑曜</h4>
                
                    <h5 class="sidebar-profile-bio"><p>iOS开发者/计算机科学/兽人控</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="首页"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="分类"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="标签"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="归档"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/projects"
                            
                            title="项目"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-code" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">项目</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about"
                            
                            title="关于"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/BlackDragonF" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://t.me/Cosidian" target="_blank" rel="noopener" title="Telegram">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-telegram" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Telegram</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://steamcommunity.com/id/BlackDragonF/" target="_blank" rel="noopener" title="Steam">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-steam" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Steam</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:obsidiandragon2016@gmail.com" target="_blank" rel="noopener" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/links"
                            
                            title="友情链接"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-link" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">友情链接</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/resources"
                            
                            title="学习资源"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-share-alt" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">学习资源</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            深入理解计算机系统BombLab实验报告
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2017-04-18T00:10:24+08:00">
	
		    4月 18, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/计算机系统/">计算机系统</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>实验答案托管在我的<a href="https://github.com/BlackDragonF/CSAPPLabs/tree/master/BombLab" target="_blank" rel="noopener">Github</a>上</p>
<blockquote>
<p>用了一周的时间读完了《深入理解计算机系统》的第三章：程序的机器级表示。对于x86_64汇编及其逆向工程有了一定的了解。于2017年4月16日完成了其第二个Lab - Bomb Lab.</p>
</blockquote>
<h2 id="实验简介"><a href="#实验简介" class="headerlink" title="实验简介"></a>实验简介</h2><p>Bomb Lab - Defusing a Binary Bomb主要是关于反汇编的实验，对应于书本的第三章：程序的机器级表示。</p>
<p>本实验非常的有趣。实验给定了一个二进制程序Bomb（炸弹）。这个炸弹由若干阶段组成，每个阶段都要求你在标准输入流中输入一个字符串，如果字符串正确，那么该阶段就会被解除并且程序会进入下一个阶段。如果字符串错误，那么炸弹会爆炸，并且退出。当每个阶段都被解除后，整个炸弹将会被解除。</p>
<p>在正式的实验中，每个学生将会从服务器处得到一个独一无二的炸弹，解除每个炸弹所需要的字符串都是不同的。同时，引爆炸弹将会导致扣分。当实验结束后，可以从服务器的计分板上看到每个学生的成绩。<br>本实验主要要求学生能够理解汇编代码，同时要求学生能学会使用一个Debugger（调试器）。</p>
<p>本实验提供的答案仅针对官网给出的自学者讲义中的<a href="http://csapp.cs.cmu.edu/3e/bomb.tar" target="_blank" rel="noopener">炸弹</a>。</p>
<h2 id="实验提示"><a href="#实验提示" class="headerlink" title="实验提示"></a>实验提示</h2><ul>
<li>学会使用一个debugger（调试器），在本次实验中，使用GDB - GNU Debugger</li>
<li>使用<code>objdump -t</code>得到bomb的符号表。符号表包含了bomb中所有函数，全局变量，以及调用的函数的名字及地址。</li>
<li>使用<code>objdump -d</code>得到bomb的反汇编结果。但是注意，系统级别的函数调用将会以被加密的形式出现在反汇编代码中，如果需要知道这些信息，需要在gdb中对相应的函数进行反汇编。</li>
</ul>
<h2 id="实验过程及分析"><a href="#实验过程及分析" class="headerlink" title="实验过程及分析"></a>实验过程及分析</h2><h3 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h3><ol>
<li>熟悉GDB的使用，并且使用<code>objdump -t bomb &gt; bomb-symboltable</code>生成bomb的符号表，再使用<code>objdump -d bomb &gt; bomb-disassemble</code>生成bomb的反汇编文件。</li>
<li>确保即时输入了错误的字符串炸弹也不会爆炸。观察bomb的符号表可以发现函数explode_bomb，推测该函数的作用是引爆炸弹，因此在GDB中使用break explode_bomb为该函数添加断点。这样，我们可以在bomb爆炸前提前截获并处理。</li>
<li>观察符号表可以看到phase_1到phase_6这几个函数以及其他的相关辅助函数，我们要做的就是给每一个阶段的函数添加断点，反汇编，并且理解这些函数的作用，并推测出答案。</li>
</ol>
<h3 id="实验过程"><a href="#实验过程" class="headerlink" title="实验过程"></a>实验过程</h3><h4 id="主函数-main"><a href="#主函数-main" class="headerlink" title="主函数 - main"></a>主函数 - main</h4><p>首先在bomb-disassemble中观察main的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">0000000000400da0 &lt;main&gt;:</span><br><span class="line">  400da0:       <span class="number">53</span>                      <span class="keyword">push</span>   %rbx</span><br><span class="line">  400da1:       <span class="number">83</span> ff <span class="number">01</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x1,%edi</span><br><span class="line">  400da4:       <span class="number">75</span> <span class="number">10</span>                   <span class="keyword">jne</span>    400db6 &lt;main+<span class="number">0x16</span>&gt;</span><br><span class="line">  400da6:       <span class="number">48</span> 8b <span class="number">05</span> 9b <span class="number">29</span> <span class="number">20</span> <span class="number">00</span>    <span class="keyword">mov</span>    <span class="number">0x20299b</span>(%rip),%rax        # <span class="number">603748</span> &lt;stdin@@GLIBC_2<span class="meta">.2</span><span class="meta">.5</span>&gt;</span><br><span class="line">  400dad:       <span class="number">48</span> <span class="number">89</span> <span class="number">05</span> b4 <span class="number">29</span> <span class="number">20</span> <span class="number">00</span>    <span class="keyword">mov</span>    %rax,<span class="number">0x2029b4</span>(%rip)        # <span class="number">603768</span> &lt;infile&gt;</span><br><span class="line">  400db4:       eb <span class="number">63</span>                   <span class="keyword">jmp</span>    400e19 &lt;main+<span class="number">0x79</span>&gt;</span><br><span class="line">  400db6:       <span class="number">48</span> <span class="number">89</span> f3                <span class="keyword">mov</span>    %rsi,%rbx</span><br><span class="line">  400db9:       <span class="number">83</span> ff <span class="number">02</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x2,%edi</span><br><span class="line">  400dbc:       <span class="number">75</span> 3a                   <span class="keyword">jne</span>    400df8 &lt;main+<span class="number">0x58</span>&gt;</span><br><span class="line">  400dbe:       <span class="number">48</span> 8b 7e <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rsi),%rdi</span><br><span class="line">  400dc2:       be b4 <span class="number">22</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4022b4,%esi</span><br><span class="line">  400dc7:       e8 <span class="number">44</span> fe ff ff          callq  400c10 &lt;fopen@plt&gt;</span><br><span class="line">  400dcc:       <span class="number">48</span> <span class="number">89</span> <span class="number">05</span> <span class="number">95</span> <span class="number">29</span> <span class="number">20</span> <span class="number">00</span>    <span class="keyword">mov</span>    %rax,<span class="number">0x202995</span>(%rip)        # <span class="number">603768</span> &lt;infile&gt;</span><br><span class="line">  400dd3:       <span class="number">48</span> <span class="number">85</span> c0                <span class="keyword">test</span>   %rax,%rax</span><br><span class="line">  400dd6:       <span class="number">75</span> <span class="number">41</span>                   <span class="keyword">jne</span>    400e19 &lt;main+<span class="number">0x79</span>&gt;</span><br><span class="line">  400dd8:       <span class="number">48</span> 8b 4b <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rbx),%rcx</span><br><span class="line">  400ddc:       <span class="number">48</span> 8b <span class="number">13</span>                <span class="keyword">mov</span>    (%rbx),%rdx</span><br><span class="line">  400ddf:       be b6 <span class="number">22</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4022b6,%esi</span><br><span class="line">  400de4:       bf <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x1,%edi</span><br><span class="line">  400de9:       e8 <span class="number">12</span> fe ff ff          callq  400c00 &lt;__printf_chk@plt&gt;</span><br><span class="line">  400dee:       bf <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x8,%edi</span><br><span class="line">  400df3:       e8 <span class="number">28</span> fe ff ff          callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  400df8:       <span class="number">48</span> 8b <span class="number">16</span>                <span class="keyword">mov</span>    (%rsi),%rdx</span><br><span class="line">  400dfb:       be d3 <span class="number">22</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4022d3,%esi</span><br><span class="line">  400e00:       bf <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x1,%edi</span><br><span class="line">  400e05:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400e0a:       e8 f1 fd ff ff          callq  400c00 &lt;__printf_chk@plt&gt;</span><br><span class="line">  400e0f:       bf <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x8,%edi</span><br><span class="line">  400e14:       e8 <span class="number">07</span> fe ff ff          callq  400c20 &lt;exit@plt&gt;</span><br><span class="line">  400e19:       e8 <span class="number">84</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  4013a2 &lt;initialize_bomb&gt;</span><br><span class="line">  400e1e:       bf <span class="number">38</span> <span class="number">23</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402338,%edi</span><br><span class="line">  400e23:       e8 e8 fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400e28:       bf <span class="number">78</span> <span class="number">23</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402378,%edi</span><br><span class="line">  400e2d:       e8 de fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400e32:       e8 <span class="number">67</span> <span class="number">06</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e37:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  400e3a:       e8 a1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq  400ee0 &lt;phase_1&gt;</span><br><span class="line">  400e3f:       e8 <span class="number">80</span> <span class="number">07</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e44:       bf a8 <span class="number">23</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4023a8,%edi</span><br><span class="line">  400e49:       e8 c2 fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400e4e:       e8 4b <span class="number">06</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e53:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  400e56:       e8 a1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq  400efc &lt;phase_2&gt;</span><br><span class="line">  400e5b:       e8 <span class="number">64</span> <span class="number">07</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e60:       bf ed <span class="number">22</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4022ed,%edi</span><br><span class="line">  400e65:       e8 a6 fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400e6a:       e8 2f <span class="number">06</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e6f:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  400e72:       e8 cc <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          callq  400f43 &lt;phase_3&gt;</span><br><span class="line">  400e77:       e8 <span class="number">48</span> <span class="number">07</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e7c:       bf <span class="number">0b</span> <span class="number">23</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x40230b,%edi</span><br><span class="line">  400e81:       e8 8a fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400e86:       e8 <span class="number">13</span> <span class="number">06</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  400e8b:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  400e8e:       e8 <span class="number">79</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          callq  40100c &lt;phase_4&gt;</span><br><span class="line">  400e93:       e8 2c <span class="number">07</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400e98:       bf d8 <span class="number">23</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4023d8,%edi</span><br><span class="line">  400e9d:       e8 6e fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400ea2:       e8 f7 <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  400ea7:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  400eaa:       e8 b3 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          callq  <span class="number">401062</span> &lt;phase_5&gt;</span><br><span class="line">  400eaf:       e8 <span class="number">10</span> <span class="number">07</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400eb4:       bf 1a <span class="number">23</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x40231a,%edi</span><br><span class="line">  400eb9:       e8 <span class="number">52</span> fc ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  400ebe:       e8 <span class="built_in">db</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  400ec3:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  400ec6:       e8 <span class="number">29</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          callq  4010f4 &lt;phase_6&gt;</span><br><span class="line">  400ecb:       e8 f4 <span class="number">06</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  400ed0:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400ed5:       5b                      <span class="keyword">pop</span>    %rbx</span><br><span class="line">  400ed6:       c3                      retq   </span><br></pre></td></tr></table></figure><br>结合讲义中的bomb.c可以得出，main函数每次调用read_line从标准输入流中读入一行字符串，并将其返回值（即字符串的首地址）设置为第一个参数，然后依次调用phase_1到phase_6。</p>
<p>在每一个phase函数内部检查输入的字符串是否正确，如果不正确，则调用explode_bomb函数引爆bomb；否则则返回，返回之后由主函数再继续调用phase_defused解除该阶段。</p>
<p>因此，在每一个阶段中，我们关注的重点应当是phase函数内部以及phase函数所调用的其他函数。</p>
<h4 id="阶段1-phase-1"><a href="#阶段1-phase-1" class="headerlink" title="阶段1 - phase_1"></a>阶段1 - phase_1</h4><p>在bomb-disassemble中观察phase_1的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">08</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  400ee4:       be <span class="number">00</span> <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402400,%esi #设置第二个参数为指针</span><br><span class="line">  400ee9:       e8 4a <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>          callq  <span class="number">401338</span> &lt;strings_not_equal&gt; #调用strings_not_equal函数</span><br><span class="line">  400eee:       <span class="number">85</span> c0                   <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  400ef0:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     400ef7 &lt;phase_1+<span class="number">0x17</span>&gt;</span><br><span class="line">  400ef2:       e8 <span class="number">43</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt; #若返回值不为<span class="number">0</span>则引爆bomb</span><br><span class="line">  400ef7:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">08</span>             <span class="keyword">add</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  400efb:       c3                      retq  </span><br></pre></td></tr></table></figure><br>可以看出，phase_1调用了strings_not_equal这个函数，并为该函数配置了第二个参数0x402400，并判断该函数的返回值是否为0，如果为0则返回，否则引爆bomb。</p>
<p>从函数名可以推测，该函数的作用是判断两个字符串是否不相同，如果不相同，则返回非0值，相同则返回0。</p>
<p>还可以推测，该函数的第一个参数%rdi中存放了我们输入的字符串的首地址，而第二个参数%rsi指向了待比较的字符串的首地址——也就是阶段1的答案。</p>
<p>下面在GDB中验证推测。使用GDB运行bomb，为phase_1和explode_bomb添加断点。然后输入测试字符串”Test”，进入phase_1后用print分别打印输出%rdi和%rsi所指向的字符串。</p>
<p>首先是设置断点的相关命令及结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> explode_bomb</span><br><span class="line">Breakpoint 1 at 0x40143a</span><br><span class="line">(gdb) <span class="built_in">break</span> phase_1</span><br><span class="line">Breakpoint 2 at 0x400ee0</span><br></pre></td></tr></table></figure><br>然后是运行程序及输入测试字符串的相关命令及结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run</span><br><span class="line">Starting program: /home/blackdragon/CSAPPLabs/BombLab/bomb</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a nice day!</span><br><span class="line">Test</span><br><span class="line"></span><br><span class="line">Breakpoint 2, 0x0000000000400ee0 <span class="keyword">in</span> phase_1 ()</span><br></pre></td></tr></table></figure><br>然后我们查看%rdi所指向的字符串：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char *)(<span class="variable">$rdi</span>)</span><br><span class="line"><span class="variable">$1</span> = 0x603780 &lt;input_strings&gt; <span class="string">"Test"</span></span><br></pre></td></tr></table></figure><br>发现%rdi果然指向了我们输入的字符串。然后我们单步执行程序至调用strings_not_equal函数之前，查看%rsi所指向的字符串：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) print (char *)($rsi)</span><br><span class="line">$2 = 0x402400 &quot;Border relations with Canada have never been better.&quot;</span><br></pre></td></tr></table></figure><br>我们已经得到了phase_1的答案，就是”Border relations with Canada have never been better.”</p>
<p>下面我们重新执行bomb并测试，输出”Phase 1 defused. How about the next one?”，phase_1解决。</p>
<h4 id="阶段2-phase-2"><a href="#阶段2-phase-2" class="headerlink" title="阶段2 - phase_2"></a>阶段2 - phase_2</h4><p>在bomb-disassemble中观察phase_2的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">  400efc:       <span class="number">55</span>                      <span class="keyword">push</span>   %rbp</span><br><span class="line">  400efd:       <span class="number">53</span>                      <span class="keyword">push</span>   %rbx</span><br><span class="line">  400efe:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">28</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x28,%rsp</span><br><span class="line">  400f02:       <span class="number">48</span> <span class="number">89</span> e6                <span class="keyword">mov</span>    %rsp,%rsi</span><br><span class="line">  400f05:       e8 <span class="number">52</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  40145c &lt;read_six_numbers&gt; #从输入的字符串中读入<span class="number">6</span>个数字</span><br><span class="line">  400f0a:       <span class="number">83</span> 3c <span class="number">24</span> <span class="number">01</span>             cmpl   <span class="number">$0</span>x1,(%rsp)</span><br><span class="line">  400f0e:       <span class="number">74</span> <span class="number">20</span>                   <span class="keyword">je</span>     400f30 &lt;phase_2+<span class="number">0x34</span>&gt;</span><br><span class="line">  400f10:       e8 <span class="number">25</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt; #如果第一个数字不为<span class="number">1</span>则引爆炸弹</span><br><span class="line">  400f15:       eb <span class="number">19</span>                   <span class="keyword">jmp</span>    400f30 &lt;phase_2+<span class="number">0x34</span>&gt;</span><br><span class="line">  400f17:       8b <span class="number">43</span> fc                <span class="keyword">mov</span>    -<span class="number">0x4</span>(%rbx),%eax</span><br><span class="line">  400f1a:       <span class="number">01</span> c0                   <span class="keyword">add</span>    %eax,%eax</span><br><span class="line">  # 计算前一个元素*<span class="number">2</span></span><br><span class="line">  400f1c:       <span class="number">39</span> <span class="number">03</span>                   <span class="keyword">cmp</span>    %eax,(%rbx)</span><br><span class="line">  400f1e:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     400f25 &lt;phase_2+<span class="number">0x29</span>&gt;</span><br><span class="line">  400f20:       e8 <span class="number">15</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt; #若当前元素不等于前一个元素*<span class="number">2</span>则引爆bomb</span><br><span class="line">  400f25:       <span class="number">48</span> <span class="number">83</span> c3 <span class="number">04</span>             <span class="keyword">add</span>    <span class="number">$0</span>x4,%rbx</span><br><span class="line">  400f29:       <span class="number">48</span> <span class="number">39</span> eb                <span class="keyword">cmp</span>    %rbp,%rbx</span><br><span class="line">  400f2c:       <span class="number">75</span> e9                   <span class="keyword">jne</span>    400f17 &lt;phase_2+<span class="number">0x1b</span>&gt;</span><br><span class="line">  # 指向下一个元素</span><br><span class="line">  400f2e:       eb 0c                   <span class="keyword">jmp</span>    400f3c &lt;phase_2+<span class="number">0x40</span>&gt;</span><br><span class="line">  400f30:       <span class="number">48</span> <span class="number">8d</span> 5c <span class="number">24</span> <span class="number">04</span>          <span class="keyword">lea</span>    <span class="number">0x4</span>(%rsp),%rbx</span><br><span class="line">  400f35:       <span class="number">48</span> <span class="number">8d</span> 6c <span class="number">24</span> <span class="number">18</span>          <span class="keyword">lea</span>    <span class="number">0x18</span>(%rsp),%rbp #设置b和bEnd</span><br><span class="line">  400f3a:       eb <span class="built_in">db</span>                   <span class="keyword">jmp</span>    400f17 &lt;phase_2+<span class="number">0x1b</span>&gt;</span><br><span class="line">  400f3c:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">28</span>             <span class="keyword">add</span>    <span class="number">$0</span>x28,%rsp</span><br><span class="line">  400f40:       5b                      <span class="keyword">pop</span>    %rbx</span><br><span class="line">  400f41:       <span class="number">5d</span>                      <span class="keyword">pop</span>    %rbp</span><br><span class="line">  400f42:       c3                      retq   </span><br></pre></td></tr></table></figure><br>可以看出，在phase_2的一开始调用了read_six_numbers这个函数，初步推测这是用来从输入字符串中读取六个数字的函数，其将输入字符串的地址作为第一个参数，将栈顶指针%rsp作为第二个参数，下面我们查看read_six_numbers的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">000000000040145c &lt;read_six_numbers&gt;:</span><br><span class="line">  40145c:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">18</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">401460</span>:       <span class="number">48</span> <span class="number">89</span> f2                <span class="keyword">mov</span>    %rsi,%rdx</span><br><span class="line">  <span class="number">401463</span>:       <span class="number">48</span> <span class="number">8d</span> 4e <span class="number">04</span>             <span class="keyword">lea</span>    <span class="number">0x4</span>(%rsi),%rcx</span><br><span class="line">  <span class="number">401467</span>:       <span class="number">48</span> <span class="number">8d</span> <span class="number">46</span> <span class="number">14</span>             <span class="keyword">lea</span>    <span class="number">0x14</span>(%rsi),%rax</span><br><span class="line">  40146b:       <span class="number">48</span> <span class="number">89</span> <span class="number">44</span> <span class="number">24</span> <span class="number">08</span>          <span class="keyword">mov</span>    %rax,<span class="number">0x8</span>(%rsp)</span><br><span class="line">  <span class="number">401470</span>:       <span class="number">48</span> <span class="number">8d</span> <span class="number">46</span> <span class="number">10</span>             <span class="keyword">lea</span>    <span class="number">0x10</span>(%rsi),%rax</span><br><span class="line">  <span class="number">401474</span>:       <span class="number">48</span> <span class="number">89</span> <span class="number">04</span> <span class="number">24</span>             <span class="keyword">mov</span>    %rax,(%rsp)</span><br><span class="line">  <span class="number">401478</span>:       4c <span class="number">8d</span> 4e 0c             <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsi),%r9</span><br><span class="line">  40147c:       4c <span class="number">8d</span> <span class="number">46</span> <span class="number">08</span>             <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsi),%r8</span><br><span class="line">  <span class="number">401480</span>:       be c3 <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4025c3,%esi</span><br><span class="line">  <span class="number">401485</span>:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  # 为sscanf配置参数</span><br><span class="line">  40148a:       e8 <span class="number">61</span> f7 ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  # 调用sscanf(input, <span class="string">"%d %d %d %d %d %d"</span>, &amp;a[<span class="number">0</span>], &amp;a[<span class="number">1</span>], &amp;a[<span class="number">2</span>], &amp;a[<span class="number">3</span>], &amp;a[<span class="number">4</span>], &amp;a[<span class="number">5</span>])<span class="comment">;</span></span><br><span class="line">  40148f:       <span class="number">83</span> f8 <span class="number">05</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x5,%eax</span><br><span class="line">  <span class="number">401492</span>:       7f <span class="number">05</span>                   <span class="keyword">jg</span>     <span class="number">401499</span> &lt;read_six_numbers+<span class="number">0x3d</span>&gt;</span><br><span class="line">  <span class="number">401494</span>:       e8 a1 ff ff ff          callq  40143a &lt;explode_bomb&gt; #若读取成功的数字数小于<span class="number">6</span>则引爆bomb</span><br><span class="line">  <span class="number">401499</span>:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">18</span>             <span class="keyword">add</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">40149d</span>:       c3                      retq   </span><br></pre></td></tr></table></figure><br>可以看出，该函数在0x401460-0x401480为函数的调用构造了参数，在0x401485将返回值置0，并在0x40148a处调用了sscanf函数。并且检查sscanf函数的返回值（读取成功的变量个数），如果返回值&lt;=5，则引爆bomb，否则则正确返回。</p>
<p>下面我们重点观察调用函数的参数构造过程。%rdi是第1个参数，指向了输入的字符串，推测第2个参数%rsi应该指向了格式化字符串的首地址，且该字符串为”%d %d %d %d %d %d”。%rdx是第3个参数，为%rsi+0，%rcx是第4个参数，为%rsi+4，%r8是第5个参数，为%rsi+8，%r9是第6个参数，为%rsi+12。(%rsp)是第7个参数，为%rsi+16，(%rsp+8)是第8个参数，为%rsi+20。</p>
<p>可以归纳出read_six_numbers接收2个参数，其中第1个参数为输入字符串的首地址，第2个参数为6元素的int型数组的首地址，该函数从输入字符串中读取6个数字，并且将这6个数字存入第2个参数所指向的int型数组中。但如果读取的数字不足6个，则会引爆bomb。</p>
<p>然后我们回到phase_2函数中，将phase_2函数逆向，可以得到如下的结果：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">phase_2</span><span class="params">(<span class="keyword">char</span> * input)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a[<span class="number">6</span>];</span><br><span class="line">	read_six_numbers(input, a);</span><br><span class="line">	<span class="keyword">if</span> (a[<span class="number">0</span>] == <span class="number">1</span>) explode_bomb();</span><br><span class="line">	<span class="keyword">int</span> * b = &amp;a[<span class="number">1</span>], * bEnd = &amp;a[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> val = (*(b<span class="number">-1</span>)) * <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span> (*b != val) explode_bomb();</span><br><span class="line">		b++;</span><br><span class="line">	&#125; <span class="keyword">while</span> (b != bEnd);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>从上述的代码可以明显地看出编译器对于定长数组的优化，编译器使用了指针间接引用替代了数组引用。<br>上述代码依次检查了读入的6个数字，第1个数字必须为1，从第2个数字开始，每一个数字都必须是上一个数字的两倍，否则将会引爆bomb。显然，phase_2的答案为”1 2 4 8 16 32”。</p>
<p>下面我们在GDB中验证得出的结果。我们为explode_bomb、phase_2和read_six_numbers设置断点，在phase_2中输入”1 2 4 8 16 32”，并且在进入read_six_numbers函数后观察%rsi所指向的字符串是否为”%d %d %d %d %d %d”。这里为了方便起见，我们将phase_1的结果写入test.txt并读入。相关命令与结果如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> explode_bomb</span><br><span class="line">Breakpoint 1 at 0x40143a</span><br><span class="line">(gdb) <span class="built_in">break</span> phase_2</span><br><span class="line">Breakpoint 2 at 0x400efc</span><br><span class="line">(gdb) <span class="built_in">break</span> read_six_numbers</span><br><span class="line">Breakpoint 3 at 0x40145c</span><br><span class="line">(gdb) run test.txt</span><br><span class="line">Starting program: /home/blackdragon/CSAPPLabs/BombLab/bomb test.txt</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a nice day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line"></span><br><span class="line">Breakpoint 2, 0x0000000000400efc <span class="keyword">in</span> phase_2 ()</span><br><span class="line">(gdb) <span class="built_in">continue</span></span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 3, 0x000000000040145c <span class="keyword">in</span> read_six_numbers ()</span><br><span class="line">(gdb) stepi 10</span><br><span class="line">0x0000000000401485 <span class="keyword">in</span> read_six_numbers ()</span><br><span class="line">(gdb) <span class="built_in">print</span> (char *)(<span class="variable">$rsi</span>)</span><br><span class="line"><span class="variable">$1</span> = 0x4025c3 <span class="string">"%d %d %d %d %d %d"</span></span><br><span class="line">(gdb) <span class="built_in">continue</span></span><br><span class="line">Continuing.</span><br><span class="line">That<span class="string">'s number 2.  Keep going!</span></span><br></pre></td></tr></table></figure></p>
<h4 id="阶段3-phase-3"><a href="#阶段3-phase-3" class="headerlink" title="阶段3 - phase_3"></a>阶段3 - phase_3</h4><p>在bomb-disassemble中观察phase_3的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">18</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  400f47:       <span class="number">48</span> <span class="number">8d</span> 4c <span class="number">24</span> 0c          <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsp),%rcx</span><br><span class="line">  400f4c:       <span class="number">48</span> <span class="number">8d</span> <span class="number">54</span> <span class="number">24</span> <span class="number">08</span>          <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsp),%rdx</span><br><span class="line">  400f51:       be cf <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4025cf,%esi</span><br><span class="line">  400f56:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400f5b:       e8 <span class="number">90</span> fc ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  # 从输入的字符串中读取两个数字 并存入局部变量中</span><br><span class="line">  400f60:       <span class="number">83</span> f8 <span class="number">01</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  400f63:       7f <span class="number">05</span>                   <span class="keyword">jg</span>     400f6a &lt;phase_3+<span class="number">0x27</span>&gt;</span><br><span class="line">  400f65:       e8 d0 <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt; # 若读取成功的数字不足两个 则引爆bomb</span><br><span class="line">  400f6a:       <span class="number">83</span> 7c <span class="number">24</span> <span class="number">08</span> <span class="number">07</span>          cmpl   <span class="number">$0</span>x7,<span class="number">0x8</span>(%rsp)</span><br><span class="line">  400f6f:       <span class="number">77</span> 3c                   <span class="keyword">ja</span>     400fad &lt;phase_3+<span class="number">0x6a</span>&gt; # 若第一个数字（无符号）大于<span class="number">7</span> 则引爆bomb</span><br><span class="line">  400f71:       8b <span class="number">44</span> <span class="number">24</span> <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rsp),%eax</span><br><span class="line">  400f75:       ff <span class="number">24</span> c5 <span class="number">70</span> <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>    jmpq   *<span class="number">0x402470</span>(,%rax,<span class="number">8</span>)</span><br><span class="line">  400f7c:       b8 cf <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>xcf,%eax</span><br><span class="line">  400f81:       eb 3b                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f83:       b8 c3 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x2c3,%eax</span><br><span class="line">  400f88:       eb <span class="number">34</span>                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f8a:       b8 <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x100,%eax</span><br><span class="line">  400f8f:       eb <span class="number">2d</span>                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f91:       b8 <span class="number">85</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x185,%eax</span><br><span class="line">  400f96:       eb <span class="number">26</span>                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f98:       b8 ce <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>xce,%eax</span><br><span class="line">  400f9d:       eb 1f                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400f9f:       b8 aa <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x2aa,%eax</span><br><span class="line">  400fa4:       eb <span class="number">18</span>                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400fa6:       b8 <span class="number">47</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x147,%eax</span><br><span class="line">  400fab:       eb <span class="number">11</span>                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400fad:       e8 <span class="number">88</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fb2:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400fb7:       eb <span class="number">05</span>                   <span class="keyword">jmp</span>    400fbe &lt;phase_3+<span class="number">0x7b</span>&gt;</span><br><span class="line">  400fb9:       b8 <span class="number">37</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x137,%eax # switch语句</span><br><span class="line">  400fbe:       3b <span class="number">44</span> <span class="number">24</span> 0c             <span class="keyword">cmp</span>    <span class="number">0xc</span>(%rsp),%eax</span><br><span class="line">  400fc2:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     400fc9 &lt;phase_3+<span class="number">0x86</span>&gt; # 判断a和b是否相等 不想等则引爆炸弹</span><br><span class="line">  400fc4:       e8 <span class="number">71</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fc9:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">18</span>             <span class="keyword">add</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  400fcd:       c3                      retq</span><br></pre></td></tr></table></figure><br>推测phase_3的一开始用sscanf从输入字符串中读入了2个int型数字。</p>
<p>然后观察phase_3中的jmpq ×0x402470(,%rax,8)以及下面的mov与jmp指令，基本上可以肯定这是使用跳转表实现的switch语句。</p>
<p>下面在GDB中验证并记录不同%rax的值对应跳转表的不同跳转位置。具体的命令及结果如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">break</span> explode_bomb</span><br><span class="line">Breakpoint 1 at 0x40143a</span><br><span class="line">(gdb) <span class="built_in">break</span> phase_3</span><br><span class="line">Breakpoint 2 at 0x400f43</span><br><span class="line">(gdb) run test.txt</span><br><span class="line">Starting program: /home/blackdragon/CSAPPLabs/BombLab/bomb test.txt</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line"><span class="built_in">which</span> to blow yourself up. Have a nice day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That<span class="string">'s number 2.  Keep going!</span></span><br><span class="line"><span class="string">1 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Breakpoint 2, 0x0000000000400f43 in phase_3 ()</span></span><br><span class="line"><span class="string">(gdb) stepi 4</span></span><br><span class="line"><span class="string">0x0000000000400f56 in phase_3 ()</span></span><br><span class="line"><span class="string">(gdb) print (char *)($rsi)</span></span><br><span class="line"><span class="string">$1 = 0x4025cf "%d %d"</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+0)</span></span><br><span class="line"><span class="string">$2 = 0x400f7c</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+8)</span></span><br><span class="line"><span class="string">$3 = 0x400fb9</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+16)</span></span><br><span class="line"><span class="string">$4 = 0x400f83</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+24)</span></span><br><span class="line"><span class="string">$5 = 0x400f8a</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+32)</span></span><br><span class="line"><span class="string">$6 = 0x400f91</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+40)</span></span><br><span class="line"><span class="string">$7 = 0x400f98</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+48)</span></span><br><span class="line"><span class="string">$8 = 0x400f9f</span></span><br><span class="line"><span class="string">(gdb) print /x *(long *)(0x402470+56)</span></span><br><span class="line"><span class="string">$9 = 0x400fa6</span></span><br></pre></td></tr></table></figure><br>从GDB运行的结果可以看出，sscanf确实读入了两个int *数字，并且也得到了所有的%rax对应的跳转表的不同跳转位置。我们已经有了足够的信息来进行phase_3的逆向。</p>
<p>将phase_3函数逆向，得到如下的结果：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">phase_3</span><span class="params">(<span class="keyword">char</span> * input)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a, b;</span><br><span class="line">	<span class="keyword">int</span> val = <span class="built_in">sscanf</span>(input, <span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">	<span class="keyword">if</span> (val &lt;= <span class="number">1</span>) explode_bomb();</span><br><span class="line">	<span class="keyword">switch</span> (a) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">0</span>: a = <span class="number">207</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>: a = <span class="number">311</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>: a = <span class="number">707</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">3</span>: a = <span class="number">256</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">4</span>: a = <span class="number">389</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">5</span>: a = <span class="number">206</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">6</span>: a = <span class="number">682</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">7</span>: a = <span class="number">327</span>; <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>: explode_bomb(); a = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (a != b) explode_bomb();</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>根据逆向的结果，我们可以得知，本阶段要求输入2个数，且第1个数只能为0到7，且根据第1个数取值的不同，满足条件的第2个数的取值也不同，可能的答案如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">第1个数</th>
<th style="text-align:center">第2个数</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">207</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">311</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">707</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">256</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">389</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">206</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">682</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">327</td>
</tr>
</tbody>
</table>
<p>在GDB中运行bomb并验证结果，结果正确。</p>
<h4 id="阶段4-phase-4"><a href="#阶段4-phase-4" class="headerlink" title="阶段4 - phase_4"></a>阶段4 - phase_4</h4><p>在bomb-disassemble中观察phase_4的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">  40100c:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">18</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">401010</span>:       <span class="number">48</span> <span class="number">8d</span> 4c <span class="number">24</span> 0c          <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsp),%rcx</span><br><span class="line">  <span class="number">401015</span>:       <span class="number">48</span> <span class="number">8d</span> <span class="number">54</span> <span class="number">24</span> <span class="number">08</span>          <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsp),%rdx</span><br><span class="line">  40101a:       be cf <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4025cf,%esi</span><br><span class="line">  40101f:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  <span class="number">401024</span>:       e8 c7 fb ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt; # 从输入的字符串中读取两个数字 并存入局部变量中</span><br><span class="line">  <span class="number">401029</span>:       <span class="number">83</span> f8 <span class="number">02</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x2,%eax</span><br><span class="line">  40102c:       <span class="number">75</span> <span class="number">07</span>                   <span class="keyword">jne</span>    <span class="number">401035</span> &lt;phase_4+<span class="number">0x29</span>&gt; # 若数字不为两个 则引爆bomb</span><br><span class="line">  40102e:       <span class="number">83</span> 7c <span class="number">24</span> <span class="number">08</span> 0e          cmpl   <span class="number">$0</span>xe,<span class="number">0x8</span>(%rsp)</span><br><span class="line">  <span class="number">401033</span>:       <span class="number">76</span> <span class="number">05</span>                   <span class="keyword">jbe</span>    40103a &lt;phase_4+<span class="number">0x2e</span>&gt; # 若第一个数字大于<span class="number">14</span> 则引爆bomb</span><br><span class="line">  <span class="number">401035</span>:       e8 <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  40103a:       ba 0e <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>xe,%edx</span><br><span class="line">  40103f:       be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%esi</span><br><span class="line">  <span class="number">401044</span>:       8b 7c <span class="number">24</span> <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rsp),%edi</span><br><span class="line">  <span class="number">401048</span>:       e8 <span class="number">81</span> ff ff ff          callq  400fce &lt;func4&gt; # 调用func4</span><br><span class="line">  <span class="number">40104d</span>:       <span class="number">85</span> c0                   <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  40104f:       <span class="number">75</span> <span class="number">07</span>                   <span class="keyword">jne</span>    <span class="number">401058</span> &lt;phase_4+<span class="number">0x4c</span>&gt;</span><br><span class="line">  <span class="number">401051</span>:       <span class="number">83</span> 7c <span class="number">24</span> 0c <span class="number">00</span>          cmpl   <span class="number">$0</span>x0,<span class="number">0xc</span>(%rsp)</span><br><span class="line">  <span class="number">401056</span>:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     <span class="number">40105d</span> &lt;phase_4+<span class="number">0x51</span>&gt; # 当返回值和b均为<span class="number">0</span>时 解除阶段 否则 引爆bomb</span><br><span class="line">  <span class="number">401058</span>:       e8 <span class="built_in">dd</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">40105d</span>:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">18</span>             <span class="keyword">add</span>    <span class="number">$0</span>x18,%rsp</span><br><span class="line">  <span class="number">401061</span>:       c3  </span><br></pre></td></tr></table></figure><br>可以注意到，phase_4的反汇编代码前半部分与phase_3相似，均是从输入的字符串中读入2个数字。</p>
<p>将phase_4逆向，得到如下的结果：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">phase_4</span><span class="params">(<span class="keyword">char</span> * input)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a, b;</span><br><span class="line">	<span class="keyword">int</span> val = <span class="built_in">sscanf</span>(input, <span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">	<span class="keyword">if</span> (val != <span class="number">2</span> || ((<span class="keyword">unsigned</span>)a &gt; <span class="number">14</span>)) explode_bomb();</span><br><span class="line">	val = func4(a, <span class="number">0</span>, <span class="number">14</span>);</span><br><span class="line">	<span class="keyword">if</span> (val != <span class="number">0</span> || b != <span class="number">0</span>) explode_bomb();</span><br><span class="line">	<span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><br>从逆向的结果我们可以看出，phase_4从输入的字符串中读入2个数字a和b，并且a必须小于等于14且大于等于0，然后phase_4调用func4(a, 0, 14)，且只有该函数的返回值和b均为0时，该阶段解除。</p>
<p>现在我们将注意转向phase_4调用的func4函数，func4的反汇编代码如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce &lt;func4&gt;:</span><br><span class="line">  400fce:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">08</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  400fd2:       <span class="number">89</span> d0                   <span class="keyword">mov</span>    %edx,%eax</span><br><span class="line">  400fd4:       <span class="number">29</span> f0                   <span class="keyword">sub</span>    %esi,%eax</span><br><span class="line">  400fd6:       <span class="number">89</span> c1                   <span class="keyword">mov</span>    %eax,%ecx</span><br><span class="line">  400fd8:       c1 e9 1f                <span class="keyword">shr</span>    <span class="number">$0</span>x1f,%ecx</span><br><span class="line">  400fdb:       <span class="number">01</span> c8                   <span class="keyword">add</span>    %ecx,%eax</span><br><span class="line">  400fdd:       d1 f8                   <span class="keyword">sar</span>    %eax</span><br><span class="line">  # 实际上是/<span class="number">2</span>过程，为了保证负数时舍入正确才使用了位移</span><br><span class="line">  400fdf:       <span class="number">8d</span> 0c <span class="number">30</span>                <span class="keyword">lea</span>    (%rax,%rsi,<span class="number">1</span>),%ecx</span><br><span class="line">  # %rax加上b</span><br><span class="line">  400fe2:       <span class="number">39</span> f9                   <span class="keyword">cmp</span>    %edi,%ecx</span><br><span class="line">  400fe4:       7e 0c                   <span class="keyword">jle</span>    400ff2 &lt;func4+<span class="number">0x24</span>&gt;</span><br><span class="line">  # if分支</span><br><span class="line">  400fe6:       <span class="number">8d</span> <span class="number">51</span> ff                <span class="keyword">lea</span>    -<span class="number">0x1</span>(%rcx),%edx</span><br><span class="line">  400fe9:       e8 e0 ff ff ff          callq  400fce &lt;func4&gt;</span><br><span class="line">  # 递归过程</span><br><span class="line">  400fee:       <span class="number">01</span> c0                   <span class="keyword">add</span>    %eax,%eax</span><br><span class="line">  400ff0:       eb <span class="number">15</span>                   <span class="keyword">jmp</span>    <span class="number">401007</span> &lt;func4+<span class="number">0x39</span>&gt;</span><br><span class="line">  400ff2:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  400ff7:       <span class="number">39</span> f9                   <span class="keyword">cmp</span>    %edi,%ecx</span><br><span class="line">  400ff9:       <span class="number">7d</span> 0c                   <span class="keyword">jge</span>    <span class="number">401007</span> &lt;func4+<span class="number">0x39</span>&gt;</span><br><span class="line">  400ffb:       <span class="number">8d</span> <span class="number">71</span> <span class="number">01</span>                <span class="keyword">lea</span>    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line">  400ffe:       e8 cb ff ff ff          callq  400fce &lt;func4&gt;</span><br><span class="line">  # 递归过程</span><br><span class="line">  <span class="number">401003</span>:       <span class="number">8d</span> <span class="number">44</span> <span class="number">00</span> <span class="number">01</span>             <span class="keyword">lea</span>    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line">  <span class="number">401007</span>:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">08</span>             <span class="keyword">add</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  40100b:       c3                      retq   </span><br></pre></td></tr></table></figure><br>观察反汇编的func4函数，发现func4函数中调用了func4函数自身，由此可以推测func4函数是一个递归过程。</p>
<p>将func4逆向，得到如下的结果：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func4</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> returnVal = (c - b) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">int</span> val = returnVal + b;</span><br><span class="line">	<span class="keyword">if</span> (val == a) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (val &lt; a) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span> * func4(a, val + <span class="number">1</span>, c) + <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span> * func4(a, b, val - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>观察func4的逆向结果，我们可以发现func4非常类似于二分查找的过程。要另func4的返回值为0，则一定不能让func4执行val&lt;a的分支即必须一直保证(b+c)/2 &gt;= a。考虑到0&lt;=a&lt;=14，所以满足条件的a有a=7 a=3 a=1 a=0 共4个。</p>
<p>在GDB中运行bomb并验证结果，结果正确。</p>
<h4 id="阶段5-phase-5"><a href="#阶段5-phase-5" class="headerlink" title="阶段5 - phase_5"></a>阶段5 - phase_5</h4><p>在bomb-disassemble中观察phase_5的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000401062</span> &lt;phase_5&gt;:</span><br><span class="line">  <span class="number">401062</span>:       <span class="number">53</span>                      <span class="keyword">push</span>   %rbx</span><br><span class="line">  <span class="number">401063</span>:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">20</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x20,%rsp</span><br><span class="line">  <span class="number">401067</span>:       <span class="number">48</span> <span class="number">89</span> fb                <span class="keyword">mov</span>    %rdi,%rbx</span><br><span class="line">  40106a:       <span class="number">64</span> <span class="number">48</span> 8b <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span>    <span class="keyword">mov</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line">  <span class="number">401071</span>:       <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  # 栈破坏检测机制</span><br><span class="line">  <span class="number">401073</span>:       <span class="number">48</span> <span class="number">89</span> <span class="number">44</span> <span class="number">24</span> <span class="number">18</span>          <span class="keyword">mov</span>    %rax,<span class="number">0x18</span>(%rsp)</span><br><span class="line">  <span class="number">401078</span>:       <span class="number">31</span> c0                   <span class="keyword">xor</span>    %eax,%eax</span><br><span class="line">  40107a:       e8 9c <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          callq  40131b &lt;string_length&gt;</span><br><span class="line">  # 计算输入字符串长度</span><br><span class="line">  40107f:       <span class="number">83</span> f8 <span class="number">06</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x6,%eax</span><br><span class="line">  <span class="number">401082</span>:       <span class="number">74</span> 4e                   <span class="keyword">je</span>     4010d2 &lt;phase_5+<span class="number">0x70</span>&gt;</span><br><span class="line">  # 若长度不为<span class="number">6</span> 则引爆bomb</span><br><span class="line">  <span class="number">401084</span>:       e8 b1 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">401089</span>:       eb <span class="number">47</span>                   <span class="keyword">jmp</span>    4010d2 &lt;phase_5+<span class="number">0x70</span>&gt;</span><br><span class="line">  40108b:       0f b6 0c <span class="number">03</span>             movzbl (%rbx,%rax,<span class="number">1</span>),%ecx</span><br><span class="line">  40108f:       <span class="number">88</span> 0c <span class="number">24</span>                <span class="keyword">mov</span>    %cl,(%rsp)</span><br><span class="line">  <span class="number">401092</span>:       <span class="number">48</span> 8b <span class="number">14</span> <span class="number">24</span>             <span class="keyword">mov</span>    (%rsp),%rdx</span><br><span class="line">  <span class="number">401096</span>:       <span class="number">83</span> e2 0f                <span class="keyword">and</span>    <span class="number">$0</span>xf,%edx</span><br><span class="line">  <span class="number">401099</span>:       0f b6 <span class="number">92</span> b0 <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>    movzbl <span class="number">0x4024b0</span>(%rdx),%edx</span><br><span class="line">  4010a0:       <span class="number">88</span> <span class="number">54</span> <span class="number">04</span> <span class="number">10</span>             <span class="keyword">mov</span>    %dl,<span class="number">0x10</span>(%rsp,%rax,<span class="number">1</span>)</span><br><span class="line">  实际上是a[i] = <span class="number">0x4024b0</span>[input[i] &amp; <span class="number">0xf</span>]</span><br><span class="line">  4010a4:       <span class="number">48</span> <span class="number">83</span> c0 <span class="number">01</span>             <span class="keyword">add</span>    <span class="number">$0</span>x1,%rax</span><br><span class="line">  4010a8:       <span class="number">48</span> <span class="number">83</span> f8 <span class="number">06</span>             <span class="keyword">cmp</span>    <span class="number">$0</span>x6,%rax</span><br><span class="line">  4010ac:       <span class="number">75</span> <span class="built_in">dd</span>                   <span class="keyword">jne</span>    40108b &lt;phase_5+<span class="number">0x29</span>&gt;</span><br><span class="line">  # 循环以及条件判断</span><br><span class="line">  4010ae:       c6 <span class="number">44</span> <span class="number">24</span> <span class="number">16</span> <span class="number">00</span>          movb   <span class="number">$0</span>x0,<span class="number">0x16</span>(%rsp)</span><br><span class="line">  # 为构造的字符串尾部加上<span class="string">'\0'</span></span><br><span class="line">  4010b3:       be 5e <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x40245e,%esi</span><br><span class="line">  4010b8:       <span class="number">48</span> <span class="number">8d</span> 7c <span class="number">24</span> <span class="number">10</span>          <span class="keyword">lea</span>    <span class="number">0x10</span>(%rsp),%rdi</span><br><span class="line">  4010bd:       e8 <span class="number">76</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          callq  <span class="number">401338</span> &lt;strings_not_equal&gt;</span><br><span class="line">  # 调用strings_not_equal函数</span><br><span class="line">  4010c2:       <span class="number">85</span> c0                   <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  4010c4:       <span class="number">74</span> <span class="number">13</span>                   <span class="keyword">je</span>     4010d9 &lt;phase_5+<span class="number">0x77</span>&gt;</span><br><span class="line">  # 若返回值不为<span class="number">0</span> 则引爆bomb</span><br><span class="line">  4010c6:       e8 6f <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4010cb:       0f 1f <span class="number">44</span> <span class="number">00</span> <span class="number">00</span>          nopl   <span class="number">0x0</span>(%rax,%rax,<span class="number">1</span>)</span><br><span class="line">  4010d0:       eb <span class="number">07</span>                   <span class="keyword">jmp</span>    4010d9 &lt;phase_5+<span class="number">0x77</span>&gt;</span><br><span class="line">  4010d2:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  4010d7:       eb b2                   <span class="keyword">jmp</span>    40108b &lt;phase_5+<span class="number">0x29</span>&gt;</span><br><span class="line">  4010d9:       <span class="number">48</span> 8b <span class="number">44</span> <span class="number">24</span> <span class="number">18</span>          <span class="keyword">mov</span>    <span class="number">0x18</span>(%rsp),%rax</span><br><span class="line">  4010de:       <span class="number">64</span> <span class="number">48</span> <span class="number">33</span> <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span>    <span class="keyword">xor</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line">  4010e5:       <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  4010e7:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     4010ee &lt;phase_5+<span class="number">0x8c</span>&gt;</span><br><span class="line">  4010e9:       e8 <span class="number">42</span> fa ff ff          callq  400b30 &lt;__stack_chk_fai</span><br><span class="line">l@plt&gt;</span><br><span class="line">  4010ee:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">20</span>             <span class="keyword">add</span>    <span class="number">$0</span>x20,%rsp</span><br><span class="line">  4010f2:       5b                      <span class="keyword">pop</span>    %rbx</span><br><span class="line">  4010f3:       c3                      retq   </span><br></pre></td></tr></table></figure><br>首先，我们注意到phase_5采用了栈破坏检测机制，并且设置了相应的哨兵值防止栈缓冲区溢出。<br>然后我们将phase_5逆向，得到如下的结果：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">phase_5</span><span class="params">(<span class="keyword">char</span> * input)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> a[<span class="number">7</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">strlen</span>(input) != <span class="number">6</span>) explode_bomb();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">6</span> ; i++)</span><br><span class="line">		a[i] = <span class="number">0x4024b0</span>[input[i] &amp; <span class="number">0xf</span>];</span><br><span class="line">	a[<span class="number">6</span>] = <span class="string">'\0'</span>;</span><br><span class="line">	<span class="keyword">int</span> val = strings_not_equal(a, <span class="number">0x40245e</span>);</span><br><span class="line">	<span class="keyword">if</span> (val != <span class="number">0</span>) explode_bomb();</span><br><span class="line">	<span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><br>在GDB中打印0x4024b0和0x40245e所对应的字符串，命令和结果如下所示：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) <span class="built_in">print</span> (char *)0x4024b0</span><br><span class="line"><span class="variable">$1</span> = 0x4024b0 &lt;array&gt; <span class="string">"maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?"</span></span><br><span class="line">(gdb) <span class="built_in">print</span> (char *)0x40245e</span><br><span class="line"><span class="variable">$2</span> = 0x40245e <span class="string">"flyers"</span></span><br></pre></td></tr></table></figure><br>可以看出，phase_5实际上是phase_1的提高。</p>
<p>phase_5要求输入一个6个字符的字符串，通过将取出输入字符串中每个字符的后四位当做偏移地址，以该偏移地址取出地址为0x4024b0处的字符数组中对应的字符，并依次保存在临时数组a中构造一个新的字符串。<br>再将这个新的字符串与0x40245e处的字符串相比较，如果两个字符串相等，则该阶段解除。</p>
<p>0x40245e处的字符串为”flyers”，其每个字符在0x4024b0处的字符数组”maduiersnfotvbyl”中的对应的偏移量为9,15,14,5,6,7。因此只要输入的字符串的后四位换算成10进制分别为9,15,14,5,6,7即可。</p>
<p>本phase的答案不唯一。一个可能的答案为”yo~uvw”，在GDB中运行bomb并验证结果，结果正确。</p>
<h4 id="阶段6-phase-6"><a href="#阶段6-phase-6" class="headerlink" title="阶段6 - phase_6"></a>阶段6 - phase_6</h4><p>本phase是所有phase中最难的一个，但是仍然需要一步一步的分解反汇编代码，并最终得到正确的字符串。<br>在bomb-disassemble中观察phase_6的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">  4010f4:       <span class="number">41</span> <span class="number">56</span>                   <span class="keyword">push</span>   %r14</span><br><span class="line">  4010f6:       <span class="number">41</span> <span class="number">55</span>                   <span class="keyword">push</span>   %r13</span><br><span class="line">  4010f8:       <span class="number">41</span> <span class="number">54</span>                   <span class="keyword">push</span>   %r12</span><br><span class="line">  4010fa:       <span class="number">55</span>                      <span class="keyword">push</span>   %rbp</span><br><span class="line">  4010fb:       <span class="number">53</span>                      <span class="keyword">push</span>   %rbx</span><br><span class="line">  4010fc:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">50</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x50,%rsp</span><br><span class="line">  <span class="number">401100</span>:       <span class="number">49</span> <span class="number">89</span> e5                <span class="keyword">mov</span>    %rsp,%r13</span><br><span class="line">  <span class="number">401103</span>:       <span class="number">48</span> <span class="number">89</span> e6                <span class="keyword">mov</span>    %rsp,%rsi</span><br><span class="line">  <span class="number">401106</span>:       e8 <span class="number">51</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          callq  40145c &lt;read_six_numbers&gt;</span><br><span class="line">  # 读入<span class="number">6</span>个<span class="keyword">int</span>型数字</span><br><span class="line">  40110b:       <span class="number">49</span> <span class="number">89</span> e6                <span class="keyword">mov</span>    %rsp,%r14</span><br><span class="line">  40110e:       <span class="number">41</span> bc <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="keyword">mov</span>    <span class="number">$0</span>x0,%r12d</span><br><span class="line">  <span class="number">401114</span>:       4c <span class="number">89</span> ed                <span class="keyword">mov</span>    %r13,%rbp</span><br><span class="line">  <span class="number">401117</span>:       <span class="number">41</span> 8b <span class="number">45</span> <span class="number">00</span>             <span class="keyword">mov</span>    <span class="number">0x0</span>(%r13),%eax</span><br><span class="line">  40111b:       <span class="number">83</span> e8 <span class="number">01</span>                <span class="keyword">sub</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  40111e:       <span class="number">83</span> f8 <span class="number">05</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x5,%eax</span><br><span class="line">  <span class="number">401121</span>:       <span class="number">76</span> <span class="number">05</span>                   <span class="keyword">jbe</span>    <span class="number">401128</span> &lt;phase_6+<span class="number">0x34</span>&gt;</span><br><span class="line">  <span class="number">401123</span>:       e8 <span class="number">12</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  # 判断数字必须小于等于<span class="number">6</span></span><br><span class="line">  <span class="number">401128</span>:       <span class="number">41</span> <span class="number">83</span> c4 <span class="number">01</span>             <span class="keyword">add</span>    <span class="number">$0</span>x1,%r12d</span><br><span class="line">  40112c:       <span class="number">41</span> <span class="number">83</span> fc <span class="number">06</span>             <span class="keyword">cmp</span>    <span class="number">$0</span>x6,%r12d</span><br><span class="line">  <span class="number">401130</span>:       <span class="number">74</span> <span class="number">21</span>                   <span class="keyword">je</span>     <span class="number">401153</span> &lt;phase_6+<span class="number">0x5f</span>&gt;</span><br><span class="line">  <span class="number">401132</span>:       <span class="number">44</span> <span class="number">89</span> e3                <span class="keyword">mov</span>    %r12d,%ebx</span><br><span class="line">  <span class="number">401135</span>:       <span class="number">48</span> <span class="number">63</span> c3                movslq %ebx,%rax</span><br><span class="line">  <span class="number">401138</span>:       8b <span class="number">04</span> <span class="number">84</span>                <span class="keyword">mov</span>    (%rsp,%rax,<span class="number">4</span>),%eax</span><br><span class="line">  40113b:       <span class="number">39</span> <span class="number">45</span> <span class="number">00</span>                <span class="keyword">cmp</span>    %eax,<span class="number">0x0</span>(%rbp)</span><br><span class="line">  40113e:       <span class="number">75</span> <span class="number">05</span>                   <span class="keyword">jne</span>    <span class="number">401145</span> &lt;phase_6+<span class="number">0x51</span>&gt;</span><br><span class="line">  <span class="number">401140</span>:       e8 f5 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  <span class="number">401145</span>:       <span class="number">83</span> c3 <span class="number">01</span>                <span class="keyword">add</span>    <span class="number">$0</span>x1,%ebx</span><br><span class="line">  <span class="number">401148</span>:       <span class="number">83</span> fb <span class="number">05</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x5,%ebx</span><br><span class="line">  40114b:       7e e8                   <span class="keyword">jle</span>    <span class="number">401135</span> &lt;phase_6+<span class="number">0x41</span>&gt;</span><br><span class="line">  <span class="number">40114d</span>:       <span class="number">49</span> <span class="number">83</span> c5 <span class="number">04</span>             <span class="keyword">add</span>    <span class="number">$0</span>x4,%r13</span><br><span class="line">  <span class="number">401151</span>:       eb c1                   <span class="keyword">jmp</span>    <span class="number">401114</span> &lt;phase_6+<span class="number">0x20</span>&gt;</span><br><span class="line">  # 判断这<span class="number">6</span>个数字两两不重复</span><br><span class="line">  <span class="number">401153</span>:       <span class="number">48</span> <span class="number">8d</span> <span class="number">74</span> <span class="number">24</span> <span class="number">18</span>          <span class="keyword">lea</span>    <span class="number">0x18</span>(%rsp),%rsi</span><br><span class="line">  <span class="number">401158</span>:       4c <span class="number">89</span> f0                <span class="keyword">mov</span>    %r14,%rax</span><br><span class="line">  40115b:       b9 <span class="number">07</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x7,%ecx</span><br><span class="line">  <span class="number">401160</span>:       <span class="number">89</span> ca                   <span class="keyword">mov</span>    %ecx,%edx</span><br><span class="line">  <span class="number">401162</span>:       2b <span class="number">10</span>                   <span class="keyword">sub</span>    (%rax),%edx</span><br><span class="line">  <span class="number">401164</span>:       <span class="number">89</span> <span class="number">10</span>                   <span class="keyword">mov</span>    %edx,(%rax)</span><br><span class="line">  <span class="number">401166</span>:       <span class="number">48</span> <span class="number">83</span> c0 <span class="number">04</span>             <span class="keyword">add</span>    <span class="number">$0</span>x4,%rax</span><br><span class="line">  40116a:       <span class="number">48</span> <span class="number">39</span> f0                <span class="keyword">cmp</span>    %rsi,%rax</span><br><span class="line">  <span class="number">40116d</span>:       <span class="number">75</span> f1                   <span class="keyword">jne</span>    <span class="number">401160</span> &lt;phase_6+<span class="number">0x6c</span>&gt;</span><br><span class="line">  # 分别用<span class="number">7</span>减去这<span class="number">6</span>个数</span><br><span class="line">  40116f:       be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%esi</span><br><span class="line">  <span class="number">401174</span>:       eb <span class="number">21</span>                   <span class="keyword">jmp</span>    <span class="number">401197</span> &lt;phase_6+<span class="number">0xa3</span>&gt;</span><br><span class="line">  <span class="number">401176</span>:       <span class="number">48</span> 8b <span class="number">52</span> <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rdx),%rdx</span><br><span class="line">  40117a:       <span class="number">83</span> c0 <span class="number">01</span>                <span class="keyword">add</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  <span class="number">40117d</span>:       <span class="number">39</span> c8                   <span class="keyword">cmp</span>    %ecx,%eax</span><br><span class="line">  40117f:       <span class="number">75</span> f5                   <span class="keyword">jne</span>    <span class="number">401176</span> &lt;phase_6+<span class="number">0x82</span>&gt;</span><br><span class="line">  <span class="number">401181</span>:       eb <span class="number">05</span>                   <span class="keyword">jmp</span>    <span class="number">401188</span> &lt;phase_6+<span class="number">0x94</span>&gt;</span><br><span class="line">  <span class="number">401183</span>:       ba d0 <span class="number">32</span> <span class="number">60</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x6032d0,%edx</span><br><span class="line">  <span class="number">401188</span>:       <span class="number">48</span> <span class="number">89</span> <span class="number">54</span> <span class="number">74</span> <span class="number">20</span>          <span class="keyword">mov</span>    %rdx,<span class="number">0x20</span>(%rsp,%rsi,<span class="number">2</span>)</span><br><span class="line">  <span class="number">40118d</span>:       <span class="number">48</span> <span class="number">83</span> c6 <span class="number">04</span>             <span class="keyword">add</span>    <span class="number">$0</span>x4,%rsi</span><br><span class="line">  <span class="number">401191</span>:       <span class="number">48</span> <span class="number">83</span> fe <span class="number">18</span>             <span class="keyword">cmp</span>    <span class="number">$0</span>x18,%rsi</span><br><span class="line">  <span class="number">401195</span>:       <span class="number">74</span> <span class="number">14</span>                   <span class="keyword">je</span>     4011ab &lt;phase_6+<span class="number">0xb7</span>&gt;</span><br><span class="line">  <span class="number">401197</span>:       8b 0c <span class="number">34</span>                <span class="keyword">mov</span>    (%rsp,%rsi,<span class="number">1</span>),%ecx</span><br><span class="line">  40119a:       <span class="number">83</span> f9 <span class="number">01</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x1,%ecx</span><br><span class="line">  <span class="number">40119d</span>:       7e e4                   <span class="keyword">jle</span>    <span class="number">401183</span> &lt;phase_6+<span class="number">0x8f</span>&gt;</span><br><span class="line">  40119f:       b8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x1,%eax</span><br><span class="line">  4011a4:       ba d0 <span class="number">32</span> <span class="number">60</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x6032d0,%edx</span><br><span class="line">  4011a9:       eb cb                   <span class="keyword">jmp</span>    <span class="number">401176</span> &lt;phase_6+<span class="number">0x82</span>&gt;</span><br><span class="line">  4011ab:       <span class="number">48</span> 8b 5c <span class="number">24</span> <span class="number">20</span>          <span class="keyword">mov</span>    <span class="number">0x20</span>(%rsp),%rbx</span><br><span class="line">  4011b0:       <span class="number">48</span> <span class="number">8d</span> <span class="number">44</span> <span class="number">24</span> <span class="number">28</span>          <span class="keyword">lea</span>    <span class="number">0x28</span>(%rsp),%rax</span><br><span class="line">  4011b5:       <span class="number">48</span> <span class="number">8d</span> <span class="number">74</span> <span class="number">24</span> <span class="number">50</span>          <span class="keyword">lea</span>    <span class="number">0x50</span>(%rsp),%rsi</span><br><span class="line">  4011ba:       <span class="number">48</span> <span class="number">89</span> d9                <span class="keyword">mov</span>    %rbx,%rcx</span><br><span class="line">  4011bd:       <span class="number">48</span> 8b <span class="number">10</span>                <span class="keyword">mov</span>    (%rax),%rdx</span><br><span class="line">  4011c0:       <span class="number">48</span> <span class="number">89</span> <span class="number">51</span> <span class="number">08</span>             <span class="keyword">mov</span>    %rdx,<span class="number">0x8</span>(%rcx)</span><br><span class="line">  4011c4:       <span class="number">48</span> <span class="number">83</span> c0 <span class="number">08</span>             <span class="keyword">add</span>    <span class="number">$0</span>x8,%rax</span><br><span class="line">  4011c8:       <span class="number">48</span> <span class="number">39</span> f0                <span class="keyword">cmp</span>    %rsi,%rax</span><br><span class="line">  4011cb:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     4011d2 &lt;phase_6+<span class="number">0xde</span>&gt;</span><br><span class="line">  4011cd:       <span class="number">48</span> <span class="number">89</span> d1                <span class="keyword">mov</span>    %rdx,%rcx</span><br><span class="line">  4011d0:       eb eb                   <span class="keyword">jmp</span>    4011bd &lt;phase_6+<span class="number">0xc9</span>&gt;</span><br><span class="line">  4011d2:       <span class="number">48</span> c7 <span class="number">42</span> <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="keyword">movq</span>   <span class="number">$0</span>x0,<span class="number">0x8</span>(%rdx)</span><br><span class="line">  4011d9:       <span class="number">00</span></span><br><span class="line">  4011da:       bd <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x5,%ebp</span><br><span class="line">  4011df:       <span class="number">48</span> 8b <span class="number">43</span> <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rbx),%rax</span><br><span class="line">  4011e3:       8b <span class="number">00</span>                   <span class="keyword">mov</span>    (%rax),%eax</span><br><span class="line">  4011e5:       <span class="number">39</span> <span class="number">03</span>                   <span class="keyword">cmp</span>    %eax,(%rbx)</span><br><span class="line">  4011e7:       <span class="number">7d</span> <span class="number">05</span>                   <span class="keyword">jge</span>    4011ee &lt;phase_6+<span class="number">0xfa</span>&gt;</span><br><span class="line">  4011e9:       e8 4c <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt;</span><br><span class="line">  4011ee:       <span class="number">48</span> 8b 5b <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rbx),%rbx</span><br><span class="line">  4011f2:       <span class="number">83</span> ed <span class="number">01</span>                <span class="keyword">sub</span>    <span class="number">$0</span>x1,%ebp</span><br><span class="line">  4011f5:       <span class="number">75</span> e8                   <span class="keyword">jne</span>    4011df &lt;phase_6+<span class="number">0xeb</span>&gt;</span><br><span class="line">  # 主要是重排链表 并且判断重排后的链表递减 否则引爆bomb</span><br><span class="line">  4011f7:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">50</span>             <span class="keyword">add</span>    <span class="number">$0</span>x50,%rsp</span><br><span class="line">  4011fb:       5b                      <span class="keyword">pop</span>    %rbx</span><br><span class="line">  4011fc:       <span class="number">5d</span>                      <span class="keyword">pop</span>    %rbp</span><br><span class="line">  4011fd:       <span class="number">41</span> 5c                   <span class="keyword">pop</span>    %r12</span><br><span class="line">  4011ff:       <span class="number">41</span> <span class="number">5d</span>                   <span class="keyword">pop</span>    %r13</span><br><span class="line">  <span class="number">401201</span>:       <span class="number">41</span> 5e                   <span class="keyword">pop</span>    %r14</span><br><span class="line">  <span class="number">401203</span>:       c3                      retq   </span><br></pre></td></tr></table></figure><br>由于phase_6的逆向比较复杂，这里只大致介绍该函数的作用——</p>
<ol>
<li>该函数在栈上分配了80个字节，包括了一个有6个int型数字的数组a和一个有6个指针的数组b。</li>
<li>同phase_2一样，该函数调用了read_six_numbers从输入的字符串中读取了6个数字，并且保存到数组a中。</li>
<li>判断这6个数字是否都小于等于6并且互相不重复，如果不满足则引爆炸弹。</li>
<li>分别用7减去这6个数，并且用计算结果覆盖这6个数。既a[i] = 7 - a[i]。</li>
<li>phase_6中引用了来自0x6032d0的结构体数组，该结构体共16个字节，其中前8个字节存放了一个int型的数字（结构体对齐），后8个字节存放了一个指针，该指针在指向结构体数组中的下一个元素。这实际上是一个有6个元素的单向链表。</li>
<li>程序从i=1开始，将结构体数组中的第a[i]个元素的首地址存放进b[i]中，循环6次，直到i=6。</li>
<li>程序从b[1]开始，将b[1]对应的元素的后8个字节对应的地址指向b[2]，直到b[5]-&gt;next = b[6]，将b[6]所对应的元素的后8个字节对应的地址指向0。</li>
<li>然后从b[1]所对应的节点开始，依次判断整个链表是否降序排列，如果不满足降序，则引爆bomb。</li>
</ol>
<p>phase_6是所有phases中最难的一个，其本质是输入1组数字从而实现对单向链表的重排，使得重排后的单向链表降序。</p>
<p>原链表的情况如下：</p>
<table>
<thead>
<tr>
<th style="text-align:center">节点</th>
<th style="text-align:center">1</th>
<th style="text-align:center">2</th>
<th style="text-align:center">3</th>
<th style="text-align:center">4</th>
<th style="text-align:center">5</th>
<th style="text-align:center">6</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">值</td>
<td style="text-align:center">322</td>
<td style="text-align:center">168</td>
<td style="text-align:center">924</td>
<td style="text-align:center">691</td>
<td style="text-align:center">477</td>
<td style="text-align:center">443</td>
</tr>
</tbody>
</table>
<p>因此使得链表降序的输入为：”3 4 5 6 1 2”<br>注意这是用7减过之后的数字序列，原输入序列也就是答案应为：”4 3 2 1 6 5”</p>
<h4 id="隐藏阶段-secret-phase"><a href="#隐藏阶段-secret-phase" class="headerlink" title="隐藏阶段 - secret_phase"></a>隐藏阶段 - secret_phase</h4><p>观察bomb-symboltable和bomb-disassemble我们都能发现一个叫做secret_phase的函数，这就是本次实验中被隐藏起来的phase。</p>
<p>经过观察反汇编代码，我们发现call secret_phase位于phase_defused函数中。</p>
<p>在bomb-disassemble中观察phase_defused的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">00000000004015c4 &lt;phase_defused&gt;:</span><br><span class="line">  4015c4:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">78</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x78,%rsp</span><br><span class="line">  4015c8:       <span class="number">64</span> <span class="number">48</span> 8b <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span>    <span class="keyword">mov</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line">  4015cf:       <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  4015d1:       <span class="number">48</span> <span class="number">89</span> <span class="number">44</span> <span class="number">24</span> <span class="number">68</span>          <span class="keyword">mov</span>    %rax,<span class="number">0x68</span>(%rsp)</span><br><span class="line">  4015d6:       <span class="number">31</span> c0                   <span class="keyword">xor</span>    %eax,%eax</span><br><span class="line">  4015d8:       <span class="number">83</span> <span class="number">3d</span> <span class="number">81</span> <span class="number">21</span> <span class="number">20</span> <span class="number">00</span> <span class="number">06</span>    cmpl   <span class="number">$0</span>x6,<span class="number">0x202181</span>(%rip)        # <span class="number">603760</span> &lt;num_input_strings&gt;</span><br><span class="line">  # 输入过的字符串数目必须为<span class="number">6</span> 意味着必须是phase_6之后</span><br><span class="line">  4015df:       <span class="number">75</span> 5e                   <span class="keyword">jne</span>    40163f &lt;phase_defused+<span class="number">0x7b</span>&gt;</span><br><span class="line">  4015e1:       4c <span class="number">8d</span> <span class="number">44</span> <span class="number">24</span> <span class="number">10</span>          <span class="keyword">lea</span>    <span class="number">0x10</span>(%rsp),%r8</span><br><span class="line">  4015e6:       <span class="number">48</span> <span class="number">8d</span> 4c <span class="number">24</span> 0c          <span class="keyword">lea</span>    <span class="number">0xc</span>(%rsp),%rcx</span><br><span class="line">  4015eb:       <span class="number">48</span> <span class="number">8d</span> <span class="number">54</span> <span class="number">24</span> <span class="number">08</span>          <span class="keyword">lea</span>    <span class="number">0x8</span>(%rsp),%rdx</span><br><span class="line">  4015f0:       be <span class="number">19</span> <span class="number">26</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402619,%esi</span><br><span class="line">  4015f5:       bf <span class="number">70</span> <span class="number">38</span> <span class="number">60</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x603870,%edi</span><br><span class="line">  4015fa:       e8 f1 f5 ff ff          callq  400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  4015ff:       <span class="number">83</span> f8 <span class="number">03</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x3,%eax</span><br><span class="line">  <span class="number">401602</span>:       <span class="number">75</span> <span class="number">31</span>                   <span class="keyword">jne</span>    <span class="number">401635</span> &lt;phase_defused+<span class="number">0x71</span>&gt;</span><br><span class="line">  <span class="number">401604</span>:       be <span class="number">22</span> <span class="number">26</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402622,%esi</span><br><span class="line">  <span class="number">401609</span>:       <span class="number">48</span> <span class="number">8d</span> 7c <span class="number">24</span> <span class="number">10</span>          <span class="keyword">lea</span>    <span class="number">0x10</span>(%rsp),%rdi</span><br><span class="line">  40160e:       e8 <span class="number">25</span> fd ff ff          callq  <span class="number">401338</span> &lt;strings_not_equal&gt;</span><br><span class="line">  # 第<span class="number">4</span>个输入字符串读入两个数字和一个字符串 且字符串必须与<span class="number">0x402622</span>处的字符串相等</span><br><span class="line">  <span class="number">401613</span>:       <span class="number">85</span> c0                   <span class="keyword">test</span>   %eax,%eax</span><br><span class="line">  <span class="number">401615</span>:       <span class="number">75</span> 1e                   <span class="keyword">jne</span>    <span class="number">401635</span> &lt;phase_defused+<span class="number">0x71</span>&gt;</span><br><span class="line">  <span class="number">401617</span>:       bf f8 <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x4024f8,%edi</span><br><span class="line">  40161c:       e8 ef f4 ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  <span class="number">401621</span>:       bf <span class="number">20</span> <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402520,%edi</span><br><span class="line">  <span class="number">401626</span>:       e8 e5 f4 ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40162b:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  <span class="number">401630</span>:       e8 <span class="number">0d</span> fc ff ff          callq  <span class="number">401242</span> &lt;secret_phase&gt;</span><br><span class="line">  # 然后才能进入隐藏阶段</span><br><span class="line">  <span class="number">401635</span>:       bf <span class="number">58</span> <span class="number">25</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402558,%edi</span><br><span class="line">  40163a:       e8 d1 f4 ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40163f:       <span class="number">48</span> 8b <span class="number">44</span> <span class="number">24</span> <span class="number">68</span>          <span class="keyword">mov</span>    <span class="number">0x68</span>(%rsp),%rax</span><br><span class="line">  <span class="number">401644</span>:       <span class="number">64</span> <span class="number">48</span> <span class="number">33</span> <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span>    <span class="keyword">xor</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line">  40164b:       <span class="number">00</span> <span class="number">00</span></span><br><span class="line">  <span class="number">40164d</span>:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     <span class="number">401654</span> &lt;phase_defused+<span class="number">0x90</span>&gt;</span><br><span class="line">  40164f:       e8 dc f4 ff ff          callq  400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  <span class="number">401654</span>:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">78</span>             <span class="keyword">add</span>    <span class="number">$0</span>x78,%rsp</span><br><span class="line">  <span class="number">401658</span>:       c3                      retq   </span><br></pre></td></tr></table></figure><br>当且仅当phase_6解除并且从phase_4的输入字符串依次读取两个数字和一个字符串且这个字符串为”DrEvil”时，可以进入。</p>
<p>在bomb-disassemble中观察secret_phase的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000401242</span> &lt;secret_phase&gt;:</span><br><span class="line">  <span class="number">401242</span>:       <span class="number">53</span>                      <span class="keyword">push</span>   %rbx</span><br><span class="line">  <span class="number">401243</span>:       e8 <span class="number">56</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>          callq  40149e &lt;read_line&gt;</span><br><span class="line">  <span class="number">401248</span>:       ba 0a <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>xa,%edx</span><br><span class="line">  <span class="number">40124d</span>:       be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%esi</span><br><span class="line">  <span class="number">401252</span>:       <span class="number">48</span> <span class="number">89</span> c7                <span class="keyword">mov</span>    %rax,%rdi</span><br><span class="line">  <span class="number">401255</span>:       e8 <span class="number">76</span> f9 ff ff          callq  400bd0 &lt;strtol@plt&gt;</span><br><span class="line">  # 调用strtol函数</span><br><span class="line">  40125a:       <span class="number">48</span> <span class="number">89</span> c3                <span class="keyword">mov</span>    %rax,%rbx</span><br><span class="line">  <span class="number">40125d</span>:       <span class="number">8d</span> <span class="number">40</span> ff                <span class="keyword">lea</span>    -<span class="number">0x1</span>(%rax),%eax</span><br><span class="line">  <span class="number">401260</span>:       <span class="number">3d</span> e8 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">cmp</span>    <span class="number">$0</span>x3e8,%eax</span><br><span class="line">  <span class="number">401265</span>:       <span class="number">76</span> <span class="number">05</span>                   <span class="keyword">jbe</span>    40126c &lt;secret_phase+<span class="number">0x2a</span>&gt;</span><br><span class="line">  <span class="number">401267</span>:       e8 ce <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt; # 如果数字减<span class="number">1</span>之后大于<span class="number">1000</span> 则引爆bomb</span><br><span class="line">  40126c:       <span class="number">89</span> de                   <span class="keyword">mov</span>    %ebx,%esi</span><br><span class="line">  40126e:       bf f0 <span class="number">30</span> <span class="number">60</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x6030f0,%edi</span><br><span class="line">  <span class="number">401273</span>:       e8 8c ff ff ff          callq  <span class="number">401204</span> &lt;fun7&gt;</span><br><span class="line">  # 调用fun7</span><br><span class="line">  <span class="number">401278</span>:       <span class="number">83</span> f8 <span class="number">02</span>                <span class="keyword">cmp</span>    <span class="number">$0</span>x2,%eax</span><br><span class="line">  40127b:       <span class="number">74</span> <span class="number">05</span>                   <span class="keyword">je</span>     <span class="number">401282</span> &lt;secret_phase+<span class="number">0x40</span>&gt;</span><br><span class="line">  <span class="number">40127d</span>:       e8 b8 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>          callq  40143a &lt;explode_bomb&gt; # 如果fun7返回值不为<span class="number">2</span> 则引爆bomb</span><br><span class="line">  <span class="number">401282</span>:       bf <span class="number">38</span> <span class="number">24</span> <span class="number">40</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x402438,%edi</span><br><span class="line">  <span class="number">401287</span>:       e8 <span class="number">84</span> f8 ff ff          callq  400b10 &lt;puts@plt&gt;</span><br><span class="line">  40128c:       e8 <span class="number">33</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>          callq  4015c4 &lt;phase_defused&gt;</span><br><span class="line">  <span class="number">401291</span>:       5b                      <span class="keyword">pop</span>    %rbx</span><br><span class="line">  <span class="number">401292</span>:       c3                      retq   </span><br></pre></td></tr></table></figure><br>根据反汇编的结果，我们可以得知，secret_phase同样需要读入一个字符串，之后其首先调用strtol(input, NULL, 10)将输入的字符串转换成long型数字a。</p>
<p>如果该数字&gt;1001，则引爆bomb，否则则调用fun7(0x6030f0, a)并判断其返回结果，当且仅当结果为2时，解除secret_phase。</p>
<p>在bomb-disassemble中观察fun7的反汇编代码，如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000000401204</span> &lt;fun7&gt;:</span><br><span class="line">  <span class="number">401204</span>:       <span class="number">48</span> <span class="number">83</span> ec <span class="number">08</span>             <span class="keyword">sub</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  <span class="number">401208</span>:       <span class="number">48</span> <span class="number">85</span> ff                <span class="keyword">test</span>   %rdi,%rdi</span><br><span class="line">  40120b:       <span class="number">74</span> 2b                   <span class="keyword">je</span>     <span class="number">401238</span> &lt;fun7+<span class="number">0x34</span>&gt;</span><br><span class="line">  <span class="number">40120d</span>:       8b <span class="number">17</span>                   <span class="keyword">mov</span>    (%rdi),%edx</span><br><span class="line">  40120f:       <span class="number">39</span> f2                   <span class="keyword">cmp</span>    %esi,%edx</span><br><span class="line">  <span class="number">401211</span>:       7e <span class="number">0d</span>                   <span class="keyword">jle</span>    <span class="number">401220</span> &lt;fun7+<span class="number">0x1c</span>&gt;</span><br><span class="line">  <span class="number">401213</span>:       <span class="number">48</span> 8b 7f <span class="number">08</span>             <span class="keyword">mov</span>    <span class="number">0x8</span>(%rdi),%rdi</span><br><span class="line">  <span class="number">401217</span>:       e8 e8 ff ff ff          callq  <span class="number">401204</span> &lt;fun7&gt;</span><br><span class="line">  40121c:       <span class="number">01</span> c0                   <span class="keyword">add</span>    %eax,%eax</span><br><span class="line">  40121e:       eb <span class="number">1d</span>                   <span class="keyword">jmp</span>    <span class="number">40123d</span> &lt;fun7+<span class="number">0x39</span>&gt;</span><br><span class="line">  <span class="number">401220</span>:       b8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          <span class="keyword">mov</span>    <span class="number">$0</span>x0,%eax</span><br><span class="line">  <span class="number">401225</span>:       <span class="number">39</span> f2                   <span class="keyword">cmp</span>    %esi,%edx</span><br><span class="line">  <span class="number">401227</span>:       <span class="number">74</span> <span class="number">14</span>                   <span class="keyword">je</span>     <span class="number">40123d</span> &lt;fun7+<span class="number">0x39</span>&gt;</span><br><span class="line">  <span class="number">401229</span>:       <span class="number">48</span> 8b 7f <span class="number">10</span>             <span class="keyword">mov</span>    <span class="number">0x10</span>(%rdi),%rdi</span><br><span class="line">  <span class="number">40122d</span>:       e8 d2 ff ff ff          callq  <span class="number">401204</span> &lt;fun7&gt;</span><br><span class="line">  <span class="number">401232</span>:       <span class="number">8d</span> <span class="number">44</span> <span class="number">00</span> <span class="number">01</span>             <span class="keyword">lea</span>    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line">  <span class="number">401236</span>:       eb <span class="number">05</span>                   <span class="keyword">jmp</span>    <span class="number">40123d</span> &lt;fun7+<span class="number">0x39</span>&gt;</span><br><span class="line">  <span class="number">401238</span>:       b8 ff ff ff ff          <span class="keyword">mov</span>    <span class="number">$0</span>xffffffff,%eax</span><br><span class="line">  <span class="number">40123d</span>:       <span class="number">48</span> <span class="number">83</span> c4 <span class="number">08</span>             <span class="keyword">add</span>    <span class="number">$0</span>x8,%rsp</span><br><span class="line">  <span class="number">401241</span>:       c3                      retq   </span><br><span class="line">  # 同样是递归的二分查找过程 数据结构是BST二叉搜索树</span><br></pre></td></tr></table></figure><br>将fun7逆向，结果如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tree</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> val;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tree</span> * <span class="title">left</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">tree</span> * <span class="title">right</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fun7</span><span class="params">(struct tree * ptr, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (ptr == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">if</span> (ptr-&gt;val == num) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (ptr-&gt;val &lt; num) &#123;</span><br><span class="line">		ptr = ptr-&gt;right;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span> * fun7(ptr, num) + <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ptr = ptr-&gt;left;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span> * fun7(ptr, num);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;		 </span><br></pre></td></tr></table></figure><br>其中，ptr所指向的struct tree是一棵二叉搜索树的根节点。对于二叉搜索树的任意一个节点，节点左边孩子的值全部小于该节点的值，节点右边孩子的值全部大于该节点的值。</p>
<p>这棵根节点位于0x6030f0的二叉搜索树的结构如下图所示：<br><div class="figure " style="width:;"><img class="fig-img" src="BST.png" alt=""></div></p>
<p>要令fun7返回的结果为2，一种可行的递归返回情况是0-&gt;(2<em>0+1)=1-&gt;(1</em>2)=2。在该情况下，递归深度为2，节点的移动路线为左-&gt;右，并且在值为22的节点返回0。这表明，fun7的第二个参数，也就是secret_phase的正确答案，为”22”。</p>
<p>在GDB中运行bomb并验证结果，结果正确。</p>
<h2 id="实验答案"><a href="#实验答案" class="headerlink" title="实验答案"></a>实验答案</h2><blockquote>
<p>注意，有部分答案不唯一，并且Bomb Lab每年都在更新，所以答案可能会有所变化。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Border relations with Canada have never been better.</span><br><span class="line">1 2 4 8 16 32</span><br><span class="line">1 311</span><br><span class="line">0 0 DrEvil</span><br><span class="line">yo~uvw</span><br><span class="line">4 3 2 1 6 5</span><br><span class="line">22</span><br></pre></td></tr></table></figure>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/实验/">实验</a> <a class="tag tag--primary tag--small t-link" href="/tags/计算机系统/">计算机系统</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/09/深入理解计算机系统AttackLab实验报告/" data-tooltip="深入理解计算机系统AttackLab实验报告" aria-label="上一篇: 深入理解计算机系统AttackLab实验报告">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/04/深入理解计算机系统DataLab实验报告/" data-tooltip="深入理解计算机系统DataLab实验报告" aria-label="下一篇: 深入理解计算机系统DataLab实验报告">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Facebook">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Twitter">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Weibo">
                    <i class="fa fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/&amp;title=深入理解计算机系统BombLab实验报告" title="分享到 QQ">
                    <i class="fa fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Qzone">
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 码龙黑曜. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/05/09/深入理解计算机系统AttackLab实验报告/" data-tooltip="深入理解计算机系统AttackLab实验报告" aria-label="上一篇: 深入理解计算机系统AttackLab实验报告">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/04/04/深入理解计算机系统DataLab实验报告/" data-tooltip="深入理解计算机系统DataLab实验报告" aria-label="下一篇: 深入理解计算机系统DataLab实验报告">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Facebook">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Twitter">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Weibo">
                    <i class="fa fa-weibo" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/&amp;title=深入理解计算机系统BombLab实验报告" title="分享到 QQ">
                    <i class="fa fa-qq" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/" title="分享到 Qzone">
                    <i class="fa fa-star" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i><span>分享到 Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/">
                    <i class="fa fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://service.weibo.com/share/share.php?&amp;title=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/">
                    <i class="fa fa-weibo" aria-hidden="true"></i><span>分享到 Weibo</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/&amp;title=深入理解计算机系统BombLab实验报告">
                    <i class="fa fa-qq" aria-hidden="true"></i><span>分享到 QQ</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.codedragon.tech/2017/04/18/深入理解计算机系统BombLab实验报告/">
                    <i class="fa fa-star" aria-hidden="true"></i><span>分享到 Qzone</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
            <h4 id="about-card-name">码龙黑曜</h4>
        
            <div id="about-card-bio"><p>iOS开发者/计算机科学/兽人控</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>华中科技大学 本科在读</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Wuhan, China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-feiabjni254mgbxiozwsjblcsiodjqohurk0dcfkq0aooroewq6bvkdnadrg.min.js"></script>
<!--SCRIPTS END-->

    



    </body>
</html>
