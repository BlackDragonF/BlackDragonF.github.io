
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="码龙的窝">
    <title>深入理解计算机系统CacheLab-PartA实验报告 - 码龙的窝</title>
    <meta name="author" content="CoSidian">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="实验答案托管在我的GitHub上  考完试之后一直比较颓废，本来想看完《深入理解计算机系统》的第5章——优化程序性能之后就赶快来做实验的，后来发现无论是Cache Lab还是Performance Lab都需要第6章——存储器层次结构的知识。看了几天的书，又磨蹭了几天，终于把Cache Lab的Part A写完了，总结如下。  实验简介Cache Lab - Understanding Cache">
<meta name="keywords" content="计算机系统,实验">
<meta property="og:type" content="blog">
<meta property="og:title" content="深入理解计算机系统CacheLab-PartA实验报告">
<meta property="og:url" content="http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/index.html">
<meta property="og:site_name" content="码龙的窝">
<meta property="og:description" content="实验答案托管在我的GitHub上  考完试之后一直比较颓废，本来想看完《深入理解计算机系统》的第5章——优化程序性能之后就赶快来做实验的，后来发现无论是Cache Lab还是Performance Lab都需要第6章——存储器层次结构的知识。看了几天的书，又磨蹭了几天，终于把Cache Lab的Part A写完了，总结如下。  实验简介Cache Lab - Understanding Cache">
<meta property="og:updated_time" content="2017-07-19T17:24:45.759Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入理解计算机系统CacheLab-PartA实验报告">
<meta name="twitter:description" content="实验答案托管在我的GitHub上  考完试之后一直比较颓废，本来想看完《深入理解计算机系统》的第5章——优化程序性能之后就赶快来做实验的，后来发现无论是Cache Lab还是Performance Lab都需要第6章——存储器层次结构的知识。看了几天的书，又磨蹭了几天，终于把Cache Lab的Part A写完了，总结如下。  实验简介Cache Lab - Understanding Cache">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/font-awesome.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">码龙的窝</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="首页"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="分类"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="标签"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="归档"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                            title="搜索"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="关于"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/atom.xml"
                            
                            title="RSS"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            深入理解计算机系统CacheLab-PartA实验报告
        </h1>
    
    
        <div class="post-meta">
    <time itemprop="datePublished" datetime="2017-07-08T17:55:51+08:00">
	
		    7月 08, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/计算机系统/">计算机系统</a>


    
</div>

    
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>实验答案托管在我的<a href="https://github.com/BlackDragonF/CSAPPLabs/tree/master/CacheLab" target="_blank" rel="external">GitHub</a>上</p>
<blockquote>
<p>考完试之后一直比较颓废，本来想看完《深入理解计算机系统》的第5章——优化程序性能之后就赶快来做实验的，后来发现无论是Cache Lab还是Performance Lab都需要第6章——存储器层次结构的知识。看了几天的书，又磨蹭了几天，终于把Cache Lab的Part A写完了，总结如下。</p>
</blockquote>
<h2 id="实验简介"><a href="#实验简介" class="headerlink" title="实验简介"></a>实验简介</h2><p>Cache Lab - Understanding Cache Memories主要是有关缓存的实验，对应于书本的第6章：存储器层次结构。主要阐明了缓存对于C语言程序的性能影响。</p>
<p>本实验主要分为两个部分。第一个部分要求完成一个C语言程序用来模拟缓存的行为；而第二个部分要求优化一个小的矩阵变换函数，使其具有尽可能小的缓存不命中率。</p>
<p>关于本实验的具体介绍详见<a href="http://csapp.cs.cmu.edu/3e/archlab32-handout.tar" target="_blank" rel="external">实验讲义</a>。</p>
<h2 id="实验介绍"><a href="#实验介绍" class="headerlink" title="实验介绍"></a>实验介绍</h2><p>实验讲义中的traces子文件夹下包含了一组reference trace files，用来作为评估Part A中缓存模拟器正确性的样例数据。这些文件是由valgrind生成的。</p>
<p>Valgrind是一个用于内存调试，内存泄露以及性能分析的软件。例如，我们输入如下的命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">linux&gt; valgrind --<span class="built_in">log</span>-fd=1 --tool=lackey -v --trace-mem=yes ls -l</div></pre></td></tr></table></figure><br>valgrind会在命令行中执行ls -l命令并且按照顺序记录该命令的每一次内存访问，并且将其输出到标准输出流中。</p>
<p>下面是一个valgrind的输出样例：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">I 0400d7d4,8</div><div class="line"> M 0421c7f0,4</div><div class="line"> L 04f6b868,8</div><div class="line"> S 7ff0005c8,8</div></pre></td></tr></table></figure></p>
<p>每一行的基本格式如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[空格]操作 地址,大小</div></pre></td></tr></table></figure><br>操作代表了内存访问的种类，<code>&#39;I&#39;</code>代表的是指令加载，<code>&#39;L&#39;</code>代表的是数据加载，<code>&#39;S&#39;</code>代表的是数据存储，<code>&#39;M&#39;</code>代表的是数据修改（如一条数据加载之后紧跟着数据存储）。在<code>&#39;I&#39;</code>之前永远没有空格，而其他的操作前必定有前置空格。<br>地址代表的是一个64位的16进制内存地址。<br>大小指明了该次内存访问涉及的字节数。</p>
<h2 id="实验要求-Part-A"><a href="#实验要求-Part-A" class="headerlink" title="实验要求 - Part A"></a>实验要求 - Part A</h2><p>在Part A中你需要在csim.c中实现一个LRU驱逐机制的缓存模拟器，该模拟器接收valgrind的trace作为输入，模拟一个缓存在该情况下的命中/不命中情况，并且输出所有的命中，不命中以及驱逐的次数。</p>
<p>本实验已经提供了一个用来参考的缓存模拟器csim-ref，其使用方式以及输出如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Usage: ./csim-ref [-hv] -s &lt;s&gt; -E &lt;E&gt; -b &lt;b&gt; -t &lt;tracefile&gt;</div><div class="line">• -h: Optional <span class="built_in">help</span> flag that prints usage info</div><div class="line">• -v: Optional verbose flag that displays trace info</div><div class="line">• -s &lt;s&gt;: Number of <span class="built_in">set</span> index bits (S = 2 s is the number of sets)</div><div class="line">• -E &lt;E&gt;: Associativity (number of lines per <span class="built_in">set</span>)</div><div class="line">• -b &lt;b&gt;: Number of block bits (B = 2 b is the block size)</div><div class="line">• -t &lt;tracefile&gt;: Name of the valgrind trace to replay</div><div class="line"></div><div class="line">linux&gt; ./csim-ref -s 4 -E 1 -b 4 -t traces/yi.trace</div><div class="line">hits:4 misses:5 evictions:3</div><div class="line"></div><div class="line">linux&gt; ./csim-ref -v -s 4 -E 1 -b 4 -t traces/yi.trace</div><div class="line">L 10,1 miss</div><div class="line">M 20,1 miss hit</div><div class="line">L 22,1 hit</div><div class="line">S 18,1 hit</div><div class="line">L 110,1 miss eviction</div><div class="line">L 210,1 miss eviction</div><div class="line">M 12,1 miss eviction hit</div><div class="line">hits:4 misses:5 evictions:3</div></pre></td></tr></table></figure></p>
<p>对于Part A有以下的要求和限制：</p>
<ol>
<li>所写的程序编译时不能有任何的警告</li>
<li>能应对不同s，E和b的缓存生成对应的结果，这要求使用malloc来为你的数据结构分配空间</li>
<li>不需要考虑指令加载的缓存情况</li>
<li>调用printSummary打印最终的结果</li>
<li>假定数据已经适当对齐，不会出现一次数据加载跨区块的情况。这样，你可以忽略trace中的大小</li>
</ol>
<p>除此以外，实验的自学者讲义中还包含了一些提示，这里就不再赘述。</p>
<p>完成了Part A之后，可以用<code>make clean &amp;&amp; make</code>进行编译，并且用<code>./test-csim</code>进行自动评分，总共有8组样例，共27分满分。</p>
<h2 id="实验过程-Part-A"><a href="#实验过程-Part-A" class="headerlink" title="实验过程 - Part A"></a>实验过程 - Part A</h2><h3 id="实验思路"><a href="#实验思路" class="headerlink" title="实验思路"></a>实验思路</h3><p>整个模拟器在思路上可以进行如下的拆分：</p>
<h4 id="1-命令行参数解析"><a href="#1-命令行参数解析" class="headerlink" title="1.命令行参数解析"></a>1.命令行参数解析</h4><p>由于该模拟器是命令行程序并且接受命令行参数，因此需要能对命令行参数进行解析和处理，这里推荐使用getopt进行参数的解析。并且根据不同的参数执行不同的控制流，并且处理一些基本的错误如参数缺失以及参数类型错误。</p>
<h4 id="2-数据结构"><a href="#2-数据结构" class="headerlink" title="2.数据结构"></a>2.数据结构</h4><p>这是整个模拟器最基本的部分。我们需要创建合适的数据结构来模拟缓存，该数据结构不仅要能模拟缓存的数据的实际组织方式（有效位，标志位以及行和块等等），还需要考虑到LRU的驱逐机制。</p>
<h4 id="3-文件中内存访问记录的处理和解析"><a href="#3-文件中内存访问记录的处理和解析" class="headerlink" title="3.文件中内存访问记录的处理和解析"></a>3.文件中内存访问记录的处理和解析</h4><p>这个是模拟器中核心的部分。模拟器的功能就是从文件中接收内存访问记录，并且根据这些记录来模拟缓存的行为，操作我们所设计的缓存的数据结构。</p>
<h3 id="实验代码"><a href="#实验代码" class="headerlink" title="实验代码"></a>实验代码</h3><p>该代码仅供参考，很可能并不是一个非常好的解法。如果你也在面对同样的实验，<strong>请不要抄袭</strong>，毕竟抄袭是不会使你变得更强的:)<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* include necessary headers */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"cachelab.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"getopt.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdlib.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"unistd.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"string.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdio.h"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdint.h"</span></span></div><div class="line"></div><div class="line"><span class="comment">/* cache struct definition */</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CSim_Cache_Entry</span> &#123;</span></div><div class="line">    <span class="keyword">char</span> valid_bit;</div><div class="line">    <span class="keyword">uint64_t</span> tag_bit;</div><div class="line">&#125;CSim_Cache_Entry;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CSim_Cache_Set</span>&#123;</span></div><div class="line">    CSim_Cache_Entry * entries;</div><div class="line">&#125;CSim_Cache_Set;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CSim_Cache</span> &#123;</span></div><div class="line">    <span class="comment">/* basic arguments */</span></div><div class="line">    <span class="keyword">int</span> block_offset;</div><div class="line">    <span class="keyword">int</span> set_number;</div><div class="line">    <span class="keyword">int</span> line_number;</div><div class="line">    <span class="comment">/* masks and offsets */</span></div><div class="line">    <span class="keyword">int</span> tag_offset;</div><div class="line">    <span class="keyword">int</span> set_offset;</div><div class="line">    <span class="keyword">uint64_t</span> tag_mask;</div><div class="line">    <span class="keyword">uint64_t</span> set_mask;</div><div class="line">    <span class="comment">/* cache */</span></div><div class="line">    CSim_Cache_Set * sets;</div><div class="line">&#125;CSim_Cache;</div><div class="line"></div><div class="line"><span class="comment">/* simulation result definition */</span></div><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">CSim_Cache_Result</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> hit;</div><div class="line">    <span class="keyword">int</span> miss;</div><div class="line">    <span class="keyword">int</span> evict;</div><div class="line">&#125;CSim_Cache_Result;</div><div class="line"></div><div class="line"><span class="comment">/* operation type definition */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> CSIM_OPERATION_TYPE &#123;</div><div class="line">    CSIM_OPERATION_TYPE_NONE,</div><div class="line">    CSIM_OPERATION_TYPE_MODIFY,</div><div class="line">    CSIM_OPERATION_TYPE_LOAD,</div><div class="line">    CSIM_OPERATION_TYPE_STORE,</div><div class="line">&#125;CSIM_OPERATION_TYPE;</div><div class="line"></div><div class="line"><span class="comment">/* operation result definition */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> CSIM_OPERATION_RESULT &#123;</div><div class="line">    CSIM_OPERATION_RESULT_MISS,</div><div class="line">    CSIM_OPERATION_RESULT_HIT,</div><div class="line">    CSIM_OPERATION_RESULT_MISS_EVICTION,</div><div class="line">&#125;CSIM_OPERATION_RESULT;</div><div class="line"></div><div class="line"><span class="comment">/* error definition */</span></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> CSIM_ERROR &#123;</div><div class="line">    CSIM_OK = <span class="number">0</span>,</div><div class="line">    CSIM_ERROR_INVALID_OPTION,</div><div class="line">    CSIM_ERROR_MISSING_ARGUMENT,</div><div class="line">    CSIM_ERROR_FILE_CANNOT_OPEN,</div><div class="line">    CSIM_ERROR_OUT_OF_MEMORY,</div><div class="line">&#125;CSIM_ERROR;</div><div class="line"></div><div class="line"><span class="comment">/* macro definition for get a value given mask and offset */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> csim_get_value(number, mask, offset) (((number) &amp; (mask)) &gt;&gt; (offset))</span></div><div class="line"></div><div class="line"><span class="comment">/* function list */</span></div><div class="line"><span class="comment">/* message print functions */</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_print_help_info</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_error_missing_argument</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_error_file_cannot_open</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_error_out_of_memory</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">/* cache structure related functions */</span></div><div class="line"><span class="function">CSim_Cache * <span class="title">csim_construct_cache</span><span class="params">(<span class="keyword">int</span> set_number, <span class="keyword">int</span> line_number, <span class="keyword">int</span> block_offset)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_deconstruct_cache</span><span class="params">(CSim_Cache ** pcache)</span></span>;</div><div class="line"><span class="comment">/* cache simulation function */</span></div><div class="line"><span class="function">CSim_Cache_Result <span class="title">csim_parse_trace_file</span><span class="params">(CSim_Cache * cache, FILE * file_pointer, <span class="keyword">char</span> verbose_flag)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">/* global variable */</span></div><div class="line"><span class="keyword">char</span> * program_name = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_print_help_info</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Usage: ./csim [-hv] -s &lt;num&gt; -E &lt;num&gt; -b &lt;num&gt; -t &lt;file&gt;\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Options:\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  -h         Print this help message.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  -v         Optional verbose flag.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  -s &lt;num&gt;   Number of set index bits.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  -E &lt;num&gt;   Number of lines per set.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  -b &lt;num&gt;   Number of block offset bits.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  -t &lt;file&gt;  Trace file.\n\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Examples:\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  linux&gt;  ./csim -s 4 -E 1 -b 4 -t traces/yi.trace\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"  linux&gt;  ./csim -v -s 8 -E 2 -b 4 -t traces/yi.trace\n"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_error_missing_argument</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s: Missing required command line argument\n"</span>, program_name);</div><div class="line">    csim_print_help_info();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_error_file_cannot_open</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s: No such file or directory\n"</span>, program_name);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_error_out_of_memory</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%s: Out of memory\n"</span>, program_name);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">CSim_Cache * <span class="title">csim_construct_cache</span><span class="params">(<span class="keyword">int</span> set_number, <span class="keyword">int</span> line_number, <span class="keyword">int</span> block_offset)</span> </span>&#123;</div><div class="line">    <span class="comment">/* memory allocation */</span></div><div class="line">    CSim_Cache * cache = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(CSim_Cache));</div><div class="line">    <span class="keyword">if</span> (cache == <span class="literal">NULL</span>) &#123;</div><div class="line">        csim_error_out_of_memory();</div><div class="line">        <span class="built_in">exit</span>(CSIM_ERROR_OUT_OF_MEMORY);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/* configure basic arguments */</span></div><div class="line">    cache-&gt;set_number = set_number;</div><div class="line">    cache-&gt;line_number = line_number;</div><div class="line">    cache-&gt;block_offset = block_offset;</div><div class="line">    <span class="comment">/* caculate masks and offsets */</span></div><div class="line">    cache-&gt;tag_mask = ((<span class="keyword">uint64_t</span>)<span class="number">0xFFFFFFFFFFFFFFFF</span>) &lt;&lt; (block_offset + set_number);</div><div class="line">    cache-&gt;tag_offset = block_offset + set_number;</div><div class="line">    cache-&gt;set_mask = ((((((<span class="keyword">uint64_t</span>)<span class="number">0xFFFFFFFFFFFFFFFF</span>) &lt;&lt; (<span class="number">64</span> - cache-&gt;tag_offset)) &gt;&gt; (<span class="number">64</span> - cache-&gt;tag_offset)) &gt;&gt; block_offset) &lt;&lt; block_offset);</div><div class="line">    cache-&gt;set_offset = block_offset;</div><div class="line">    <span class="comment">/* memory allocation for cache */</span></div><div class="line">    cache-&gt;sets = <span class="built_in">calloc</span>((<span class="number">1</span> &lt;&lt; set_number), <span class="keyword">sizeof</span>(CSim_Cache_Set));</div><div class="line">    <span class="keyword">if</span> (cache-&gt;sets == <span class="literal">NULL</span>) &#123;</div><div class="line">        csim_error_out_of_memory();</div><div class="line">        <span class="built_in">exit</span>(CSIM_ERROR_OUT_OF_MEMORY);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span> ; index &lt; (<span class="number">1</span> &lt;&lt; set_number) ; ++index) &#123;</div><div class="line">        (cache-&gt;sets)[index].entries = <span class="built_in">calloc</span>(line_number, <span class="keyword">sizeof</span>(CSim_Cache_Entry));</div><div class="line">        <span class="keyword">if</span> ((cache-&gt;sets)[index].entries == <span class="literal">NULL</span>) &#123;</div><div class="line">            csim_error_out_of_memory();</div><div class="line">            <span class="built_in">exit</span>(CSIM_ERROR_OUT_OF_MEMORY);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> cache;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">csim_deconstruct_cache</span><span class="params">(CSim_Cache ** pcache)</span> </span>&#123;</div><div class="line">    <span class="comment">/* release cache according to construct function */</span></div><div class="line">    CSim_Cache * temp = *pcache;</div><div class="line">    <span class="keyword">int</span> set_number = temp-&gt;set_number;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> index = <span class="number">0</span> ; index &lt; set_number ; ++index) &#123;</div><div class="line">        <span class="built_in">free</span>((temp-&gt;sets)[index].entries);</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">free</span>(temp-&gt;sets);</div><div class="line">    <span class="built_in">free</span>(temp);</div><div class="line">    *pcache = <span class="literal">NULL</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">CSim_Cache_Result <span class="title">csim_parse_trace_file</span><span class="params">(CSim_Cache * cache, FILE * file_pointer, <span class="keyword">char</span> verbose_flag)</span> </span>&#123;</div><div class="line">    <span class="comment">/* file I/O related */</span></div><div class="line">    <span class="keyword">char</span> line[<span class="number">80</span>];</div><div class="line">    <span class="keyword">char</span> * line_pointer = <span class="literal">NULL</span>;</div><div class="line">    <span class="comment">/* cache type and cache result */</span></div><div class="line">    CSIM_OPERATION_TYPE type;</div><div class="line">    CSIM_OPERATION_RESULT result;</div><div class="line">    <span class="comment">/* address and set index &amp; tag bis from it */</span></div><div class="line">    <span class="keyword">int</span> address = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> <span class="built_in">set</span> = <span class="number">0</span>, tag = <span class="number">0</span>;</div><div class="line">    <span class="comment">/* line number */</span></div><div class="line">    <span class="keyword">int</span> line_number = cache-&gt;line_number;</div><div class="line">    <span class="comment">/* simulation result */</span></div><div class="line">    CSim_Cache_Result summary = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</div><div class="line">    <span class="comment">/* parsing process */</span></div><div class="line">    <span class="keyword">while</span> (fgets(line, <span class="number">80</span>, file_pointer), feof(file_pointer) == <span class="number">0</span>) &#123;</div><div class="line">        line_pointer = line;</div><div class="line">        type = CSIM_OPERATION_TYPE_NONE;</div><div class="line">        <span class="comment">/* exclude instrction load */</span></div><div class="line">        <span class="keyword">if</span> (*line_pointer++ == <span class="string">' '</span>) &#123;</div><div class="line">            <span class="keyword">switch</span>(*line_pointer++) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">'L'</span>:</div><div class="line">                    type = CSIM_OPERATION_TYPE_LOAD;</div><div class="line">                    <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                        <span class="built_in">putchar</span>(<span class="string">'L'</span>);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'S'</span>:</div><div class="line">                    type = CSIM_OPERATION_TYPE_STORE;</div><div class="line">                    <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                        <span class="built_in">putchar</span>(<span class="string">'S'</span>);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="string">'M'</span>:</div><div class="line">                    type = CSIM_OPERATION_TYPE_MODIFY;</div><div class="line">                    <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                        <span class="built_in">putchar</span>(<span class="string">'M'</span>);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    type = CSIM_OPERATION_TYPE_NONE;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            result = CSIM_OPERATION_RESULT_MISS_EVICTION;</div><div class="line">            <span class="built_in">sscanf</span>(line_pointer, <span class="string">"%x"</span>, &amp;address);</div><div class="line">            <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                <span class="keyword">while</span> ((*line_pointer) != <span class="string">'\n'</span>) &#123;</div><div class="line">                    <span class="built_in">putchar</span>(*line_pointer++);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">/* separate set and tag according to mask and offset */</span></div><div class="line">            <span class="built_in">set</span> = csim_get_value(address, cache-&gt;set_mask, cache-&gt;set_offset);</div><div class="line">            tag = csim_get_value(address, cache-&gt;tag_mask, cache-&gt;tag_offset);</div><div class="line">            <span class="comment">/* determine the cache result */</span></div><div class="line">            CSim_Cache_Entry * pentry = (cache-&gt;sets)[<span class="built_in">set</span>].entries;</div><div class="line">            <span class="keyword">int</span> index;</div><div class="line">            CSim_Cache_Entry temp;</div><div class="line">            <span class="keyword">for</span> (index = <span class="number">0</span>; index &lt; line_number ; ++index) &#123;</div><div class="line">                <span class="keyword">if</span> (!pentry[index].valid_bit) &#123;</div><div class="line">                    result = CSIM_OPERATION_RESULT_MISS;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (pentry[index].tag_bit == tag) &#123;</div><div class="line">                    result = CSIM_OPERATION_RESULT_HIT;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">/* simulate according to the result of cache behavior */</span></div><div class="line">            <span class="keyword">switch</span>(result) &#123;</div><div class="line">                <span class="keyword">case</span> CSIM_OPERATION_RESULT_MISS:</div><div class="line">                    <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                        <span class="built_in">printf</span>(<span class="string">" miss"</span>);</div><div class="line">                    &#125;</div><div class="line">                    pentry[index].valid_bit = <span class="number">1</span>;</div><div class="line">                    pentry[index].tag_bit = tag;</div><div class="line">                    summary.miss++;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> CSIM_OPERATION_RESULT_MISS_EVICTION:</div><div class="line">                    <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                        <span class="built_in">printf</span>(<span class="string">" miss eviction"</span>);</div><div class="line">                    &#125;</div><div class="line">                    pentry[<span class="number">0</span>].tag_bit = tag;</div><div class="line">                    temp = pentry[<span class="number">0</span>];</div><div class="line">                    <span class="keyword">for</span> (index = <span class="number">0</span> ; index &lt; line_number - <span class="number">1</span> ; ++index) &#123;</div><div class="line">                        pentry[index] = pentry[index + <span class="number">1</span>];</div><div class="line">                    &#125;</div><div class="line">                    pentry[index] = temp;</div><div class="line">                    summary.miss++;</div><div class="line">                    summary.evict++;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> CSIM_OPERATION_RESULT_HIT:</div><div class="line">                    <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                        <span class="built_in">printf</span>(<span class="string">" hit"</span>);</div><div class="line">                    &#125;</div><div class="line">                    temp = pentry[index];</div><div class="line">                    <span class="keyword">for</span> ( ; (index &lt; line_number - <span class="number">1</span>) &amp;&amp; (pentry[index + <span class="number">1</span>].valid_bit) ; ++index) &#123;</div><div class="line">                        pentry[index] = pentry[index + <span class="number">1</span>];</div><div class="line">                    &#125;</div><div class="line">                    pentry[index] = temp;</div><div class="line">                    summary.hit++;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (type == CSIM_OPERATION_TYPE_MODIFY) &#123;</div><div class="line">                <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">" hit"</span>);</div><div class="line">                &#125;</div><div class="line">                summary.hit++;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (verbose_flag) &#123;</div><div class="line">                <span class="built_in">putchar</span>(<span class="string">'\n'</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> summary;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</div><div class="line">    <span class="comment">/* variables for argument parsing */</span></div><div class="line">    <span class="keyword">char</span> h = <span class="number">0</span>, v = <span class="number">0</span>, s = <span class="number">0</span>, E = <span class="number">0</span>, b = <span class="number">0</span>, t = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> opt;</div><div class="line">    <span class="comment">/* cache arguments */</span></div><div class="line">    <span class="keyword">int</span> set_number = <span class="number">0</span>, line_number = <span class="number">0</span>, block_offset = <span class="number">0</span>;</div><div class="line">    <span class="comment">/* cache */</span></div><div class="line">    CSim_Cache * cache = <span class="literal">NULL</span>;</div><div class="line">    <span class="comment">/* file path */</span></div><div class="line">    <span class="keyword">char</span> file_path[<span class="number">80</span>];</div><div class="line">    <span class="comment">/* verbose flag */</span></div><div class="line">    <span class="keyword">char</span> verbose_flag = <span class="number">0</span>;</div><div class="line">    <span class="comment">/* summary */</span></div><div class="line">    CSim_Cache_Result summary = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</div><div class="line">    <span class="comment">/* pre-operation */</span></div><div class="line">    program_name = argv[<span class="number">0</span>];</div><div class="line">    <span class="comment">/* argument parsing */</span></div><div class="line">    <span class="keyword">while</span> ((opt = getopt(argc, argv, <span class="string">"hvs:E:b:t:"</span>)) != <span class="number">-1</span>) &#123;</div><div class="line">        <span class="keyword">switch</span>(opt) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'h'</span>:</div><div class="line">                h = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'v'</span>:</div><div class="line">                v = <span class="number">1</span>;</div><div class="line">                verbose_flag = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'s'</span>:</div><div class="line">                set_number = atoi(optarg);</div><div class="line">                <span class="keyword">if</span> (set_number == <span class="number">0</span>) &#123;</div><div class="line">                    csim_error_missing_argument();</div><div class="line">                    <span class="keyword">return</span> CSIM_ERROR_MISSING_ARGUMENT;</div><div class="line">                &#125;</div><div class="line">                s = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'E'</span>:</div><div class="line">                line_number = atoi(optarg);</div><div class="line">                <span class="keyword">if</span> (line_number == <span class="number">0</span>) &#123;</div><div class="line">                    csim_error_missing_argument();</div><div class="line">                    <span class="keyword">return</span> CSIM_ERROR_MISSING_ARGUMENT;</div><div class="line">                &#125;</div><div class="line">                E = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'b'</span>:</div><div class="line">                block_offset = atoi(optarg);</div><div class="line">                <span class="keyword">if</span> (block_offset == <span class="number">0</span>) &#123;</div><div class="line">                    csim_error_missing_argument();</div><div class="line">                    <span class="keyword">return</span> CSIM_ERROR_MISSING_ARGUMENT;</div><div class="line">                &#125;</div><div class="line">                b = <span class="number">1</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="string">'t'</span>:</div><div class="line">                t = <span class="number">1</span>;</div><div class="line">                <span class="built_in">strcpy</span>(file_path, optarg);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                csim_print_help_info();</div><div class="line">                <span class="keyword">return</span> CSIM_ERROR_INVALID_OPTION;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (h == <span class="number">1</span>) &#123;</div><div class="line">        csim_print_help_info();</div><div class="line">        <span class="keyword">return</span> CSIM_OK;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (v == <span class="number">1</span>) &#123;</div><div class="line">        verbose_flag = <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (!(s == <span class="number">1</span> &amp;&amp; E == <span class="number">1</span> &amp;&amp; b == <span class="number">1</span> &amp;&amp; t == <span class="number">1</span>)) &#123;</div><div class="line">        csim_error_missing_argument();</div><div class="line">        <span class="keyword">return</span> CSIM_ERROR_MISSING_ARGUMENT;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/* file processing */</span></div><div class="line">    FILE * file_pointer = fopen(file_path, <span class="string">"r"</span>);</div><div class="line">    <span class="keyword">if</span> (file_pointer == <span class="literal">NULL</span>) &#123;</div><div class="line">        csim_error_file_cannot_open(file_path);</div><div class="line">        <span class="keyword">return</span> CSIM_ERROR_FILE_CANNOT_OPEN;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/* cache construction */</span></div><div class="line">    cache = csim_construct_cache(set_number, line_number, block_offset);</div><div class="line">    <span class="comment">/* trace file parsing */</span></div><div class="line">    summary = csim_parse_trace_file(cache, file_pointer, verbose_flag);</div><div class="line">    <span class="comment">/* summary */</span></div><div class="line">    printSummary(summary.hit, summary.miss, summary.evict);</div><div class="line">    <span class="comment">/* post operations */</span></div><div class="line">    csim_deconstruct_cache(&amp;cache);</div><div class="line">    fclose(file_pointer);</div><div class="line">    <span class="keyword">return</span> CSIM_OK;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="实验结果"><a href="#实验结果" class="headerlink" title="实验结果"></a>实验结果</h2><p>自动评分脚本给出的输出如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">user@blackdragon ~/C/C/cachelab-handout&gt; ./<span class="built_in">test</span>-csim</div><div class="line">                        Your simulator     Reference simulator</div><div class="line">Points (s,E,b)    Hits  Misses  Evicts    Hits  Misses  Evicts</div><div class="line">     3 (1,1,1)       9       8       6       9       8       6  traces/yi2.trace</div><div class="line">     3 (4,2,4)       4       5       2       4       5       2  traces/yi.trace</div><div class="line">     3 (2,1,4)       2       3       1       2       3       1  traces/dave.trace</div><div class="line">     3 (2,1,3)     167      71      67     167      71      67  traces/trans.trace</div><div class="line">     3 (2,2,3)     201      37      29     201      37      29  traces/trans.trace</div><div class="line">     3 (2,4,3)     212      26      10     212      26      10  traces/trans.trace</div><div class="line">     3 (5,1,5)     231       7       0     231       7       0  traces/trans.trace</div><div class="line">     6 (5,1,5)  265189   21775   21743  265189   21775   21743  traces/long.trace</div><div class="line">    27</div><div class="line"></div><div class="line">TEST_CSIM_RESULTS=27</div></pre></td></tr></table></figure></p>
<h2 id="实验总结"><a href="#实验总结" class="headerlink" title="实验总结"></a>实验总结</h2><p>由于在寒假的课程设计中已经使用过了命令行参数解析以及复杂的数据结构设计与实验，Part A总体上来说不是很难，我主要的精力花费在代码风格上，希望代码能尽量具有良好的架构以及可读性。</p>
<p>本部分中犯的错误有，直接根据s设置缓存的组数，而实际上的组数是2^s个。循环中由于手误导致出现死循环。没有搞清楚inline static关键字而导致的编译错误等等。存在知识的盲区也存在着粗心导致的错误，以后还需要更加注意。</p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/实验/">实验</a> <a class="tag tag--primary tag--small t-link" href="/tags/计算机系统/">计算机系统</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/07/20/深入理解计算机系统PerformanceLab实验报告/" data-tooltip="深入理解计算机系统PerformanceLab实验报告" aria-label="上一篇: 深入理解计算机系统PerformanceLab实验报告">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/07/06/Arch下Hexo配置的问题总结/" data-tooltip="Arch下Hexo配置的问题总结" aria-label="下一篇: Arch下Hexo配置的问题总结">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/" title="分享到 Facebook">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/" title="分享到 Twitter">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/" title="分享到 Google+">
                    <i class="fa fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2017 CoSidian. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/07/20/深入理解计算机系统PerformanceLab实验报告/" data-tooltip="深入理解计算机系统PerformanceLab实验报告" aria-label="上一篇: 深入理解计算机系统PerformanceLab实验报告">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2017/07/06/Arch下Hexo配置的问题总结/" data-tooltip="Arch下Hexo配置的问题总结" aria-label="下一篇: Arch下Hexo配置的问题总结">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Diesen Beitrag teilen">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/" title="分享到 Facebook">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/" title="分享到 Twitter">
                    <i class="fa fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/" title="分享到 Google+">
                    <i class="fa fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Nach oben">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-close"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/">
                    <i class="fa fa-facebook-official" aria-hidden="true"></i><span>分享到 Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/">
                    <i class="fa fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://blog.codedragon.tech/2017/07/08/深入理解计算机系统CacheLab-PartA实验报告/">
                    <i class="fa fa-google-plus" aria-hidden="true"></i><span>分享到 Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">CoSidian</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    



    </body>
</html>
