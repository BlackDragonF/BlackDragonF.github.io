
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="码龙的窝">
    <title>标签: 实验 - 码龙的窝</title>
    <meta name="author" content="CoSidian">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="/* 0与1之风吹遍山谷 */">
<meta property="og:type" content="blog">
<meta property="og:title" content="码龙的窝">
<meta property="og:url" content="http://blog.codedragon.tech/tags/实验/page/2/index.html">
<meta property="og:site_name" content="码龙的窝">
<meta property="og:description" content="/* 0与1之风吹遍山谷 */">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="码龙的窝">
<meta name="twitter:description" content="/* 0与1之风吹遍山谷 */">
    
    
        
    
    
        <meta property="og:image" content="http://blog.codedragon.tech/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-gtvt1lbvzeqmr99zec4y42qrxw5ogq1gul5orw7somyh6cv5ckqsrl4abr9a.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-108458894-1', 'auto');
        ga('send', 'pageview');
    </script>


    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">码龙的窝</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">CoSidian</h4>
                
                    <h5 class="sidebar-profile-bio"><p>码龙黑曜 - iOS开发者/计算机科学/兽人控</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="首页"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="分类"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="标签"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="归档"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about"
                            
                            title="关于"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/BlackDragonF" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://t.me/Cosidian" target="_blank" rel="noopener" title="Telegram">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-paper-plane" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Telegram</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://steamcommunity.com/id/BlackDragonF/" target="_blank" rel="noopener" title="Steam">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-steam" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Steam</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:obsidiandragon2016@gmail.com" target="_blank" rel="noopener" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/friendly-links"
                            
                            title="友情链接"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-link" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">友情链接</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/book-recommend"
                            
                            title="图书推荐"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-book" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">图书推荐</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/04/04/深入理解计算机系统DataLab实验报告/">
                            深入理解计算机系统DataLab实验报告
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-04-04T16:50:20+08:00">
	
		    4月 04, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/计算机系统/">计算机系统</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>实验答案托管在我的<a href="https://github.com/BlackDragonF/CSAPPLabs/tree/master/DataLab" target="_blank" rel="external">GitHub</a>上</p>
<blockquote>
<p>总共花了五天时间完成了《深入理解计算机系统》(Computer Science A Programmer’s Perspective)的第一个Lab - Data Lab，深感这次实验的效率低下。一方面是由于清明假期自己有所惰怠，另一方面也是由于在做题的时候采取了不正确的方法，在已经明知不会的情况下我还继续投入大量无意义的时间，没有取得很好的学习效果。</p>
</blockquote>
<h2 id="实验简介"><a href="#实验简介" class="headerlink" title="实验简介"></a>实验简介</h2><p>Data Lab - Manipulating Bits主要是关于位操作的实验，对应于书本的第2章：信息的表示和处理。</p>
<p>在该实验中，学生主要需要在一个严格限制的C子集（使用优先的位运算符以及顺序结构的代码）中实现简单的逻辑，补码以及浮点数相关的函数。本实验的目的是为了让学生熟悉整数和浮点数的位级表示。</p>
<p>本实验的核心在于在各种受限制的条件下完成给出的15个谜题。其中包括5个位操作的谜题，7个补码运算的谜题，以及3个浮点数操作的谜题。其中每完成一个谜题都能得到一定的分数，如果使用的运算符数目小于给定的数目，还能获得加分。本实验的满分是71分。可以通过讲义中的driver.pl脚本直接计算出总分数。</p>
<p>关于本实验具体的介绍详见<a href="http://csapp.cs.cmu.edu/3e/datalab-handout.tar" target="_blank" rel="external">实验讲义</a>。</p>
<h2 id="测试程序btest-make失败及解决办法"><a href="#测试程序btest-make失败及解决办法" class="headerlink" title="测试程序btest make失败及解决办法"></a>测试程序btest make失败及解决办法</h2><p>在完成实验的功能中需要用到<code>make &amp;&amp; ./btest</code>命令进行答案正确性的检查，结果系统返回了<code>fetal error: gnu/stubs-32.h:No such file or directory</code>。</p>
<p>经过检查发现是系统是Archlinux 64位，而Makefile中包含了-m32的编译参数导致的。</p>
<p>通过启用multilib仓库使得可以在64位的ArchLinux系统上编译和运行32位的程序，问题得以解决。</p>
<p>编辑/etc/pacman.conf，取消下面内容的注释：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[multilib]</div><div class="line">include = /etc/pacman.d/mirrorlist</div></pre></td></tr></table></figure>
<p>更新软件包列表并升级系统<code>pacman -Syu</code></p>
<p>然后安装gcc-multilib并重新执行<code>make &amp;&amp; ./btest</code>，问题解决。</p>
<h2 id="实验限制"><a href="#实验限制" class="headerlink" title="实验限制"></a>实验限制</h2><h3 id="整数代码规则"><a href="#整数代码规则" class="headerlink" title="整数代码规则"></a>整数代码规则</h3><p>整数代码应遵循如下的基本结构：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">Funct</span><span class="params">(arg1, arg2, ...)</span> </span>&#123;</div><div class="line">    <span class="comment">/* brief description of how your implementation works */</span></div><div class="line">    <span class="keyword">int</span> var1 = Expr1;</div><div class="line">    ...</div><div class="line">    <span class="keyword">int</span> varM = ExprM;</div><div class="line">    varJ = ExprJ;</div><div class="line">    ...</div><div class="line">    varN = ExprN;</div><div class="line">    <span class="keyword">return</span> ExprR;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>每一个表达式只能使用：</p>
<ol>
<li>0～255之间的常量（包括0和255）</li>
<li>函数的参数和局部变量</li>
<li>单目运算符 ! ~</li>
<li>双目运算符 &amp; ^ | + &lt;&lt; &gt;&gt;</li>
</ol>
<p>注意，部分题目对于运算符有着更加严格的限制，但是你可以在一行代码中使用多个运算符。</p>
<p>你将会被禁止：</p>
<ol>
<li>使用任何的分支或者循环结构</li>
<li>定义或者使用任何的宏</li>
<li>在文件中定义任何额外函数</li>
<li>调用任何函数</li>
<li>使用任何其他的运算符</li>
<li>使用任何形式的类型转换</li>
<li>使用除了int以外的其他数据类型，这意味着你不能使用数组，结构或联合</li>
</ol>
<p>你可以假设你的机器：</p>
<ol>
<li>使用32位补码表示整数</li>
<li>使用算术右移</li>
<li>对整数进行的位移运算的位数超越了字长是未定义的行为</li>
</ol>
<h3 id="浮点代码规则"><a href="#浮点代码规则" class="headerlink" title="浮点代码规则"></a>浮点代码规则</h3><p>浮点运算的规则相对较为宽松，你可以使用循环或者是分支结构，你被允许同时使用int和unsigned，此外，你还可以使用任意的常量。</p>
<p>你将会被禁止：</p>
<ol>
<li>定义或者使用任何的宏</li>
<li>在文件中定义任何额外函数</li>
<li>调用任何函数</li>
<li>使用任何形式的类型转换</li>
<li>使用除了int和unsigned以外的任何数据类型，这意味着你不能使用数组，结构或者联合</li>
<li>使用任何浮点数的数据类型，操作或者是常量</li>
</ol>
<h2 id="实验答案及分析"><a href="#实验答案及分析" class="headerlink" title="实验答案及分析"></a>实验答案及分析</h2><h3 id="第一部分-位操作"><a href="#第一部分-位操作" class="headerlink" title="第一部分 位操作"></a>第一部分 位操作</h3><ul>
<li><p>bitAnd<br>  问题：要求使用~和|以及不超过8个操作符实现x&amp;y<br>  分析：使用De Morgan定律即可<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">bitAnd</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line"><span class="comment">/* x&amp;y = ~(~(x&amp;y)) = ~(~x|~y) */</span></div><div class="line">	<span class="keyword">return</span> ~(~x | ~y);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>getByte<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过6个操作符返回x中的第n个字节(0(LSB)&lt;=n&lt;=3(MSB))。<br>  分析：根据不同的n值将x右移不同的位数，然后使用掩码0xFF取得最低位数的字节即可。先左移再右移会导致算术右移，需要小心。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getByte</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line"><span class="comment">/* right shift in order to avoid boring arithmatic shift and try to get specific byte using bitAnd and mask. */</span></div><div class="line">    <span class="keyword">return</span> ((x &gt;&gt; (n &lt;&lt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span>);		</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>logicalShift<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过20个操作符实现将int值x的逻辑右移n位。<br>  分析：通过将一个全1的数通过算术右移的方式构造掩码，然后与算术右移的掩码求按位与即可。<br>  注意，直接右移32位的结果是未定义的，需要额外处理这种情况。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">logicalShift</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line"><span class="comment">/* try to implement logical right shift by mask and logical right shift */</span></div><div class="line">    <span class="keyword">int</span> mask = ((~<span class="number">0</span>) &lt;&lt; (<span class="number">31</span> + (~n + <span class="number">1</span>))) &lt;&lt; <span class="number">1</span>;</div><div class="line">    <span class="keyword">return</span> (x &gt;&gt; n) &amp; (~mask);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>bitCount<br>   问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过40个操作符计算一个数字x中有多少为1的位。<br>   分析：<br>   本题参考<a href="http://stackoverflow.com/questions/3815165/how-to-implement-bitcount-using-only-bitwise-operators" target="_blank" rel="external">stackoverflow</a>上的回答，并结合题目要求做了一些改动。<br>   核心的思想是分治法，通过将原数字x中的位按每1,2,4…个位分组，按相邻组进行累加，最后求出结果。<br>   举例来说，假如现在有一个数395，它的二进制表示是0000000110001011(16位)，首先我们将这个数按1位分组，得到：<br>   0 0 0 0 0 0 0 1 1 0 0 0 1 0 1 1<br>   然后我们将相邻的组累加，得到：<br>   0+0 0+0 0+0 0+1 1+0 0+0 1+0 1+1<br>   00 00 00 01 01 00 01 10<br>   然后我们继续将相邻的组累加，得到：<br>   00+00 00+01 01+00 01+10<br>   0000 0001 0001 0011<br>   然后我们继续将相邻的组累加，得到：<br>   0000+0001 0001+0011<br>   00000001 00000100<br>   最后，我们最后的两个组累加，得到：<br>   00000001+0000100=00000101<br>   结果是5，为正确答案。<br>   答案：</p>
   <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">int</span> <span class="title">bitCount</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line"><span class="comment">/* Divide and Conquer */</span></div><div class="line">    <span class="keyword">int</span> mask = <span class="number">0x55</span> + (<span class="number">0x55</span> &lt;&lt; <span class="number">8</span>) + (<span class="number">0x55</span> &lt;&lt; <span class="number">16</span>) + (<span class="number">0x55</span> &lt;&lt; <span class="number">24</span>);</div><div class="line">    x = (x &amp; mask) + ((x &gt;&gt; <span class="number">1</span>) &amp; mask);</div><div class="line">    mask = <span class="number">0x33</span> + (<span class="number">0x33</span> &lt;&lt; <span class="number">8</span>) + (<span class="number">0x33</span> &lt;&lt; <span class="number">16</span>) + (<span class="number">0x33</span> &lt;&lt; <span class="number">24</span>);</div><div class="line">    x = (x &amp; mask) + ((x &gt;&gt; <span class="number">2</span>) &amp; mask);</div><div class="line">    mask = <span class="number">0xF</span> + (<span class="number">0xF</span> &lt;&lt; <span class="number">8</span>) + (<span class="number">0xF</span> &lt;&lt; <span class="number">16</span>) + (<span class="number">0xF</span> &lt;&lt; <span class="number">24</span>);</div><div class="line">    x = (x &amp; mask) + ((x &gt;&gt; <span class="number">4</span>) &amp; mask);</div><div class="line">    <span class="keyword">return</span> (x + (x &gt;&gt; <span class="number">8</span>) + (x &gt;&gt; <span class="number">16</span>) + (x &gt;&gt; <span class="number">24</span>)) &amp; <span class="number">0xFF</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>bang<br>  问题：要求使用~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过12个操作数计算x的逻辑非。<br>  分析：<br>  逻辑非要求将0变成1，将非0的数变成0。生成0或1可以通过与掩码0x1求按位与实现，重点在于如何构造一个表达式使得0和非0的数产生不同的结果。<br>  可以考虑对于任意一个非0的数，它的负数都是从最高位到其最低位的1为止(不包括最低位的1)全部取反的结果。<br>  例如，14是00001110(8位)，而-14是11110010(8位)，为14从最高位到最低位的1(不包括这个1)，也就是000011取反，而最低位的10不变的结果。<br>  而0的负数永远是0。<br>  从这里我们可以看出，对于一个非0的数，它与它的负数按位或的结果的最高位一定会是1，而0与非0的按位或的结果的最高位永远是0。我们可以以此实现逻辑非。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">bang</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line"><span class="comment">/* for x != 0, the highest bit of x | (-x) will always become 1 while when x == 0, the result is the opposite */</span></div><div class="line">	<span class="keyword">return</span> (~((x | (~x + <span class="number">1</span>)) &gt;&gt; <span class="number">31</span>) &amp; <span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="第二部分-补码运算"><a href="#第二部分-补码运算" class="headerlink" title="第二部分 补码运算"></a>第二部分 补码运算</h3><ul>
<li><p>tmin<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过4个运算符返回以补码表示的最小的整数。<br>  分析：根据补码到整数的公式，最小的整数的补码表示为10000…<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">tmin</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</div><div class="line">    <span class="comment">/* TMin = 10000.... */</span></div><div class="line">    <span class="keyword">return</span> (<span class="number">1</span> &lt;&lt; <span class="number">31</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>fitsBits<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过15个操作符判断x是否能表示成n位的补码，如果是，则返回1，反之则返回0。<br>  分析：<br>  这个问题需要分正数和负数两种情况讨论，对于正数来说，如果一个数x能表示成n位的补码，那么它从最高位直到第n位一定全部为0，它的第n位一定不能为1，否则它就会变成一个负数。对于一个负数来说，如果一个数x能表示成n位的补码，那么它只需从最高位到第n位全部为1即可。<br>  因此，我们可以先将x右移n-1位，对于满足条件的正数和负数，这将产生一个全0的数或是一个全1的数。然后我们可以根据x的符号构造一个全0或者是全1的掩码。通过将这两个数按位异或并且取逻辑非，就能得到正确的结果。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">fitsBits</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line"><span class="comment">/* if fitsBits then from highest bit to n bit will all become 1 - negative number or 0 - positive number</span></div><div class="line"> * then can construct a mask to implement fitsBits with the help of ^ and !</div><div class="line"> */</div><div class="line">    <span class="keyword">return</span> !((x &gt;&gt; (n + (~<span class="number">1</span>) + <span class="number">1</span>)) ^ (((<span class="number">1</span> &lt;&lt; <span class="number">31</span>) &amp; x) &gt;&gt; <span class="number">31</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>divpwr2<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过15个操作符求出x/(2^n)的结果，其中0&lt;=n&lt;=30。<br>  分析：对于正数，直接使用算术右移即可；对于负数，需要加上适当的偏移量以实现向上舍入，这可以用根据符号位生成1个全0或者全1的掩码来控制。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">divpwr2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line"><span class="comment">/* add bias when x is negative, which is controlled by a sign-related mask */</span></div><div class="line">	<span class="keyword">int</span> mask = x &gt;&gt; <span class="number">31</span>;</div><div class="line">	<span class="keyword">int</span> add = ((<span class="number">1</span> &lt;&lt; n) + (~<span class="number">1</span>) + <span class="number">1</span>) &amp; mask;</div><div class="line">	<span class="keyword">return</span> (x + add) &gt;&gt; n;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>negate<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过5个操作符求出x的负数。<br>  分析：-x = (~x + 1)<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">negate</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line"><span class="comment">/* -x = (~x) + 1 */</span></div><div class="line">	<span class="keyword">return</span> ~x + <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>isPositive<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过8个操作符判断x是否为正数。<br>  分析：对于正数，它的最高位一定是0，同时还要排除0的影响。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">isPositive</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line"><span class="comment">/* ensure the highest bit is 0 and x != 0 */</span></div><div class="line">	<span class="keyword">return</span> (!(x &gt;&gt; <span class="number">31</span>)) ^ (!(x ^ <span class="number">0</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>isLessOrEqual<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过24个操作符判断x是否小于或等于y。<br>  分析：<br>  对于这个问题，我们需要按照是否溢出，以及x与y的符号分别讨论。<br>  最基本的思路是，做y-x，若结果的符号位为1，则返回0，反之返回1。但这样就忽略了溢出可能导致的问题，现在我们做如下考虑。<br>  若x，y均为正数，或x，y均为负数，则y-x绝不可能溢出，因此可直接用差的符号位判断大小。<br>  若x为正数，y为负数，可以直接返回0。<br>  若x为负数，y为正数，可以直接返回1。<br>  我们可以生成两种条件变量，一种为x，y同号时返回正确结果的条件变量，另一种为x，y异号时返回正确结果的条件变量。<br>  对于x，y同号和异号这两种不同的情况，我们可以用!((x ^ y) &gt;&gt; 31)生成掩码使得在任意的情况下，只有正确的条件变量生效。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">isLessOrEqual</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</div><div class="line"><span class="comment">/* different processing ways when x and y have the same signs or different signs */</span></div><div class="line">	<span class="keyword">int</span> diff = y + (~x) + <span class="number">1</span>;</div><div class="line">	<span class="keyword">int</span> not_diff_sign = !(diff &gt;&gt; <span class="number">31</span>);</div><div class="line">	<span class="keyword">int</span> mask = !((x ^ y) &gt;&gt; <span class="number">31</span>);</div><div class="line">	<span class="keyword">int</span> result_not_overflow = mask &amp; not_diff_sign;</div><div class="line">	<span class="keyword">int</span> result_overflow = (!mask) &amp; (x &gt;&gt; <span class="number">31</span>);</div><div class="line">	<span class="keyword">return</span> result_overflow | result_not_overflow;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>ilog2<br>  问题：要求使用! ~ &amp; ^ | + &lt;&lt; &gt;&gt;以及不超过90个操作数求出x以2为底的对数（向下舍入），保证x&gt;0。<br>  分析：<br>  这道题参考了网上的答案。核心的思想是二分查找。<br>  首先将x右移16位，如果x&gt;0，则表明结果的第5位为1，将该位置为1。<br>  然后根据结果将x右移8位（第5位为0）或者将x右移24位（第5位为1），如果x&gt;0，则表明结果的第4位为1，将该位置为1。<br>  以此类推，直到得出结果。<br>  答案：  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ilog2</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line">	<span class="comment">/* Binary Search */</span></div><div class="line">	<span class="keyword">int</span> result = (!!(x &gt;&gt; <span class="number">16</span>) &lt;&lt; <span class="number">4</span>);</div><div class="line">	result = result + ((!!(x &gt;&gt; (result + <span class="number">8</span>))) &lt;&lt; <span class="number">3</span>);</div><div class="line">	result = result + ((!!(x &gt;&gt; (result + <span class="number">4</span>))) &lt;&lt; <span class="number">2</span>);</div><div class="line">	result = result + ((!!(x &gt;&gt; (result + <span class="number">2</span>))) &lt;&lt; <span class="number">1</span>);</div><div class="line">	result = result + (!!(x &gt;&gt; (result + <span class="number">1</span>)));</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="第三部分-浮点数操作"><a href="#第三部分-浮点数操作" class="headerlink" title="第三部分 浮点数操作"></a>第三部分 浮点数操作</h3><ul>
<li><p>float_neg<br>  问题：返回对于浮点数参数f，-f的等价的位级表示。当参数位NAN时，返回NAN。函数的参数和返回值均为unsigned，但它们实际上都是浮点数的位表示。最多允许使用10个操作符。<br>  分析：首先要判断参数是否是NAN，如果是则直接返回，否的话直接将参数的最高位取反即可。<br>  NAN的阶码全为1，尾码不全为0。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">float_neg</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</div><div class="line"><span class="comment">/* m_flag - if m != 0 e_flag - if e == 0xff */</span></div><div class="line">	<span class="keyword">unsigned</span> m_flag = <span class="number">0x007fffff</span> &amp; uf;</div><div class="line">	<span class="keyword">unsigned</span> e_flag = !(<span class="number">0x7f800000</span> &amp; (~uf));</div><div class="line">	<span class="keyword">if</span> (e_flag &amp;&amp; m_flag) &#123;</div><div class="line">		<span class="keyword">return</span> uf;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0x80000000</span> ^ uf;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>float_i2f<br>  问题：返回(float)x的位级的等价表示。结果被作为unsigned int返回，但它实际上是单精度浮点数的位表示。最多允许使用30个操作符。<br>  分析：<br>  首先考虑到整数中只有0会被转换为非规格化浮点数，而其他整数会被转化为规格化浮点数。因此对于0需要做额外的处理。<br>  其次，对于负数，我们需要将其转化为正数再做处理，这就要求我们需要将x的符号保存下来，并且从补码转化为无符号表示。<br>  然后，我们需要根据转换成无符号数的x算出阶码e和尾码m。<br>  最后，我们将尾码舍入后再和阶码符号一起，生成最终的结果即可。<br>  这里我有一个比较大的误区，舍入的时候看的不仅仅是带舍入位的下一位，而是待舍入位之后的所有位。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">float_i2f</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</div><div class="line"><span class="comment">/* 1.process 0 individually 2.process negative number and store the sign 3.get the e number 4.get the m number and round it 5.construct the result */</span></div><div class="line">	<span class="keyword">unsigned</span> count = <span class="number">0</span>;</div><div class="line">	<span class="keyword">unsigned</span> mask = <span class="number">0x80000000</span>;</div><div class="line">	<span class="keyword">unsigned</span> sign = x &amp; mask;</div><div class="line">	<span class="keyword">unsigned</span> c = <span class="number">0</span>, absx = x;</div><div class="line">	<span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		<span class="keyword">if</span> (x &lt; <span class="number">0</span>) &#123;</div><div class="line">			absx = -x;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">while</span> (!(mask &amp; absx)) &#123;</div><div class="line">			count = count + <span class="number">1</span>;</div><div class="line">			mask = mask &gt;&gt; <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		absx = absx &lt;&lt; (count + <span class="number">1</span>);</div><div class="line">		<span class="keyword">if</span> (((absx &amp; <span class="number">0x1ff</span>) &gt; <span class="number">0x100</span>) || ((absx &amp; <span class="number">0x3ff</span>) &gt;= <span class="number">0x300</span>)) &#123;</div><div class="line">			c = <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> sign + ((<span class="number">158</span> - count) &lt;&lt; <span class="number">23</span>) + (absx &gt;&gt; <span class="number">9</span>)+ c;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>float_twice<br>  问题：返回对于浮点数参数f，2*f的等价的位级表示。参数和结果都为unsigned int，但它们实际上是浮点数的位表示。当参数是NAN时，返回NAN。最多允许使用30个操作符。<br>  分析：<br>  对于非规格化浮点数，只要在保留符号位的情况下将尾码m右移一位即可，这样同时解决了尾码乘以二和进位的情况。<br>  对于规格化浮点数，只要将其阶码e加1即可。<br>  答案：</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">unsigned</span> <span class="title">float_twice</span><span class="params">(<span class="keyword">unsigned</span> uf)</span> </span>&#123;</div><div class="line"><span class="comment">/* denormailized number - m = m &lt;&lt; 1 normalized number - e = e + 1 */</span></div><div class="line">	<span class="keyword">unsigned</span> result = uf;</div><div class="line">	<span class="keyword">if</span> ((uf &amp; <span class="number">0x7f800000</span>) == <span class="number">0</span>) &#123;</div><div class="line">		result = ((uf &amp; <span class="number">0x007fffff</span>) &lt;&lt; <span class="number">1</span>) | (uf &amp; <span class="number">0x80000000</span>);</div><div class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((uf &amp; <span class="number">0x7f800000</span>) != <span class="number">0x7f800000</span>) &#123;</div><div class="line">		result = uf + <span class="number">0x00800000</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/04/04/深入理解计算机系统DataLab实验报告/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/03/09/王爽汇编语言第三版实验/">
                            王爽汇编语言第三版实验
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-03-09T11:42:37+08:00">
	
		    3月 09, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/汇编/">汇编</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <blockquote>
<p>开学三周，王爽的《汇编语言》（第三版）总算是基本上看完了，本文是总结的第二部分，包括了书本上的实验</p>
</blockquote>
<h2 id="实验1-查看CPU和内存，用机器指令和汇编指令编程"><a href="#实验1-查看CPU和内存，用机器指令和汇编指令编程" class="headerlink" title="实验1 查看CPU和内存，用机器指令和汇编指令编程"></a>实验1 查看CPU和内存，用机器指令和汇编指令编程</h2><ol>
<li><p>使用Debug，将下面的程序段写入内存，逐条执行，观察每条指令执行后，CPU中相关寄存器的变化。<br><table><thead><tr><th style="text-align: center">机器码</th><th style="text-align: center">汇编指令</th><th style="text-align: center">执行后相关寄存器变化</th></tr></thead><tbody><tr><td style="text-align: center">b8 20 4e</td><td style="text-align: center">mov ax, 4E20H</td><td style="text-align: center">AX=4E20H</td></tr><tr><td style="text-align: center">05 16 14</td><td style="text-align: center">add ax, 1416H</td><td style="text-align: center">AX=6236H</td></tr><tr><td style="text-align: center">bb 00 20</td><td style="text-align: center">mov bx, 2000H</td><td style="text-align: center">BX=2000H</td></tr><tr><td style="text-align: center">01 d8</td><td style="text-align: center">add ax, bx</td><td style="text-align: center">AX=8236H</td></tr><tr><td style="text-align: center">89 c3</td><td style="text-align: center">mov bx, ax</td><td style="text-align: center">BX=8236H</td></tr><tr><td style="text-align: center">01 d8</td><td style="text-align: center">add ax, bx</td><td style="text-align: center">AX=046CH</td></tr><tr><td style="text-align: center">b8 1a 00</td><td style="text-align: center">mov ax, 001AH</td><td style="text-align: center">AX=001AH</td></tr><tr><td style="text-align: center">bb 26 00</td><td style="text-align: center">mov bx, 0026H</td><td style="text-align: center">BX=0026H</td></tr><tr><td style="text-align: center">00 d8</td><td style="text-align: center">add al, bl</td><td style="text-align: center">AX=0040H</td></tr><tr><td style="text-align: center">00 dc</td><td style="text-align: center">add ah, bl</td><td style="text-align: center">AX=2640H</td></tr><tr><td style="text-align: center">00 c7</td><td style="text-align: center">add bh, al</td><td style="text-align: center">BX=4026H</td></tr><tr><td style="text-align: center">b4 00</td><td style="text-align: center">mov ah, 0</td><td style="text-align: center">AX=0040H</td></tr><tr><td style="text-align: center">00 d8</td><td style="text-align: center">add al, bl</td><td style="text-align: center">AX=0066H</td></tr><tr><td style="text-align: center">04 9c</td><td style="text-align: center">add al, 9CH</td><td style="text-align: center">AX=0002H</td></tr></tbody></table><br>提示，可用E命令和A命令以两种方式将指令写入内存。注意用T命令执行时，CS:IP的指向。</p>
</li>
<li><p>将下面3条指令写入从2000:0开始的内存单元中，利用这3条指令计算2的8次方。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">1</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">ax</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">jmp</span> <span class="number">2000</span>:<span class="number">0003</span></div></pre></td></tr></table></figure>
<p>每次执行 add ax, ax 相当于将ax乘2，重复执行该条指令8次即可。</p>
</li>
<li><p>查看内存中的内容。<br>PC机主板上的ROM写有一个生产日期，在内存FFF00H～FFFFFH的某几个单元中，请找到这个生产日期并试图改变它。<br>提示，如果读者对实验的结果感到疑惑，请仔细阅读第1章中的1.15节。</p>
</li>
</ol>
<p>通过Debug中的D命令，可以观察到生产日期以MM/DD/YY的格式存储在内存的ffff:0005-ffff:000c共计8个字节处。<br>该生产日期不可被修改，因为其只读。</p>
<ol>
<li>向内存从B8100H开始的单元中填写数据，如：<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-e B810:<span class="number">0000</span> <span class="number">01</span> <span class="number">01</span> <span class="number">02</span> <span class="number">02</span> <span class="number">03</span> <span class="number">03</span> <span class="number">04</span> <span class="number">04</span></div></pre></td></tr></table></figure>
请读者先填写不同的数据，观察产生的现象；再改变填写的地址，观察产生的现象。<br>提示，如果读者对实验的结果感到疑惑，请仔细阅读第1章中的1.15节。</li>
</ol>
<p>通过向内存中的显存地址空间写入数据，控制在屏幕上的不同位置显示不同颜色的字符。</p>
<h2 id="实验2-用机器指令和汇编指令编程"><a href="#实验2-用机器指令和汇编指令编程" class="headerlink" title="实验2 用机器指令和汇编指令编程"></a>实验2 用机器指令和汇编指令编程</h2><ol>
<li><p>使用Debug，将下面的程序段写入内存，逐条执行，根据指令执行后的实验运行情况填空。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, ffff</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">2200</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">1000</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>,[<span class="number">0</span>]  <span class="comment">;ax = _____</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">ax</span>,[<span class="number">2</span>]  <span class="comment">;ax = _____</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>,[<span class="number">4</span>]  <span class="comment">;bx = _____</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>,[<span class="number">6</span>]  <span class="comment">;bx = _____</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span>     <span class="comment">;sp = _____ 修改的内存单元的地址是_____内容为_____</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">bx</span>     <span class="comment">;sp = _____ 修改的内存单元的地址是_____内容为_____</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span>      <span class="comment">;sp = _____ ax = _____</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span>      <span class="comment">;sp = _____ bx = _____</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> [<span class="number">4</span>]    <span class="comment">;sp = _____ 修改的内存单元的地址是_____内容为_____</span></div><div class="line"><span class="keyword">push</span> [<span class="number">6</span>]    <span class="comment">;sp = _____ 修改的内存单元的地址是_____内容为_____</span></div></pre></td></tr></table></figure>
<p>结果（不唯一）:</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">D4EA</div><div class="line">25EE</div><div class="line"><span class="number">3002</span></div><div class="line">5F37</div><div class="line">00FE 220FE 25EE</div><div class="line">00FC 220FC 5F37</div><div class="line">00FE 5F37</div><div class="line"><span class="number">0100</span> 25EE</div><div class="line">00FE 220FE <span class="number">3002</span></div><div class="line">00FC 220FC 2F35</div></pre></td></tr></table></figure>
</li>
<li><p>仔细观察图3.19中的实验过程，然后分析：为什么2000:0～2000:f中的内容会发生改变？<br>在使用T命令进行单步追踪的时候，产生了中断，为了保护现场，CPU将PSW、CS和IP依此入栈，导致了内存相关位置内容的改变。</p>
</li>
</ol>
<h2 id="实验3-编程、编译、连接、跟踪"><a href="#实验3-编程、编译、连接、跟踪" class="headerlink" title="实验3 编程、编译、连接、跟踪"></a>实验3 编程、编译、连接、跟踪</h2><ol>
<li><p>将下面的程序保存为t1.asm文件，将其生成可执行文件t1.exe。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:codesg</div><div class="line"></div><div class="line">codesg <span class="meta">segment</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">2000H</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">0</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">sp</span>, <span class="number">10</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">codesg ends</div><div class="line"></div><div class="line">end</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">edit t1.asm</div><div class="line">masm.exe t1.asm;</div><div class="line">link.exe t1.obj;</div></pre></td></tr></table></figure>
</li>
<li><p>用Debug跟踪t1.exe的执行过程，写出每一步执行后，相关寄存器中的内容和栈顶的内容。<br><table><thead><tr><th style="text-align: center">汇编指令</th><th style="text-align: center">相关寄存器的内容</th><th style="text-align: center">栈顶的内容</th></tr></thead><tbody><tr><td style="text-align: center">mov ax, 2000H</td><td style="text-align: center">AX = 2000H</td><td style="text-align: center">00B8H</td></tr><tr><td style="text-align: center">mov ss, ax</td><td style="text-align: center">SS = 2000H</td><td style="text-align: center">&#95;&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">mov sp, 0</td><td style="text-align: center">SP = 0</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">add sp, 10</td><td style="text-align: center">SP = 10</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">pop ax</td><td style="text-align: center">AX = 0 SP = 12</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">pop bx</td><td style="text-align: center">BX = 0 SP = 14</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">push ax</td><td style="text-align: center">SP = 12</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">push bx</td><td style="text-align: center">SP = 10</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">pop ax</td><td style="text-align: center">AX = 0 SP = 12</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">pop bx</td><td style="text-align: center">BX = 0 SP = 14</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">mov ax, 4c00h</td><td style="text-align: center">AX = 4C00H</td><td style="text-align: center">0000H</td></tr><tr><td style="text-align: center">int 21h</td><td style="text-align: center">&#95;&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;&#95;</td></tr></tbody></table><br>结果不唯一</p>
</li>
<li><p>PSP的头两个字节是CD 20，用Debug加载t1.exe，查看PSP的内容。</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-d <span class="number">2119</span>:<span class="number">0</span></div></pre></td></tr></table></figure>
<p>2119为CS-0010H</p>
</li>
</ol>
<h2 id="实验4-bx-和loop的使用"><a href="#实验4-bx-和loop的使用" class="headerlink" title="实验4 [bx]和loop的使用"></a>实验4 [bx]和loop的使用</h2><ol>
<li><p>编程，向内存0:200～0:23F依此传送数据0～63（3FH）。</p>
</li>
<li><p>编程，向内存0:200～0:23F依此传送数据0～63（3FH），程序中只能使用9条指令，9条指令中包括“mov ax, 4c00h”和“int 21h”。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0020h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">64</span></div><div class="line"><span class="symbol"></span></div><div class="line">s:      <span class="keyword">mov</span> [<span class="built_in">bx</span>], <span class="built_in">bl</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">bl</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">code ends</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>下面的程序的功能是将“mov ax, 4c00h”之前的指令复制到内存的0:200处，补全程序，上机调试，跟踪运行结果。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, _____</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0020h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, _____</div><div class="line"><span class="symbol">s:</span>      <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">bx</span>]</div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">code ends</div><div class="line">end</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">code</div><div class="line"><span class="number">18H</span></div></pre></td></tr></table></figure>
<p>提示：<br>复制的是什么？从哪里到哪里？<br>复制的是代码段中mov ax, 4c00h之前的代码，以数据的形式，从内存中代码段的位置复制到内存中0:200处开始的一段连续的空间。<br>复制的是什么？有多少个字节？你如何直到要复制的字节的数量？<br>可以用offset计算得出，也可以在Debug中用T命令观察得出。</p>
</li>
</ol>
<h2 id="实验5-编写、调试具有多个段的程序"><a href="#实验5-编写、调试具有多个段的程序" class="headerlink" title="实验5 编写、调试具有多个段的程序"></a>实验5 编写、调试具有多个段的程序</h2><ol>
<li><p>将下面的程序编译连接，用Debug加载、跟踪，然后回答问题。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ds</span>:data, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0123h</span>, <span class="number">0456h</span>, <span class="number">0789h</span>, <span class="number">0abch</span>, <span class="number">0defh</span>, <span class="number">0fedh</span>, <span class="number">0cbah</span>, <span class="number">0987h</span></div><div class="line">data ends</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line">stack ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span>:[<span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span>:[<span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
<p>①CPU执行程序，程序返回前，data段中的数据为多少？<br>②CPU执行程序，程序返回前，CS = _____、SS = _____、DS = _____。<br>③设程序加载后，code段的段地址为X，则data段的段地址为_____，stack段的段地址为_____。<br>答案：<br>①data段中的数据不变。<br>②212B、212A、2129（答案不唯一）<br>③X-2、X-1</p>
</li>
<li><p>将下面的程序编译连接，用Debug加载、跟踪，然后回答问题。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ds</span>:data, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0123h</span>, <span class="number">0456h</span></div><div class="line">data ends</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0</span>, <span class="number">0</span></div><div class="line">stack ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span>:[<span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span>:[<span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
<p>(1)CPU执行程序，程序返回前，data段中的数据为多少？<br>(2)CPU执行程序，程序返回前，CS = _____、SS = _____、DS = _____。<br>(3)设程序加载后，code段的段地址为X，则data段的段地址为_____，stack段的段地址为_____。<br>(4)对于如下定义的段：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">name <span class="meta">segment</span></div><div class="line">...</div><div class="line"><span class="meta">segment</span> ends</div></pre></td></tr></table></figure>
<p>如果段中的数据占N个字节，则程序加载后，该段实际占有的空间为_____。<br>答案：<br>(1)data段中的数据不变。<br>(2)212B、212A、2129（答案不唯一）<br>(3)X-2、X-1<br>(4)((N-1)/16 + 1)*16 其中除法为整除</p>
</li>
<li><p>将下面的程序编译连接，用Debug加载、跟踪，然后回答问题。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ds</span>:data, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span>:[<span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span>:[<span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span>:[<span class="number">0</span>]</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">code ends</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0123h</span>, <span class="number">0456h</span></div><div class="line">data ends</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0</span>, <span class="number">0</span></div><div class="line">stack ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
<p>(1)CPU执行程序，程序返回前，data段中的数据为多少？<br>(2)CPU执行程序，程序返回前，CS = _____、SS = _____、DS = _____。<br>(3)设程序加载后，code段的段地址为X，则data段的段地址为_____，stack段的段地址为_____。<br>答案：<br>(1)data段中的数据不变。<br>(2)2129、212D、212C（答案不唯一）<br>(3)X+3、X+4</p>
</li>
<li><p>如果将1. 2. 3.题中的最后一条伪指令“end start”改为“end”（也就是说，不指明程序的入口），则哪个程序仍然可以正确执行？请说明原因。<br>答案：<br>只有程序3可以正确运行，在不指明程序入口的情况下，程序默认按照顺序从头开始执行，而3个程序中只有程序3的code段位于最开始的部分，所以只有程序3可以正确运行。</p>
</li>
<li><p>程序如下，编写code段中的代码，将a段和b段中的数据依此相加，将结果存到c段中。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line">a <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span></div><div class="line">a ends</div><div class="line"></div><div class="line">b <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span></div><div class="line">b ends</div><div class="line"></div><div class="line">c <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line">c ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span></div><div class="line">?</div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
<p>答案：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, a</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, b</div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, c</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">8</span></div><div class="line"><span class="symbol">s:</span>      <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">bx</span>]</div><div class="line"><span class="keyword">add</span> <span class="built_in">al</span>, <span class="built_in">es</span>:[<span class="built_in">bx</span>]</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>:[<span class="built_in">bx</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div></pre></td></tr></table></figure>
</li>
<li><p>程序如下，编写code段中的代码，用push指令将a段中的前8个字型数据，逆序存储到b段中。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">a <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0ah</span>, <span class="number">0bh</span>, <span class="number">0ch</span>, <span class="number">0dh</span>, <span class="number">0eh</span>, <span class="number">0fh</span>, <span class="number">0ffh</span></div><div class="line">a ends</div><div class="line"></div><div class="line">b <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line">b ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  </div><div class="line">?</div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
<p>答案：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, b</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, a</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">8</span></div><div class="line"><span class="symbol">s:</span>      <span class="keyword">push</span> [<span class="built_in">bx</span>]</div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="实验6-实践课程中的程序"><a href="#实验6-实践课程中的程序" class="headerlink" title="实验6 实践课程中的程序"></a>实验6 实践课程中的程序</h2><ol>
<li><p>将课程中所有讲解过的程序上机调试，用Debug跟踪其执行过程，并在过程中进一步理解所讲内容。</p>
</li>
<li><p>编程，完成问题7.9中的程序。<br>程序如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:codesg, <span class="built_in">ss</span>:stacksg, <span class="built_in">ds</span>:datasg</div><div class="line">stacksg <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></div><div class="line">stacksg ends</div><div class="line"></div><div class="line">datasg <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="string">'1. display      '</span></div><div class="line"><span class="built_in">db</span> <span class="string">'2. brows        '</span></div><div class="line"><span class="built_in">db</span> <span class="string">'3. replace      '</span></div><div class="line"><span class="built_in">db</span> <span class="string">'4. modify       '</span></div><div class="line">datasg ends</div><div class="line"></div><div class="line">codesg <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, datasg</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, stacksg</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">4</span></div><div class="line"><span class="symbol">s:</span>      <span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">4</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="symbol">s0:</span>     <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">bx</span> + <span class="built_in">si</span> + <span class="number">3</span>]</div><div class="line"><span class="keyword">and</span> <span class="built_in">al</span>, <span class="number">11011111b</span></div><div class="line"><span class="keyword">mov</span> [<span class="built_in">bx</span> + <span class="built_in">si</span> + <span class="number">3</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">loop</span> s0</div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">16</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">codesg ends</div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="实验7-寻址方式在结构化数据访问中的应用"><a href="#实验7-寻址方式在结构化数据访问中的应用" class="headerlink" title="实验7 寻址方式在结构化数据访问中的应用"></a>实验7 寻址方式在结构化数据访问中的应用</h2><p>编程，将data段中的数据按如下格式写入到table段中，并计算21年中的人均收入（取整），结果也按照下面的格式保存在table段中。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:codesg, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">8</span> dup (<span class="number">0</span>)</div><div class="line">stack ends</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="string">'1975'</span>, <span class="string">'1976'</span>, <span class="string">'1977'</span>, <span class="string">'1978'</span>, <span class="string">'1979'</span>, <span class="string">'1980'</span>, <span class="string">'1981'</span>, <span class="string">'1982'</span>, <span class="string">'1983'</span></div><div class="line"><span class="built_in">db</span> <span class="string">'1984'</span>, <span class="string">'1985'</span>, <span class="string">'1986'</span>, <span class="string">'1987'</span>, <span class="string">'1988'</span>, <span class="string">'1989'</span>, <span class="string">'1990'</span>, <span class="string">'1991'</span>, <span class="string">'1992'</span></div><div class="line"><span class="built_in">db</span> <span class="string">'1993'</span>, <span class="string">'1994'</span>, <span class="string">'1995'</span></div><div class="line"></div><div class="line"><span class="built_in">dd</span> <span class="number">16</span>, <span class="number">22</span>, <span class="number">382</span>, <span class="number">1356</span>, <span class="number">2390</span>, <span class="number">8000</span>, <span class="number">16000</span>, <span class="number">24486</span>, <span class="number">50065</span>, <span class="number">97479</span>, <span class="number">140417</span>, <span class="number">197514</span></div><div class="line"><span class="built_in">dd</span> <span class="number">345980</span>, <span class="number">590827</span>, <span class="number">803530</span>, <span class="number">1183000</span>, <span class="number">1843000</span>, <span class="number">2759000</span>, <span class="number">3753000</span>, <span class="number">4649000</span>, <span class="number">5937000</span></div><div class="line"></div><div class="line"><span class="built_in">dw</span> <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">28</span>, <span class="number">38</span>, <span class="number">130</span>, <span class="number">220</span>, <span class="number">476</span>, <span class="number">778</span>, <span class="number">1001</span>, <span class="number">1442</span>, <span class="number">2258</span>, <span class="number">2793</span>, <span class="number">4037</span>, <span class="number">5635</span>, <span class="number">8226</span></div><div class="line"><span class="built_in">dw</span> <span class="number">11542</span>, <span class="number">14430</span>, <span class="number">15257</span>, <span class="number">17800</span></div><div class="line">data ends</div><div class="line"></div><div class="line">table <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="number">21</span> dup (<span class="string">'year summ ne ?? '</span>)</div><div class="line">table ends</div><div class="line"></div><div class="line">codesg <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, table</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">21</span></div><div class="line"><span class="symbol">year:</span>   <span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">4</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">0</span></div><div class="line"><span class="symbol">char:</span>   <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">es</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> [<span class="built_in">bx</span>+<span class="built_in">di</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">loop</span> char</div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">16</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">loop</span> year</div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">21</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="symbol">income:</span> <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">es</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> [<span class="number">5</span>+<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">si</span>, <span class="number">2</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">es</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> [<span class="number">7</span>+<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">si</span>, <span class="number">2</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">16</span></div><div class="line"><span class="keyword">loop</span> income</div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">21</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="symbol">staff:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">es</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> [<span class="number">10</span>+<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">si</span>, <span class="number">2</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">16</span></div><div class="line"><span class="keyword">loop</span> staff</div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">21</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="symbol">average:</span><span class="keyword">mov</span> <span class="built_in">ax</span>, [<span class="built_in">bx</span>+<span class="number">5</span>]</div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, [<span class="built_in">bx</span>+<span class="number">7</span>]</div><div class="line"><span class="keyword">div</span> <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">bx</span>+<span class="number">10</span>]</div><div class="line"><span class="keyword">mov</span> [<span class="number">13</span>+<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">16</span></div><div class="line"><span class="keyword">loop</span> average</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">codesg ends</div><div class="line">end start</div></pre></td></tr></table></figure></p>
<h2 id="实验8-分析一个奇怪的程序"><a href="#实验8-分析一个奇怪的程序" class="headerlink" title="实验8 分析一个奇怪的程序"></a>实验8 分析一个奇怪的程序</h2><p>分析下面的程序，在运行前思考，这个程序可以正确返回吗？<br>运行后再思考：为什么是这种结果？<br>通过这个程序加深对相关内容的理解。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:codesg</div><div class="line">codesg <span class="meta">segment</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol">start:</span> <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="symbol">s:</span>     <span class="keyword">nop</span></div><div class="line"><span class="keyword">nop</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, offset s</div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset s2</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> <span class="built_in">cs</span>:[<span class="built_in">di</span>], <span class="built_in">ax</span></div><div class="line"><span class="symbol">s0:</span>    <span class="keyword">jmp</span> short s</div><div class="line"><span class="symbol">s1:</span>    <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="symbol">s2:</span>    <span class="keyword">jmp</span> short s1</div><div class="line"><span class="keyword">nop</span></div><div class="line">codesg ends</div><div class="line">end start</div></pre></td></tr></table></figure><br>分析：<br>这个程序可以正确返回，程序的入口为mov ax, 0，注意到指令jmp short s1占2字节，于是指令mov di, offset s将s的偏移地址传送到寄存器DI，mov si, offset s2将s2的偏移地址传送到SI，然后再通过通用寄存器ax做中转将s2处的指令复制到s处，最后再跳转至s处执行复制过来的指令。<br>注意jmp short s1是相对跳转，其直接修改IP寄存器，从s2到s1共有8个字节的偏移，实际上 jmp short s1等价于(ip)=(ip)-8，通过Debug可知第一个nop指令的偏移地址为8，所以再执行了复制过的指令后，IP将指向0，程序按照顺序执行mov ax, 4c00h和int 21h，正确返回。</p>
<h2 id="实验9-根据材料编程"><a href="#实验9-根据材料编程" class="headerlink" title="实验9 根据材料编程"></a>实验9 根据材料编程</h2><p>编程：在屏幕中间分别显示绿色、绿底红色、白底蓝色的字符串’welcome to masm!’。<br>编程所需的只是通过阅读、分析下面的材料获得。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">ds</span>:data, <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="string">'welcome to masm!'</span></div><div class="line">data ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0B800H</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">1664</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">16</span></div><div class="line"><span class="symbol">char1:</span>  <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">10000010B</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">loop</span> char1</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">1824</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">16</span></div><div class="line"><span class="symbol">char2:</span>  <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">10100100B</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">loop</span> char2</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">1984</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">16</span></div><div class="line"><span class="symbol">char3:</span>  <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">11110001B</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">loop</span> char3</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4C00H</span></div><div class="line"><span class="keyword">int</span> <span class="number">21H</span></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure></p>
<h2 id="实验10-编写子程序"><a href="#实验10-编写子程序" class="headerlink" title="实验10 编写子程序"></a>实验10 编写子程序</h2><ol>
<li><p>显示字符串</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">16</span> dup (<span class="number">0</span>)</div><div class="line">stack ends</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="string">'Welcome to masm!'</span>, <span class="number">0</span></div><div class="line">data ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="number">dh</span>, <span class="number">8</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dl</span>, <span class="number">3</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="number">2</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">32</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">call</span> show_str</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">show_str:</div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"><span class="comment">;using cx, bx, ax, si, di, es</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">160</span></div><div class="line"><span class="keyword">mul</span> <span class="number">dh</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">2</span></div><div class="line"><span class="keyword">mul</span> <span class="built_in">dl</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="built_in">ax</span> <span class="comment">;bx stores address of start character</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">cl</span> <span class="comment">;al stores the color of character</span></div><div class="line"><span class="symbol">char:</span>   <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="built_in">ds</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">jcxz</span> <span class="meta">zero</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ch</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>+<span class="built_in">di</span>], <span class="built_in">cx</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">di</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">jmp</span> char</div><div class="line"><span class="symbol">zero:</span>   <span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
<li><p>解决除法溢出的问题</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">16</span> dup (<span class="number">0</span>)</div><div class="line">stack ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">32</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4240h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">000fh</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">0ah</span></div><div class="line"><span class="keyword">call</span> divdw</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">divdw:  <span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="built_in">ax</span> <span class="comment">; bx stores L</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">dx</span> <span class="comment">; ax stores H</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">div</span> <span class="built_in">cx</span> <span class="comment">; after div, ax holds int(H/N), dx holds rem(H/N)</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span> <span class="comment">; push int(H/N) temporarily</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">bx</span> <span class="comment">; ax stores L</span></div><div class="line"><span class="keyword">div</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="built_in">dx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></div><div class="line"></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
<li><p>数值显示</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ss</span>:stack</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">16</span> dup (<span class="number">0</span>)</div><div class="line">stack ends</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="number">10</span> dup (<span class="number">0</span>)</div><div class="line">data ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">32</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">12666</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">call</span> dtoc</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="number">dh</span>, <span class="number">8</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dl</span>, <span class="number">3</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="number">2</span></div><div class="line"><span class="keyword">call</span> show_str</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">dtoc:   <span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">dx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">10</span></div><div class="line"><span class="symbol"></span></div><div class="line">devide: <span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">jcxz</span> stop</div><div class="line"><span class="keyword">div</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">dx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">jmp</span> devide</div><div class="line"><span class="symbol">stop:</span>   <span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="built_in">di</span></div><div class="line"><span class="symbol">string:</span> <span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">30h</span></div><div class="line"><span class="keyword">mov</span> [<span class="built_in">si</span>], <span class="built_in">bl</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">loop</span> string</div><div class="line"></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol"></span></div><div class="line">show_str:</div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"><span class="comment">;using cx, bx, ax, si, di, es</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">160</span></div><div class="line"><span class="keyword">mul</span> <span class="number">dh</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">2</span></div><div class="line"><span class="keyword">mul</span> <span class="built_in">dl</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="built_in">ax</span> <span class="comment">;bx stores address of start character</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">cl</span> <span class="comment">;al stores the color of character</span></div><div class="line"><span class="symbol">char:</span>   <span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="built_in">ds</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">jcxz</span> <span class="meta">zero</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ch</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>+<span class="built_in">di</span>], <span class="built_in">cx</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">di</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">jmp</span> char</div><div class="line"><span class="symbol">zero:</span>   <span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="实验11-编写子程序"><a href="#实验11-编写子程序" class="headerlink" title="实验11 编写子程序"></a>实验11 编写子程序</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">dw</span> <span class="number">8</span> dup (<span class="number">0</span>)</div><div class="line">stack ends</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="string">"Beginner's All-purpose Symbolic Instruction Code."</span>, <span class="number">0</span></div><div class="line">data ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">begin:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">16</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">call</span> letterc</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">letterc:</div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pushf</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="built_in">ds</span>:[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">jcxz</span> <span class="meta">zero</span></div><div class="line"><span class="keyword">cmp</span> <span class="built_in">cl</span>, <span class="number">97</span></div><div class="line"><span class="keyword">jb</span> next</div><div class="line"><span class="keyword">cmp</span> <span class="built_in">cl</span>, <span class="number">122</span></div><div class="line"><span class="keyword">ja</span> next</div><div class="line"><span class="keyword">sub</span> <span class="built_in">cl</span>, <span class="number">20h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>:[<span class="built_in">si</span>], <span class="built_in">cl</span></div><div class="line"><span class="symbol">next:</span>   <span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">jmp</span> start</div><div class="line"><span class="symbol"></span></div><div class="line">zero:   <span class="keyword">popf</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end begin</div></pre></td></tr></table></figure>
<h2 id="实验12-编写0号中断的处理程序"><a href="#实验12-编写0号中断的处理程序" class="headerlink" title="实验12 编写0号中断的处理程序"></a>实验12 编写0号中断的处理程序</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset do0</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">200h</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, offset do0end - offset do0</div><div class="line"></div><div class="line"><span class="keyword">cld</span></div><div class="line"></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">0</span>], <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">2</span>], <span class="number">0</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">do0:</div><div class="line"><span class="keyword">jmp</span> short do0start</div><div class="line"><span class="built_in">db</span> <span class="string">"overflow!"</span></div><div class="line"><span class="symbol">do0start:</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">202h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">12</span>*<span class="number">160</span>+<span class="number">36</span>*<span class="number">2</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">9</span></div><div class="line"><span class="symbol">s:</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="built_in">si</span>]</div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">di</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol">do0end:</span></div><div class="line"><span class="keyword">nop</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
<h2 id="实验13-编写、应用中断例程"><a href="#实验13-编写、应用中断例程" class="headerlink" title="实验13 编写、应用中断例程"></a>实验13 编写、应用中断例程</h2><ol>
<li><p>编写并安装int 7ch中断例程，功能为显示一个用0结束的字符串，中断例程安装在0:200处。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset print</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, offset printend - offset print</div><div class="line"><span class="keyword">cld</span></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span>], <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span> + <span class="number">2</span>], <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">print:</div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">dx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">di</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">160</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mul</span> <span class="number">dh</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">dl</span>, <span class="built_in">dl</span></div><div class="line"><span class="keyword">mov</span> <span class="number">dh</span>, <span class="number">0</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">di</span>, <span class="built_in">dx</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">cl</span></div><div class="line"><span class="symbol">printstart:</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ch</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, [<span class="built_in">si</span>]</div><div class="line"><span class="keyword">jcxz</span> <span class="meta">zero</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ch</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>:[<span class="built_in">di</span>], <span class="built_in">cx</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">di</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">jmp</span> printstart</div><div class="line"><span class="symbol"></span></div><div class="line">zero:</div><div class="line"><span class="keyword">pop</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">iret</span></div><div class="line"><span class="symbol">printend:</span></div><div class="line"><span class="keyword">nop</span></div><div class="line"></div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
<li><p>编写并安装int 7ch中断例程，功能为完成loop指令功能。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset lp</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, offset lpend - offset lp</div><div class="line"><span class="keyword">cld</span></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span>], <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span> + <span class="number">2</span>], <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">lp:     <span class="keyword">push</span> <span class="built_in">bp</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bp</span>, <span class="built_in">sp</span></div><div class="line"><span class="keyword">dec</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">jcxz</span> lpret</div><div class="line"><span class="keyword">add</span> [<span class="built_in">bp</span> + <span class="number">2</span>], <span class="built_in">bx</span></div><div class="line"><span class="symbol">lpret:</span>  <span class="keyword">pop</span> <span class="built_in">bp</span></div><div class="line"><span class="keyword">iret</span></div><div class="line"><span class="symbol">lpend:</span>  <span class="keyword">nop</span></div><div class="line"></div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
<li><p>下面的程序，分别在屏幕的第2、4、6、8行显示4句英文诗，补全程序。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">s1:</span>     <span class="built_in">db</span> <span class="string">'Good,better,best,'</span>, <span class="string">'$'</span></div><div class="line"><span class="symbol">s2:</span>     <span class="built_in">db</span> <span class="string">'Never let it rest,'</span>, <span class="string">'$'</span></div><div class="line"><span class="symbol">s3:</span>     <span class="built_in">db</span> <span class="string">'Till good is better,'</span>, <span class="string">'$'</span></div><div class="line"><span class="symbol">s4:</span>     <span class="built_in">db</span> <span class="string">'And better,best.'</span>, <span class="string">'$'</span></div><div class="line"><span class="symbol">s:</span>      <span class="built_in">dw</span> offset s1, offset s2, offset s3, offset s4</div><div class="line"><span class="symbol">row:</span>    <span class="built_in">db</span> <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span></div><div class="line"><span class="symbol"></span></div><div class="line">start:  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, offset s</div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset row</div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">4</span></div><div class="line"><span class="symbol">ok:</span>     <span class="keyword">mov</span> <span class="number">bh</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="number">dh</span>, _____</div><div class="line"><span class="keyword">mov</span> <span class="built_in">dl</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">2</span></div><div class="line"><span class="keyword">int</span> <span class="number">10h</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, _____</div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">9</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">_________</div><div class="line">_________</div><div class="line"><span class="keyword">loop</span> ok</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
<p>答案：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">si</span>]</div><div class="line">[<span class="built_in">bx</span>]</div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">inc</span> <span class="built_in">si</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="实验14-访问CMOS-RAM"><a href="#实验14-访问CMOS-RAM" class="headerlink" title="实验14 访问CMOS RAM"></a>实验14 访问CMOS RAM</h2><p>编程，以”年/月/日 时:分:秒”的格式，显示当前的日期，时间。<br>注意：CMOS RAM中存储着系统的配置信息，出了保存时间信息的单元外，不要向其他的单元中写入内容，否则将引起一些系统错误。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code, <span class="built_in">ds</span>:data</div><div class="line"></div><div class="line">data <span class="meta">segment</span></div><div class="line">s <span class="built_in">db</span> <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span></div><div class="line">data ends</div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">160</span> * <span class="number">12</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">6</span></div><div class="line"><span class="symbol"></span></div><div class="line">print:  <span class="keyword">mov</span> <span class="built_in">al</span>, s[<span class="built_in">si</span>]</div><div class="line"><span class="keyword">out</span> <span class="number">70h</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">in</span> <span class="built_in">al</span>, <span class="number">71h</span></div><div class="line"><span class="keyword">call</span> number</div><div class="line"><span class="keyword">cmp</span> <span class="built_in">si</span>, <span class="number">2</span></div><div class="line"><span class="keyword">jb</span> slash</div><div class="line"><span class="keyword">je</span> space</div><div class="line"><span class="keyword">cmp</span> <span class="built_in">si</span>, <span class="number">5</span></div><div class="line"><span class="keyword">jb</span> colon</div><div class="line"><span class="symbol">next:</span>   <span class="keyword">inc</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">loop</span> print</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"></div><div class="line"><span class="comment">;al-&gt;number, es:di-&gt;begin</span></div><div class="line"><span class="symbol">number:</span> <span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="number">4</span></div><div class="line"><span class="keyword">shr</span> <span class="number">ah</span>, <span class="built_in">cl</span></div><div class="line"><span class="keyword">and</span> <span class="built_in">al</span>, <span class="number">00001111b</span></div><div class="line"><span class="keyword">add</span> <span class="number">ah</span>, <span class="number">30h</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">al</span>, <span class="number">30h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">di</span>], <span class="number">ah</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">di</span> + <span class="number">2</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">di</span>, <span class="number">4</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol"></span></div><div class="line">slash:  <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">di</span>], <span class="string">'\'</span></div><div class="line">add di, 2</div><div class="line">jmp next</div><div class="line"></div><div class="line">colon:  mov byte ptr es:[di], ':<span class="string">'</span></div><div class="line">add di, 2</div><div class="line">jmp next</div><div class="line"></div><div class="line">space:  mov byte ptr es:[di], ' <span class="string">'</span></div><div class="line">add di, 2</div><div class="line">jmp next</div><div class="line"></div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure></p>
<h2 id="实验15-安装新的int-9中断例程"><a href="#实验15-安装新的int-9中断例程" class="headerlink" title="实验15 安装新的int 9中断例程"></a>实验15 安装新的int 9中断例程</h2><p>安装一个新的int 9中断例程，功能：在DOS下，按下’A’键后，除非不再松开，如果松开，就显示满屏幕的’A’；其他键照常处理。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">stack <span class="meta">segment</span></div><div class="line"><span class="built_in">db</span> <span class="number">128</span> dup (<span class="number">0</span>)</div><div class="line">stack ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, stack</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">128</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> <span class="built_in">cs</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset int9</div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">204h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, offset int9end - offset int9</div><div class="line"><span class="keyword">cld</span></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span>: [<span class="number">9</span> * <span class="number">4</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span>: [<span class="number">200h</span>]</div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span>: [<span class="number">9</span> * <span class="number">4</span> + <span class="number">2</span>]</div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span>: [<span class="number">202h</span>]</div><div class="line"></div><div class="line"><span class="keyword">cli</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>: [<span class="number">9</span> * <span class="number">4</span>], <span class="number">204h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>: [<span class="number">9</span> * <span class="number">4</span> + <span class="number">2</span>], <span class="number">0</span></div><div class="line"><span class="keyword">sti</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">int9:   <span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"></div><div class="line"><span class="keyword">in</span> <span class="built_in">al</span>, <span class="number">60h</span></div><div class="line"></div><div class="line"><span class="keyword">pushf</span></div><div class="line"><span class="keyword">call</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">cs</span>:[<span class="number">200h</span>]</div><div class="line"></div><div class="line"><span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="number">9eh</span></div><div class="line"><span class="keyword">jne</span> int9ret</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">2000</span></div><div class="line"><span class="symbol">s:</span>      <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="string">'A'</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> s</div><div class="line"><span class="symbol"></span></div><div class="line">int9ret:<span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">iret</span></div><div class="line"><span class="symbol"></span></div><div class="line">int9end:<span class="keyword">nop</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure></p>
<h2 id="实验16-编写包含多个功能子程序的中断例程"><a href="#实验16-编写包含多个功能子程序的中断例程" class="headerlink" title="实验16 编写包含多个功能子程序的中断例程"></a>实验16 编写包含多个功能子程序的中断例程</h2><p>安装一个新的int  7ch中断例程，为显示输出提供如下功能子程序</p>
<ol>
<li>清屏</li>
<li>设置前景色</li>
<li>设置背景色</li>
<li>向上滚动一行</li>
</ol>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset screen</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, offset screenend - offset screen</div><div class="line"><span class="keyword">cld</span></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span>], <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span> + <span class="number">2</span>], <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">screen: <span class="keyword">jmp</span> short set</div><div class="line"><span class="comment">;考虑到安装中断例程后偏移地址发生了变化，需要重新计算相关的偏移地址</span></div><div class="line">table   <span class="built_in">dw</span> offset sub1 - offset screen + <span class="number">200h</span>, offset sub2 - offset screen + <span class="number">200h</span>, offset sub3 - offset screen + <span class="number">200h</span>, offset sub4 - offset screen + <span class="number">200h</span></div><div class="line"><span class="symbol"></span></div><div class="line">set:    <span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"></div><div class="line"><span class="keyword">cmp</span> <span class="number">ah</span>, <span class="number">3</span></div><div class="line"><span class="keyword">ja</span> sret</div><div class="line"><span class="keyword">mov</span> <span class="built_in">bl</span>, <span class="number">ah</span></div><div class="line"><span class="keyword">mov</span> <span class="number">bh</span>, <span class="number">0</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="built_in">bx</span></div><div class="line"></div><div class="line"><span class="comment">;同上</span></div><div class="line"><span class="keyword">call</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">cs</span>:(table - screen + <span class="number">200h</span>)[<span class="built_in">bx</span>]</div><div class="line"><span class="symbol"></span></div><div class="line">sret:   <span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">iret</span></div><div class="line"><span class="symbol"></span></div><div class="line">sub1:   <span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">bx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">2000</span></div><div class="line"><span class="symbol">sub1s:</span>  <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="string">' '</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> sub1s</div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol"></span></div><div class="line">sub2:   <span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">bx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">1</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">2000</span></div><div class="line"><span class="symbol">sub2s:</span>  <span class="keyword">and</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="number">11111000B</span></div><div class="line"><span class="keyword">or</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> sub2s</div><div class="line"></div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol"></span></div><div class="line">sub3:   <span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="number">4</span></div><div class="line"><span class="keyword">shl</span> <span class="built_in">al</span>, <span class="built_in">cl</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">bx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="number">1</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">2000</span></div><div class="line"><span class="symbol">sub3s:</span>  <span class="keyword">and</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="number">10001111B</span></div><div class="line"><span class="keyword">or</span> <span class="built_in">es</span>:[<span class="built_in">bx</span>], <span class="built_in">al</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> sub3s</div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">bx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol"></span></div><div class="line">sub4:   <span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ds</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0b800h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">si</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">si</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">160</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">0</span></div><div class="line"><span class="keyword">cld</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">24</span></div><div class="line"><span class="symbol">sub4s:</span>  <span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">160</span></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">loop</span> sub4s</div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">80</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, <span class="number">0</span></div><div class="line"><span class="symbol">sub4s1:</span> <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="number">160</span>*<span class="number">24</span>+<span class="built_in">si</span>], <span class="string">' '</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">si</span>, <span class="number">2</span></div><div class="line"><span class="keyword">loop</span> sub4s1</div><div class="line"></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ds</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">es</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">di</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">si</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">ret</span></div><div class="line"><span class="symbol"></span></div><div class="line">screenend:</div><div class="line"><span class="keyword">nop</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure>
<p>参考<a href="http://blog.csdn.net/lixiang0522/article/details/8434450" target="_blank" rel="external">王爽《汇编语言》实验16：包含多个功能子程序的中断例程 解答</a><br>可以用伪指令org x简化该程序<br>org x表明接下来的指令从偏移地址x开始<br>修改后的相关指令如下：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">org <span class="number">200h</span></div><div class="line"><span class="symbol">screen:</span> <span class="keyword">jmp</span> short set</div><div class="line"></div><div class="line">table   <span class="built_in">dw</span> sub1, sub2, sub3, sub4</div><div class="line"><span class="symbol"></span></div><div class="line">set:    <span class="keyword">push</span> <span class="built_in">bx</span></div><div class="line"></div><div class="line"><span class="keyword">cmp</span> <span class="number">ah</span>, <span class="number">3</span></div><div class="line"><span class="keyword">ja</span> sret</div><div class="line"><span class="keyword">mov</span> <span class="built_in">bl</span>, <span class="number">ah</span></div><div class="line"><span class="keyword">mov</span> <span class="number">bh</span>, <span class="number">0</span></div><div class="line"><span class="keyword">add</span> <span class="built_in">bx</span>, <span class="built_in">bx</span></div><div class="line"></div><div class="line"><span class="keyword">call</span> <span class="built_in">word</span> <span class="built_in">ptr</span> table[<span class="built_in">bx</span>]</div></pre></td></tr></table></figure></p>
<h2 id="实验17-编写包含多个功能子程序的中断例程"><a href="#实验17-编写包含多个功能子程序的中断例程" class="headerlink" title="实验17 编写包含多个功能子程序的中断例程"></a>实验17 编写包含多个功能子程序的中断例程</h2><p>安装一个新的int 7ch中断例程，实现通过逻辑扇区号对软盘进行读写。<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>  <span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">cs</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">si</span>, offset floppyio</div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">di</span>, <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, offset floppyioend - offset floppyio</div><div class="line"><span class="keyword">cld</span></div><div class="line"><span class="keyword">rep</span> <span class="keyword">movsb</span></div><div class="line"></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">es</span>, <span class="built_in">ax</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span>], <span class="number">200h</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">word</span> <span class="built_in">ptr</span> <span class="built_in">es</span>:[<span class="number">7ch</span> * <span class="number">4</span> + <span class="number">2</span>], <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line"><span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">floppyio:</div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">dx</span></div><div class="line"></div><div class="line"><span class="keyword">add</span> <span class="number">ah</span>, <span class="number">2</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">1</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span> <span class="comment">;计算相应的ah和al并压栈</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">dx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dx</span>, <span class="number">0</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cx</span>, <span class="number">1440</span></div><div class="line"><span class="keyword">div</span> <span class="built_in">cx</span> <span class="comment">;计算逻辑扇区号/1440</span></div><div class="line"><span class="keyword">push</span> <span class="built_in">ax</span> <span class="comment">;将商即面号压栈</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="built_in">dx</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dl</span>, <span class="number">18</span></div><div class="line"><span class="keyword">div</span> <span class="built_in">dl</span> <span class="comment">;计算逻辑扇区号/1440的余数/18</span></div><div class="line"><span class="keyword">inc</span> <span class="number">ah</span></div><div class="line"><span class="keyword">mov</span> <span class="number">ch</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">cl</span>, <span class="number">ah</span> <span class="comment">;设置相应的ch和cl</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span> <span class="comment">;将相应的面号出栈</span></div><div class="line"><span class="keyword">mov</span> <span class="number">dh</span>, <span class="built_in">al</span></div><div class="line"><span class="keyword">mov</span> <span class="built_in">dl</span>, <span class="number">0</span> <span class="comment">;设置相应的dh和dl</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span> <span class="comment">;将相应的ah和al出栈</span></div><div class="line"><span class="keyword">int</span> <span class="number">13h</span> <span class="comment">;调用13h例程进行实际的读写</span></div><div class="line"></div><div class="line"><span class="keyword">pop</span> <span class="built_in">dx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">cx</span></div><div class="line"><span class="keyword">pop</span> <span class="built_in">ax</span></div><div class="line"><span class="keyword">iret</span></div><div class="line"><span class="symbol">floppyioend:</span></div><div class="line"><span class="keyword">nop</span></div><div class="line"></div><div class="line">code ends</div><div class="line">end start</div></pre></td></tr></table></figure></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/03/09/王爽汇编语言第三版实验/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
          <li class="pagination-prev">
            <a class="btn btn--default btn--small" href="/tags/实验/">
              <i class="fa fa-angle-left text-base icon-mr"></i>
              <span>上一页</span>
            </a>
          </li>
        
        
        <li class="pagination-number">第 2 页 共 2 页</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 CoSidian. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
            <h4 id="about-card-name">CoSidian</h4>
        
            <div id="about-card-bio"><p>码龙黑曜 - iOS开发者/计算机科学/兽人控</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>本科在读</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                HUST, Wuhan, China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-i7zzex3jvqnxdf0lp2pg3bcyurjikigtrw9ljle5skc4mit2m7a13rwuyp8g.min.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
