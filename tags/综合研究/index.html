
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="码龙的窝">
    <title>标签: 综合研究 - 码龙的窝</title>
    <meta name="author" content="CoSidian">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="/* 0与1之风吹遍山谷 */">
<meta property="og:type" content="blog">
<meta property="og:title" content="码龙的窝">
<meta property="og:url" content="http://blog.codedragon.tech/tags/综合研究/index.html">
<meta property="og:site_name" content="码龙的窝">
<meta property="og:description" content="/* 0与1之风吹遍山谷 */">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="码龙的窝">
<meta name="twitter:description" content="/* 0与1之风吹遍山谷 */">
    
    
        
    
    
        <meta property="og:image" content="http://blog.codedragon.tech/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-gtvt1lbvzeqmr99zec4y42qrxw5ogq1gul5orw7somyh6cv5ckqsrl4abr9a.min.css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-108458894-1', 'auto');
        ga('send', 'pageview');
    </script>


    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">码龙的窝</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
                </a>
                <h4 class="sidebar-profile-name">CoSidian</h4>
                
                    <h5 class="sidebar-profile-bio"><p>码龙黑曜 - iOS开发者/计算机科学/兽人控</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="首页"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="分类"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="标签"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="归档"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/about"
                            
                            title="关于"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/BlackDragonF" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://t.me/Cosidian" target="_blank" rel="noopener" title="Telegram">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-paper-plane" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Telegram</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="http://steamcommunity.com/id/BlackDragonF/" target="_blank" rel="noopener" title="Steam">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-steam" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Steam</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:obsidiandragon2016@gmail.com" target="_blank" rel="noopener" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-lg fa-envelope-o" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/friendly-links"
                            
                            title="友情链接"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-link" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">友情链接</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/book-recommend"
                            
                            title="图书推荐"
                        >
                    
                        <i class="sidebar-button-icon fa fa-lg fa-book" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">图书推荐</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/03/10/王爽汇编语言第三版综合研究结论/">
                            王爽汇编语言第三版综合研究结论
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" datetime="2017-03-10T18:09:01+08:00">
	
		    3月 10, 2017
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/汇编/">汇编</a>


    
</div>

            </div>
            
                <div class="postShorten-content" itemprop="articleBody">
                    <blockquote>
<p>开学三周，王爽的《汇编语言》（第三版）总算是基本上看完了，本文是总结的第三部分也是最后一部分（大概），主要是书后的综合研究</p>
</blockquote>
<h2 id="研究试验1-搭建一个精简的C语言开发环境"><a href="#研究试验1-搭建一个精简的C语言开发环境" class="headerlink" title="研究试验1 搭建一个精简的C语言开发环境"></a>研究试验1 搭建一个精简的C语言开发环境</h2><p>TC进行连接需要如下的文件：</p>
<ul>
<li>C0S.OBJ</li>
<li>CS.LIB</li>
<li>EMU.LIB</li>
<li>GRAPHICS.LIB</li>
<li>MATHS.LIB</li>
</ul>
<h2 id="研究试验2-使用寄存器"><a href="#研究试验2-使用寄存器" class="headerlink" title="研究试验2 使用寄存器"></a>研究试验2 使用寄存器</h2><ol>
<li>编一个程序ur1.c <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">main ()</div><div class="line">&#123;</div><div class="line">	_AX = <span class="number">1</span>;</div><div class="line">	_BX = <span class="number">1</span>;</div><div class="line">	_CX = <span class="number">2</span>;</div><div class="line">	_AX = _BX + _CX;</div><div class="line">	_AH = _BL + _CL;</div><div class="line">	_AL = _BH + _CH;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li>
<li>用Debug加载ur1.exe，用u命令查看ur1.exe编译后的机器码和汇编代码。<br> 思考：main函数的代码在什么段中？用Debug怎样找到ur1.exe中main函数的代码？<br> 回答：main函数的代码在CS段中，需要知道main函数的偏移地址才能找到main函数的代码。</li>
<li>用下面的方法打印出ur1.exe被加载运行时，main函数在代码段中的偏移地址。 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">main ()</div><div class="line">&#123;</div><div class="line">	<span class="built_in">printf</span>(<span class="string">"%x\n"</span>, main);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
 思考：为什么这个程序能够打印出main函数在代码段中的偏移地址？<br> 回答：由学过的知识可知，C语言中用指针表示地址，这里的printf打印了main函数的入口地址，也即main函数在代码段中的偏移地址。</li>
<li><p>用Debug加载ur1.exe，根据上面打印出的main函数的偏移地址，用u命令察看main函数的汇编代码。仔细找到ur1.c中每条C语句对应的汇编代码。</p>
 <table><thead><tr><th style="text-align: center">地址</th><th style="text-align: center">汇编语句</th><th style="text-align: center">C语句</th></tr></thead><tbody><tr><td style="text-align: center">076A:01FA</td><td style="text-align: center">PUSH BP</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:01FB</td><td style="text-align: center">MOV BP,SP</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:01FD</td><td style="text-align: center">MOV AX,0001</td><td style="text-align: center">_AX = 1</td></tr><tr><td style="text-align: center">076A:0200</td><td style="text-align: center">MOV BX,0001</td><td style="text-align: center">_BX = 1</td></tr><tr><td style="text-align: center">076A:0203</td><td style="text-align: center">MOV CX,0002</td><td style="text-align: center">_CX = 2</td></tr><tr><td style="text-align: center">076A:0206</td><td style="text-align: center">MOV AX,BX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0208</td><td style="text-align: center">ADD AX,CX</td><td style="text-align: center">_AX = _BX + _CX</td></tr><tr><td style="text-align: center">076A:020A</td><td style="text-align: center">MOV AH,BL</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:020C</td><td style="text-align: center">ADD AH,CL</td><td style="text-align: center">_AH = _BL + _CL</td></tr><tr><td style="text-align: center">076A:020E</td><td style="text-align: center">MOV AL,BH</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0210</td><td style="text-align: center">ADD AL,CH</td><td style="text-align: center">_AL = _BH + _CH</td></tr><tr><td style="text-align: center">076A:0212</td><td style="text-align: center">POP BP</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0213</td><td style="text-align: center">RET</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr></tbody></table>

<p> 注意：在这里，对于main函数汇编代码开始处的“push bp mov bp,sp”和结尾处的“pop bp”，这里只了解到：这是C编译器安排的为函数中可能使用到bp寄存器而设置的，就可以了。</p>
</li>
<li><p>通过main函数后面有ret指令，我们可以设想：C语言将函数实现为汇编语言中的子程序。研究下面程序的汇编代码，验证我们的设想。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">void</span>)</span></span>;</div><div class="line"></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	_AX = <span class="number">1</span>; _BX = <span class="number">1</span>; _CX = <span class="number">2</span>;</div><div class="line"></div><div class="line">	f();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	_AX = _BX + _CX;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>编译、连接后用Debug查看汇编代码如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>,<span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>,<span class="number">0001</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0001</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">CX</span>,<span class="number">0002</span></div><div class="line"><span class="keyword">CALL</span> 020B</div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>,<span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">ADD</span> <span class="built_in">AX</span>,<span class="built_in">CX</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p>设想正确</p>
</li>
</ol>
<h2 id="研究试验3-使用内存空间"><a href="#研究试验3-使用内存空间" class="headerlink" title="研究试验3 使用内存空间"></a>研究试验3 使用内存空间</h2><ol>
<li><p>编一个程序um1.c：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">main()</div><div class="line">&#123;</div><div class="line">	*(<span class="keyword">char</span> *)<span class="number">0x2000</span>=<span class="string">'a'</span>;</div><div class="line">	*(<span class="keyword">int</span> *)<span class="number">0x2000</span>=<span class="number">0xf</span>;</div><div class="line">	*(<span class="keyword">char</span> far *)<span class="number">0x20001000</span>=<span class="string">'a'</span>;</div><div class="line"></div><div class="line">	_AX=<span class="number">0x2000</span>;</div><div class="line">	*(<span class="keyword">char</span> *)_AX=<span class="string">'b'</span>;</div><div class="line"></div><div class="line">	_BX=<span class="number">0x1000</span>;</div><div class="line">	*(<span class="keyword">char</span> *)(_BX+_BX)=<span class="string">'a'</span>;</div><div class="line">	*(<span class="keyword">char</span> far *)(<span class="number">0x20001000</span>+_BX)=*(<span class="keyword">char</span> *)_AX;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 把um1.c保存在C:\MINIC下，编译，连接生成um1.exe。然后用Debug加载um1.exe，对main函数的汇编代码进行分析，找到每条C语句对应的汇编代码；对main函数进行单步跟踪，察看相关内存单元的内容。</p>
 <table><thead><tr><th style="text-align: center">地址</th><th style="text-align: center">汇编语句</th><th style="text-align: center">C语句</th><th style="text-align: center">相关内存单元</th></tr></thead><tbody><tr><td style="text-align: center">076A:01FA</td><td style="text-align: center">PUSH BP</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:01FB</td><td style="text-align: center">MOV BP,SP</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:01FD</td><td style="text-align: center">MOV BYTE PTR [2000],61</td><td style="text-align: center">&#42;(char &#42;)0x2000=’a’</td><td style="text-align: center">07C4:2000 -&gt; 61</td></tr><tr><td style="text-align: center">076A:0202</td><td style="text-align: center">MOV WORD PTR [2000],000F</td><td style="text-align: center">&#42;(int &#42;)0x2000=0xf</td><td style="text-align: center">07C4:2000-07C4:2001 -&gt; 0F 00</td></tr><tr><td style="text-align: center">076A:0208</td><td style="text-align: center">MOV BX,2000</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:020B</td><td style="text-align: center">MOV ES,BX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:020D</td><td style="text-align: center">MOV BX,1000</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0210</td><td style="text-align: center">ES:</td><td style="text-align: center"></td><td style="text-align: center"></td></tr><tr><td style="text-align: center">076A:0211</td><td style="text-align: center">MOV BYTE PTR [BX],61</td><td style="text-align: center">&#42;(char far &#42;)0x20001000=’a’</td><td style="text-align: center">2000:1000 -&gt; 61</td></tr><tr><td style="text-align: center">076A:0214</td><td style="text-align: center">MOV AX,2000</td><td style="text-align: center">_AX=0x2000</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0217</td><td style="text-align: center">MOV BX,AX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0219</td><td style="text-align: center">MOV BYTE PTR [BX],62</td><td style="text-align: center">&#42;(char &#42;)_AX=’b’</td><td style="text-align: center">07C4:2000 -&gt; 62</td></tr><tr><td style="text-align: center">076A:021C</td><td style="text-align: center">MOV BX,1000</td><td style="text-align: center">_BX=0x1000</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:021F</td><td style="text-align: center">ADD BX,BX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0221</td><td style="text-align: center">MOV BYTE PTR [BX],61</td><td style="text-align: center">&#42;(char &#42;)(_BX + _BX)=’a’</td><td style="text-align: center">07C4:2000 -&gt; 61</td></tr><tr><td style="text-align: center">076A:0224</td><td style="text-align: center">MOV BX,AX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0226</td><td style="text-align: center">MOV AL,[BX]</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0228</td><td style="text-align: center">XOR CX,CX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:022A</td><td style="text-align: center">ADD BX,1000</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:022E</td><td style="text-align: center">ADC CX,2000</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0232</td><td style="text-align: center">MOV ES,CX</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0234</td><td style="text-align: center">ES:</td><td style="text-align: center"></td><td style="text-align: center"></td></tr><tr><td style="text-align: center">076A:0235</td><td style="text-align: center">MOV [BX],AL</td><td style="text-align: center">&amp;#142(char far &#42;)(0x20001000+<em>BX)=&#42;(char &#42;)</em>AX</td><td style="text-align: center">2000:3000 -&gt; 61</td></tr><tr><td style="text-align: center">076A:0237</td><td style="text-align: center">POP BP</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr><tr><td style="text-align: center">076A:0238</td><td style="text-align: center">RET</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td><td style="text-align: center">&#95;&#95;&#95;&#95;</td></tr></tbody></table>
</li>
<li><p>编一个程序，用一条C语句实现在屏幕的中间显示一个绿色的字符”a”。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">main()</div><div class="line">&#123;</div><div class="line">	*(<span class="keyword">int</span> far *)<span class="number">0xb80007d0</span>=<span class="number">0x261</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>分析下面程序中所有函数的汇编代码，思考相关的问题。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a1, a2, a3;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">void</span>)</span></span>;</div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> b1, b2, b3;</div><div class="line">	a1 = <span class="number">0xa1</span>; a2 = <span class="number">0xa2</span>; a3 = <span class="number">0xa3</span>;</div><div class="line">	b1 = <span class="number">0xb1</span>; b2 = <span class="number">0xb2</span>; b3 = <span class="number">0xb3</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> c1, c2, c3;</div><div class="line">	a1 = <span class="number">0x0fa1</span>; a2 = <span class="number">0x0fa2</span>; a3 = <span class="number">0x0fa3</span>;</div><div class="line">	c1 = <span class="number">0xc1</span>; c2 = <span class="number">0xc2</span>; c3 = <span class="number">0xc3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 问题：C语言将全局变量存放在哪里？将局部变量存放在哪里？每个函数开头的“push bp mov bp,sp”有何含义？<br> 程序中main函数的汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>, <span class="built_in">SP</span></div><div class="line"><span class="keyword">SUB</span> <span class="built_in">SP</span>, <span class="number">6</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [01A6], 00A1</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [01A8], 00A2</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [01AA], 00A3</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BP</span>-<span class="number">6</span>], 00B1</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BP</span>-<span class="number">4</span>], 00B2</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BP</span>-<span class="number">2</span>], 00B3</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SP</span>, <span class="built_in">BP</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p> 程序中f函数的汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>, <span class="built_in">SP</span></div><div class="line"><span class="keyword">SUB</span> <span class="built_in">SP</span>, <span class="number">6</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [01A6], 0FA1</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [01A8], 0FA2</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [01AA], 0FA3</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BP</span>-<span class="number">6</span>], 00C1</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BP</span>-<span class="number">4</span>], 00C2</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BP</span>-<span class="number">2</span>], 00C3</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SP</span>, <span class="built_in">BP</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p> 答案：<br> C语言将全局变量存放在内存中，将局部变量存放在栈中，每个函数开头的push bp以及mov bp,sp是为了保护与还原现场。</p>
</li>
<li><p>分析下面程序的汇编代码，思考相关的问题。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">void</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> a,b,ab;</div><div class="line"></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> c;</div><div class="line">	c = f();</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	ab=a+b;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> ab;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 问题：C语言将函数的返回值存放在哪里？<br> 程序中main函数的汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>, <span class="built_in">SP</span></div><div class="line"><span class="keyword">SUB</span> <span class="built_in">SP</span>, <span class="number">2</span></div><div class="line"><span class="keyword">CALL</span> 020A</div><div class="line"><span class="keyword">MOV</span> [<span class="built_in">BP</span>-<span class="number">2</span>], <span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SP</span>, <span class="built_in">BP</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p> 程序中f函数的汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>, <span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>, [01A6]</div><div class="line"><span class="keyword">ADD</span> <span class="built_in">AX</span>, [01A8]</div><div class="line"><span class="keyword">MOV</span> [01AA], <span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>, [01AA]</div><div class="line"><span class="keyword">JMP</span> 021C</div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p> 答案：<br> 在该情况下，C语言将返回值存放在通用寄存器AX中。</p>
</li>
<li><p>下面的程序向安全的内存空间写入从“a”到“h”8个字符，理解程序的含义，深入理解相关的知识。（注意：请自己学习、研究malloc函数的用法）</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Buffer ((char *) * (int far *)0x02000000)</span></div><div class="line"></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	Buffer = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">20</span>);</div><div class="line"></div><div class="line">	Buffer[<span class="number">10</span>] = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="keyword">while</span>(Buffer[<span class="number">10</span>]!=<span class="number">8</span>)</div><div class="line">	&#123;</div><div class="line">		Buffer[Buffer[<span class="number">10</span>]]=<span class="string">'a'</span>+Buffer[<span class="number">10</span>];</div><div class="line">		Buffer[<span class="number">10</span>]++;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 理解：<br> 程序通过malloc分配大小为20字节的空间给并将其地址存入Buffer所指向的空间即0200:0000中。随后，通过一个while循环将这20个字节的空间的0-7个字节分别赋予对应的字符，并且用第10个字节计数。</p>
</li>
</ol>
<h2 id="研究试验4-不用main函数编程"><a href="#研究试验4-不用main函数编程" class="headerlink" title="研究试验4 不用main函数编程"></a>研究试验4 不用main函数编程</h2><ol>
<li><p>把程序F.C保存在C:\MINIC下，对其进行编译，连接，思考相关的问题。<br> 问题：<br> ①编译和连接哪个环节会出问题？<br> ②显示出的错误信息是什么？<br> ③这个错误信息可能和哪个文件有关？<br> 答案：<br> ①连接环节出现了错误<br> ②在C0S模块中未定义的标号_main<br> ③和C0S.OBJ这个文件有关</p>
</li>
<li><p>用学习汇编语言时使用的LINK.EXE对TC.EXE生成的F.OBJ文件进行连接，生成F.EXE。用DEBUG加载F.EXE，察看整个程序的汇编代码。思考相关的问题。<br> 问题：<br> ①F.EXE的程序代码总共有多少字节？<br> ②F.EXE的程序能正确返回吗？<br> ③F函数的偏移地址是多少？<br> 答案：<br> ①F.EXE的程序代码总共有1DH个字节<br> ②F.EXE的程序不能正确的返回<br> ③F函数的偏移地址为0</p>
</li>
<li><p>写一个程序M.C。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">main ()</div><div class="line">&#123;</div><div class="line">	*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span>+<span class="number">160</span>*<span class="number">10</span>+<span class="number">80</span>)=<span class="string">'a'</span>;</div><div class="line">	*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span>+<span class="number">160</span>*<span class="number">10</span>+<span class="number">81</span>)=<span class="number">2</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 用TC.EXE对M.C进行编译，连接，生成M.EXE，用Debug察看M.EXE整个程序的汇编代码。思考相关的问题。<br> 问题：<br> (1)M.EXE的程序代码总共有多少字节？<br> (2)M.EXE的程序能正确返回吗？<br> (3)M.EXE程序中的main函数和F.EXE中的f函数的汇编代码有何不同？<br> 答案：<br> (1)M.EXE的程序代码总共有5F5H个字节<br> (2)M.EXE的程序能正确返回<br> (3)M.EXE程序中的main函数和F.EXE中的f函数的汇编代码没有不同</p>
</li>
<li><p>用Debug对m.exe进行跟踪：<br> (1)找到对main函数进行调用的指令的地址<br> (2)找到整个程序返回的指令<br> 注意：使用g命令和p命令。<br> 答案：<br> (1)对main函数进行调用的指令的地址为076A:011A CALL 01FA<br> (2)整个程序返回的指令为076A:0156 INT 21</p>
</li>
<li><p>思考如下几个问题：<br> (1)对main函数调用的指令和程序返回的指令是哪里来的？<br> (2)没有main函数时，出现的错误信息里有和“C0S”相关的信息；而前面在搭建开发环境时，没有C0S.OBJ文件TC.EXE就无法对程序进行连接。是不是TC.EXE把C0S.OBJ和用户程序的.OBJ一起进行连接生成.EXE文件？<br> (3)对用户程序的main函数进行调用的指令和程序返回的指令是否就来自C0S.OBJ文件？<br> (4)我们如何看到C0S.OBJ文件中的程序代码呢？<br> (5)C0S.OBJ文件里有我们设想的代码吗？<br> 回答：<br> (1)对main函数调用的指令和程序返回的指令是来自于其他的文件而非编译后的文件。<br> (2)是的<br> (3)是的<br> (4)用LINK.EXE对其进行连接即可<br> (5)有</p>
</li>
<li><p>用LINK.EXE对C:\MINIC目录下的C0S.OBJ进行连接，生成C0S.EXE。<br> 用Debug分别察看C0S.EXE和M.EXE的汇编代码。注意：从头开始察看，两个文件中的程序代码有和相同之处？<br> 两个程序的代码基本相同，且都是在011A调用了CALL指令，在0156调用了INT 21中断</p>
</li>
<li><p>用Debug找到M.EXE中调用main函数的CALL指令的偏移地址，从这个偏移地址开始向后察看10条指令；然后用Debug加载C0S.EXE，从相同的偏移地址开始向后察看10条指令，对两处的指令进行对比。<br> M.EXE和C0S.EXE在偏移地址011A之后的10条指令除了跳转指令的跳转地址有所不同外几乎完全相同。</p>
</li>
<li><p>下面，我们用汇编语言编一个程序C0S.ASM，然后把它编译为C0S.OBJ，替代C:\MINIC目录下的C0S.OBJ。<br> 程序C0S.ASM：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">assume</span> <span class="built_in">cs</span>:code</div><div class="line">data <span class="meta">segment</span></div><div class="line">	<span class="built_in">db</span> <span class="number">128</span> dup (<span class="number">0</span>)</div><div class="line">data ends</div><div class="line"></div><div class="line">code <span class="meta">segment</span></div><div class="line"><span class="symbol">start:</span>	<span class="keyword">mov</span> <span class="built_in">ax</span>, data</div><div class="line">		<span class="keyword">mov</span> <span class="built_in">ds</span>, <span class="built_in">ax</span></div><div class="line">		<span class="keyword">mov</span> <span class="built_in">ss</span>, <span class="built_in">ax</span></div><div class="line">		<span class="keyword">mov</span> <span class="built_in">sp</span>, <span class="number">108</span></div><div class="line"></div><div class="line">		<span class="keyword">call</span> s</div><div class="line"></div><div class="line">		<span class="keyword">mov</span> <span class="built_in">ax</span>, <span class="number">4c00h</span></div><div class="line">		<span class="keyword">int</span> <span class="number">21h</span></div><div class="line"><span class="symbol"></span></div><div class="line">s:		</div><div class="line"></div><div class="line">code ends</div><div class="line"></div><div class="line">end start</div></pre></td></tr></table></figure>
</li>
<li><p>在C:\MINIC目录下，用TC.EXE将F.C重新进行编译，连接，生成F.EXE。这次能通过连接吗？F.EXE可以正确运行吗？用Debug察看F.EXE的汇编代码。<br> 能通过连接，可以正确运行，汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>,076A</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">DS</span>,<span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SS</span>,<span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SP</span>,<span class="number">0080</span></div><div class="line"><span class="keyword">CALL</span> <span class="number">0012</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>,4C00</div><div class="line"><span class="keyword">INT</span> <span class="number">21</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>,<span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,B800</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0690</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">BX</span>],<span class="number">61</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,B800</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0691</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">BX</span>],<span class="number">02</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div><div class="line">...</div></pre></td></tr></table></figure>
</li>
<li><p>在新的C0S.OBJ的基础上，写一个新的F.C，向安全的内存空间写入从“a”到“h”的8个字符，分析、理解F.C。<br>程序F.C：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Buffer ((char *) * (int far *)0x02000000)</span></div><div class="line"></div><div class="line">f()</div><div class="line">&#123;</div><div class="line">	Buffer = <span class="number">0</span>;</div><div class="line"></div><div class="line">	Buffer[<span class="number">10</span>] = <span class="number">0</span>;</div><div class="line"></div><div class="line">	<span class="keyword">while</span>(Buffer[<span class="number">10</span>]!=<span class="number">8</span>)</div><div class="line">	&#123;</div><div class="line">		Buffer[Buffer[<span class="number">10</span>]]=<span class="string">'a'</span>+Buffer[<span class="number">10</span>];</div><div class="line">		Buffer[<span class="number">10</span>]++;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>汇编代码如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>,076A</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">DS</span>,<span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SS</span>,<span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">SP</span>,<span class="number">0080</span></div><div class="line"><span class="keyword">CALL</span> <span class="number">0012</span> <span class="comment">;调用f函数</span></div><div class="line"><span class="keyword">INT</span> <span class="number">21</span></div><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span> <span class="comment">;0012</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>,<span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">WORD</span> <span class="built_in">PTR</span> [<span class="built_in">BX</span>],<span class="number">0000</span> <span class="comment">;设置Buffer=0，即将0200:0000处的内存单元改为0</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,[<span class="built_in">BX</span>] <span class="comment">;将Buffer解引用，即将0200:0000处的内存字单元存入BX中</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">BX</span>+0A],<span class="number">00</span> <span class="comment">;设置Buffer[10]=0 即将DS:000A处的内存单元改为0</span></div><div class="line"><span class="keyword">JMP</span> <span class="number">006D</span> <span class="comment">;while 循环条件判断</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span> <span class="comment">;0031</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,[<span class="built_in">BX</span>] <span class="comment">;将Buffer解引用，即将0200:0000处的内存字单元存入BX中</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AL</span>,[<span class="built_in">BX</span>+0A] <span class="comment">;AL等于Buffer[10]，即将DS:000A内存字节单元的内容存入AL中</span></div><div class="line"><span class="keyword">ADD</span> <span class="built_in">AL</span>,<span class="number">61</span> <span class="comment">;为AL加上'a'</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,[<span class="built_in">BX</span>] <span class="comment">;将Buffer解引用，即将0200:0000处的内存字单元存入BX中</span></div><div class="line"><span class="keyword">PUSH</span> <span class="built_in">AX</span></div><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,[<span class="built_in">BX</span>] <span class="comment">;将Buffer解引用，即将0200:0000处的内存字单元存入BX中</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AL</span>,[<span class="built_in">BX</span>+0A] <span class="comment">;将Buffer[10]的值传入AL，即将DS:000A处的内存字节单元存入AL中</span></div><div class="line"><span class="keyword">CBW</span> <span class="comment">;将AL扩展至16位</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BX</span> <span class="comment">;取回BX</span></div><div class="line"><span class="keyword">ADD</span> <span class="built_in">BX</span>,<span class="built_in">AX</span> <span class="comment">;BX现在值为Buffer[10]</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">AX</span> <span class="comment">;取回AX</span></div><div class="line"><span class="keyword">MOV</span> [<span class="built_in">BX</span>],<span class="built_in">AL</span> <span class="comment">;将所要设置的数值'a'+Buffer[10]存入Buffer[Buffer[10]]中</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,[<span class="built_in">BX</span>] <span class="comment">;将Buffer解引用，即将0200:0000处的内存字单元存入BX中</span></div><div class="line"><span class="keyword">INC</span> <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">BX</span>+0A] <span class="comment">;将Buffer[10]自增</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0200</span> <span class="comment">;006D</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">XOR</span> <span class="built_in">BX</span>,<span class="built_in">BX</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,[<span class="built_in">BX</span>]</div><div class="line"><span class="keyword">CMP</span> <span class="built_in">BYTE</span> <span class="built_in">PTR</span> [<span class="built_in">BX</span>+0A],<span class="number">08</span> <span class="comment">;判断Buffer[10]是否等于8</span></div><div class="line"><span class="keyword">JNZ</span> <span class="number">0031</span> <span class="comment">;不等于则继续</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span> <span class="comment">;等于则返回</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="研究试验5-函数如何接受不定数量的参数"><a href="#研究试验5-函数如何接受不定数量的参数" class="headerlink" title="研究试验5 函数如何接受不定数量的参数"></a>研究试验5 函数如何接受不定数量的参数</h2><p>用C:\MINIC下的TC.EXE完成下面的试验。</p>
<ol>
<li><p>写一个程序A.C：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">showchar</span><span class="params">(<span class="keyword">char</span> a, <span class="keyword">int</span> b)</span></span>;</div><div class="line"></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	showchar(<span class="string">'a'</span>, <span class="number">2</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">showchar</span><span class="params">(<span class="keyword">char</span> a, <span class="keyword">int</span> b)</span></span></div><div class="line">&#123;</div><div class="line">	*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span>+<span class="number">160</span>*<span class="number">10</span>+<span class="number">80</span>)=a;</div><div class="line"></div><div class="line">	*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span>+<span class="number">160</span>*<span class="number">10</span>+<span class="number">81</span>)=b;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 用TC.EXE对A.C进行编译，连接，生成A.EXE。用Debug加载A.EXE，对函数的汇编代码进行分析。解答这两个问题：main函数是如何给showchar传递参数的？showchar是如何接受参数的？<br> main函数的汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>,<span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AX</span>,<span class="number">0002</span></div><div class="line"><span class="keyword">PUSH</span> <span class="built_in">AX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AL</span>,<span class="number">61</span></div><div class="line"><span class="keyword">PUSH</span> <span class="built_in">AX</span></div><div class="line"><span class="keyword">CALL</span> 020B <span class="comment">;调用showchar函数</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">CX</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">CX</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p> showchar函数的汇编代码如下：</p>
 <figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">PUSH</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BP</span>,<span class="built_in">SP</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AL</span>,[<span class="built_in">BP</span>+<span class="number">4</span>]</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,B800</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0690</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> [<span class="built_in">BX</span>],<span class="built_in">AL</span> <span class="comment">;f函数的第1条语句</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">AL</span>,[<span class="built_in">BP</span>+<span class="number">6</span>]</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,B800</div><div class="line"><span class="keyword">MOV</span> <span class="built_in">ES</span>,<span class="built_in">BX</span></div><div class="line"><span class="keyword">MOV</span> <span class="built_in">BX</span>,<span class="number">0691</span></div><div class="line"><span class="symbol">ES:</span></div><div class="line"><span class="keyword">MOV</span> [<span class="built_in">BX</span>],<span class="built_in">AL</span> <span class="comment">;f函数的第2条语句</span></div><div class="line"><span class="keyword">POP</span> <span class="built_in">BP</span></div><div class="line"><span class="keyword">RET</span></div></pre></td></tr></table></figure>
<p> 答案：<br> main函数通过将对应的参数压栈来给showchar传递参数，并且在函数返回后通过POP操作将参数退栈。<br> showchar通过SS:BP以及寻址在栈中取得对应的参数。</p>
</li>
<li><p>写一个程序B.C：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">showchar</span><span class="params">(<span class="keyword">int</span>,<span class="keyword">int</span>,...)</span></span>;</div><div class="line"></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	showchar(<span class="number">8</span>,<span class="number">2</span>,<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'f'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">showchar</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> color,...)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> a;</div><div class="line"></div><div class="line">	<span class="keyword">for</span>(a=<span class="number">0</span>;a!=n;a++)</div><div class="line">	&#123;</div><div class="line">		*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span>+<span class="number">160</span>*<span class="number">10</span>+<span class="number">80</span>+a+a)=*(<span class="keyword">int</span> *)(_BP+<span class="number">8</span>+a+a);<span class="comment">//加8是因～为call的时候将CS、IP压栈</span></div><div class="line"></div><div class="line">		*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span>+<span class="number">160</span>*<span class="number">10</span>+<span class="number">81</span>+a+a)=color;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 分析程序B.C，深入理解相关的知识。<br> 思考：showchar函数是如何知道要显示多少个字符的？printf函数是如何知道有多少个参数的？<br> 待显示字符的个数为showchar函数的第一个参数，showchar函数以此得知要显示的字符的个数。<br> 通过对printf的一个参数所指向的字符串的分析，printf函数以此得知参数的个数。</p>
</li>
<li><p>实现一个简单的printf函数，只需支持“%c %d”即可。</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">myprintf</span><span class="params">(<span class="keyword">char</span> *, ...)</span></span>;</div><div class="line"></div><div class="line">main()</div><div class="line">&#123;</div><div class="line">	myprintf(<span class="string">"%d %c abc %%\n"</span>, <span class="number">-12345</span>, <span class="number">48</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">myprintf</span><span class="params">(<span class="keyword">char</span> * str, ...)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> position = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span> (*str != <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span> (*str == <span class="number">37</span>)</div><div class="line">		&#123;</div><div class="line">			str++;</div><div class="line">			<span class="keyword">if</span> (*str == <span class="number">68</span> || *str == <span class="number">100</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">int</span> index;</div><div class="line">				<span class="keyword">char</span> flag = <span class="number">0</span>;</div><div class="line">				<span class="keyword">int</span> length = <span class="number">0</span>;</div><div class="line">				<span class="keyword">int</span> num = *(<span class="keyword">int</span> *)(_BP + <span class="number">6</span> + count);</div><div class="line">				<span class="keyword">if</span> (num &lt; <span class="number">0</span>) &#123;</div><div class="line">					flag = <span class="number">1</span>;</div><div class="line">					num *= <span class="number">-1</span>;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">while</span> (num != <span class="number">0</span>)</div><div class="line">				&#123;</div><div class="line">					num = num / <span class="number">10</span>;</div><div class="line">					length++;</div><div class="line">				&#125;</div><div class="line">				num = *(<span class="keyword">int</span> *)(_BP + <span class="number">6</span> + count);</div><div class="line">				<span class="keyword">if</span> (flag == <span class="number">1</span>) num *= <span class="number">-1</span>;</div><div class="line">				position += length + flag - <span class="number">1</span>;</div><div class="line">				<span class="keyword">for</span> (index = <span class="number">0</span> ; index &lt; length; ++index)</div><div class="line">				&#123;</div><div class="line">					*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span> + <span class="number">1600</span> + position * <span class="number">2</span>) = num % <span class="number">10</span> + <span class="number">48</span>;</div><div class="line">					num = num / <span class="number">10</span>;</div><div class="line">					position--;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span> (flag == <span class="number">1</span>)</div><div class="line">				&#123;</div><div class="line">					*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span> + <span class="number">1600</span> + position * <span class="number">2</span>) = <span class="string">'-'</span>;</div><div class="line">					position--;</div><div class="line">				&#125;</div><div class="line">				position += length + flag + <span class="number">1</span>;</div><div class="line">				count += <span class="number">2</span>;</div><div class="line">				str++;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (*str == <span class="number">67</span> || *str == <span class="number">99</span>)</div><div class="line">			&#123;</div><div class="line">				*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span> + <span class="number">1600</span> + position * <span class="number">2</span>) = *(<span class="keyword">char</span> *)(_BP + <span class="number">6</span> + count);</div><div class="line">				count++;</div><div class="line">				position++;</div><div class="line">				str++;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span> + <span class="number">1600</span> + position * <span class="number">2</span>) = <span class="string">'%'</span>;</div><div class="line">				position++;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			*(<span class="keyword">char</span> far *)(<span class="number">0xb8000000</span> + <span class="number">1600</span> + position * <span class="number">2</span>) = *str;</div><div class="line">			position++;</div><div class="line">			str++;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/03/10/王爽汇编语言第三版综合研究结论/#post-footer" class="postShorten-excerpt_link link">
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 页 共 1 页</li>
    </ul>
</div>

</section>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 CoSidian. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="作者的图片"/>
        
            <h4 id="about-card-name">CoSidian</h4>
        
            <div id="about-card-bio"><p>码龙黑曜 - iOS开发者/计算机科学/兽人控</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>本科在读</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                HUST, Wuhan, China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-i7zzex3jvqnxdf0lp2pg3bcyurjikigtrw9ljle5skc4mit2m7a13rwuyp8g.min.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
